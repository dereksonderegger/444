<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 19 Speeding up R | STA 444/5 - Introductory Data Science using R</title>
  <meta name="description" content="Chapter 19 Speeding up R | STA 444/5 - Introductory Data Science using R" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 19 Speeding up R | STA 444/5 - Introductory Data Science using R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/Cover1.png" />
  
  <meta name="github-repo" content="dereksonderegger/444" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 19 Speeding up R | STA 444/5 - Introductory Data Science using R" />
  
  
  <meta name="twitter:image" content="images/Cover1.png" />

<meta name="author" content="Derek L. Sonderegger" />


<meta name="date" content="2020-08-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="databases.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-resources"><i class="fa fa-check"></i>Other Resources</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="part"><span><b>Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="familiarization.html"><a href="familiarization.html"><i class="fa fa-check"></i><b>1</b> Familiarization</a><ul>
<li class="chapter" data-level="1.1" data-path="familiarization.html"><a href="familiarization.html#working-within-an-rmarkdown-file"><i class="fa fa-check"></i><b>1.1</b> Working within an Rmarkdown File</a></li>
<li class="chapter" data-level="1.2" data-path="familiarization.html"><a href="familiarization.html#r-file-types"><i class="fa fa-check"></i><b>1.2</b> R file Types</a><ul>
<li class="chapter" data-level="1.2.1" data-path="familiarization.html"><a href="familiarization.html#r-scripts-.r-files"><i class="fa fa-check"></i><b>1.2.1</b> R Scripts (.R files)</a></li>
<li class="chapter" data-level="1.2.2" data-path="familiarization.html"><a href="familiarization.html#r-markdown-.rmd-files"><i class="fa fa-check"></i><b>1.2.2</b> R Markdown (.Rmd files)</a></li>
<li class="chapter" data-level="1.2.3" data-path="familiarization.html"><a href="familiarization.html#r-notebooks-.rmd-files"><i class="fa fa-check"></i><b>1.2.3</b> R Notebooks (.Rmd files)</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="familiarization.html"><a href="familiarization.html#r-as-a-simple-calculator"><i class="fa fa-check"></i><b>1.3</b> R as a simple calculator</a></li>
<li class="chapter" data-level="1.4" data-path="familiarization.html"><a href="familiarization.html#assignment"><i class="fa fa-check"></i><b>1.4</b> Assignment</a></li>
<li class="chapter" data-level="1.5" data-path="familiarization.html"><a href="familiarization.html#vectors"><i class="fa fa-check"></i><b>1.5</b> Vectors</a></li>
<li class="chapter" data-level="1.6" data-path="familiarization.html"><a href="familiarization.html#packages"><i class="fa fa-check"></i><b>1.6</b> Packages</a></li>
<li class="chapter" data-level="1.7" data-path="familiarization.html"><a href="familiarization.html#finding-help"><i class="fa fa-check"></i><b>1.7</b> Finding Help</a><ul>
<li class="chapter" data-level="1.7.1" data-path="familiarization.html"><a href="familiarization.html#how-does-this-function-work"><i class="fa fa-check"></i><b>1.7.1</b> How does this function work?</a></li>
<li class="chapter" data-level="1.7.2" data-path="familiarization.html"><a href="familiarization.html#how-does-this-package-work"><i class="fa fa-check"></i><b>1.7.2</b> How does this package work?</a></li>
<li class="chapter" data-level="1.7.3" data-path="familiarization.html"><a href="familiarization.html#how-do-i-do-xxx"><i class="fa fa-check"></i><b>1.7.3</b> How do I do XXX?</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="familiarization.html"><a href="familiarization.html#Exercises_Familiarization"><i class="fa fa-check"></i><b>1.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-frames.html"><a href="data-frames.html"><i class="fa fa-check"></i><b>2</b> Data Frames</a><ul>
<li class="chapter" data-level="2.1" data-path="data-frames.html"><a href="data-frames.html#introduction-to-importing-data"><i class="fa fa-check"></i><b>2.1</b> Introduction to Importing Data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-frames.html"><a href="data-frames.html#from-a-package"><i class="fa fa-check"></i><b>2.1.1</b> From a Package</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-frames.html"><a href="data-frames.html#import-from-.csv-or-.xls-files"><i class="fa fa-check"></i><b>2.1.2</b> Import from <code>.csv</code> or <code>.xls</code> files</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-frames.html"><a href="data-frames.html#data-types"><i class="fa fa-check"></i><b>2.2</b> Data Types</a></li>
<li class="chapter" data-level="2.3" data-path="data-frames.html"><a href="data-frames.html#basic-manipulation"><i class="fa fa-check"></i><b>2.3</b> Basic Manipulation</a></li>
<li class="chapter" data-level="2.4" data-path="data-frames.html"><a href="data-frames.html#Exercises_IntroDataFrames"><i class="fa fa-check"></i><b>2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="graphing.html"><a href="graphing.html"><i class="fa fa-check"></i><b>3</b> Graphing</a><ul>
<li class="chapter" data-level="3.1" data-path="graphing.html"><a href="graphing.html#basic-graphs"><i class="fa fa-check"></i><b>3.1</b> Basic Graphs</a><ul>
<li class="chapter" data-level="3.1.1" data-path="graphing.html"><a href="graphing.html#scatterplots"><i class="fa fa-check"></i><b>3.1.1</b> Scatterplots</a></li>
<li class="chapter" data-level="3.1.2" data-path="graphing.html"><a href="graphing.html#box-plots"><i class="fa fa-check"></i><b>3.1.2</b> Box Plots</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="graphing.html"><a href="graphing.html#faceting"><i class="fa fa-check"></i><b>3.2</b> Faceting</a></li>
<li class="chapter" data-level="3.3" data-path="graphing.html"><a href="graphing.html#annotation"><i class="fa fa-check"></i><b>3.3</b> Annotation</a><ul>
<li class="chapter" data-level="3.3.1" data-path="graphing.html"><a href="graphing.html#axis-labels-and-titles"><i class="fa fa-check"></i><b>3.3.1</b> Axis Labels and Titles</a></li>
<li class="chapter" data-level="3.3.2" data-path="graphing.html"><a href="graphing.html#text-labels"><i class="fa fa-check"></i><b>3.3.2</b> Text Labels</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="graphing.html"><a href="graphing.html#Exercises_IntroGraphing"><i class="fa fa-check"></i><b>3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>4</b> Data Wrangling</a><ul>
<li class="chapter" data-level="4.1" data-path="data-wrangling.html"><a href="data-wrangling.html#verbs"><i class="fa fa-check"></i><b>4.1</b> Verbs</a><ul>
<li class="chapter" data-level="4.1.1" data-path="data-wrangling.html"><a href="data-wrangling.html#add_row"><i class="fa fa-check"></i><b>4.1.1</b> <code>add_row</code></a></li>
<li class="chapter" data-level="4.1.2" data-path="data-wrangling.html"><a href="data-wrangling.html#bind_rows"><i class="fa fa-check"></i><b>4.1.2</b> <code>bind_rows</code></a></li>
<li class="chapter" data-level="4.1.3" data-path="data-wrangling.html"><a href="data-wrangling.html#subsetting"><i class="fa fa-check"></i><b>4.1.3</b> Subsetting</a></li>
<li class="chapter" data-level="4.1.4" data-path="data-wrangling.html"><a href="data-wrangling.html#arrange"><i class="fa fa-check"></i><b>4.1.4</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="4.1.5" data-path="data-wrangling.html"><a href="data-wrangling.html#mutate"><i class="fa fa-check"></i><b>4.1.5</b> mutate()</a></li>
<li class="chapter" data-level="4.1.6" data-path="data-wrangling.html"><a href="data-wrangling.html#summarise"><i class="fa fa-check"></i><b>4.1.6</b> summarise()</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="data-wrangling.html"><a href="data-wrangling.html#split-apply-combine"><i class="fa fa-check"></i><b>4.2</b> Split, apply, combine</a></li>
<li class="chapter" data-level="4.3" data-path="data-wrangling.html"><a href="data-wrangling.html#Exercises_IntroDataWrangling"><i class="fa fa-check"></i><b>4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>5</b> Statistical Models</a><ul>
<li class="chapter" data-level="5.1" data-path="statistical-models.html"><a href="statistical-models.html#formula-notation"><i class="fa fa-check"></i><b>5.1</b> Formula Notation</a></li>
<li class="chapter" data-level="5.2" data-path="statistical-models.html"><a href="statistical-models.html#basic-models"><i class="fa fa-check"></i><b>5.2</b> Basic Models</a><ul>
<li class="chapter" data-level="5.2.1" data-path="statistical-models.html"><a href="statistical-models.html#t-tests"><i class="fa fa-check"></i><b>5.2.1</b> t-tests</a></li>
<li class="chapter" data-level="5.2.2" data-path="statistical-models.html"><a href="statistical-models.html#lm-objects"><i class="fa fa-check"></i><b>5.2.2</b> lm objects</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="statistical-models.html"><a href="statistical-models.html#accessor-function"><i class="fa fa-check"></i><b>5.3</b> Accessor function</a></li>
<li class="chapter" data-level="5.4" data-path="statistical-models.html"><a href="statistical-models.html#Exercises_ModelBuilding"><i class="fa fa-check"></i><b>5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="flow-control.html"><a href="flow-control.html"><i class="fa fa-check"></i><b>6</b> Flow Control</a><ul>
<li class="chapter" data-level="6.1" data-path="flow-control.html"><a href="flow-control.html#logical-expressions"><i class="fa fa-check"></i><b>6.1</b> Logical Expressions</a></li>
<li class="chapter" data-level="6.2" data-path="flow-control.html"><a href="flow-control.html#decision-statements"><i class="fa fa-check"></i><b>6.2</b> Decision statements</a><ul>
<li class="chapter" data-level="6.2.1" data-path="flow-control.html"><a href="flow-control.html#in-dplyr-wrangling"><i class="fa fa-check"></i><b>6.2.1</b> In <code>dplyr</code> wrangling</a></li>
<li class="chapter" data-level="6.2.2" data-path="flow-control.html"><a href="flow-control.html#general-if-else"><i class="fa fa-check"></i><b>6.2.2</b> General <code>if else</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="flow-control.html"><a href="flow-control.html#loops"><i class="fa fa-check"></i><b>6.3</b> Loops</a><ul>
<li class="chapter" data-level="6.3.1" data-path="flow-control.html"><a href="flow-control.html#while-loops"><i class="fa fa-check"></i><b>6.3.1</b> <code>while</code> Loops</a></li>
<li class="chapter" data-level="6.3.2" data-path="flow-control.html"><a href="flow-control.html#for-loops"><i class="fa fa-check"></i><b>6.3.2</b> <code>for</code> Loops</a></li>
<li class="chapter" data-level="6.3.3" data-path="flow-control.html"><a href="flow-control.html#mosaicdo-loops"><i class="fa fa-check"></i><b>6.3.3</b> <code>mosaic::do()</code> loops</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="flow-control.html"><a href="flow-control.html#functions"><i class="fa fa-check"></i><b>6.4</b> Functions</a></li>
<li class="chapter" data-level="6.5" data-path="flow-control.html"><a href="flow-control.html#Exercises_FlowControl"><i class="fa fa-check"></i><b>6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>7</b> Factors</a><ul>
<li class="chapter" data-level="7.1" data-path="factors.html"><a href="factors.html#creation-and-structure"><i class="fa fa-check"></i><b>7.1</b> Creation and Structure</a></li>
<li class="chapter" data-level="7.2" data-path="factors.html"><a href="factors.html#change-labels"><i class="fa fa-check"></i><b>7.2</b> Change Labels</a></li>
<li class="chapter" data-level="7.3" data-path="factors.html"><a href="factors.html#reorder-levels-1"><i class="fa fa-check"></i><b>7.3</b> Reorder Levels</a></li>
<li class="chapter" data-level="7.4" data-path="factors.html"><a href="factors.html#add-or-substract-levels"><i class="fa fa-check"></i><b>7.4</b> Add or substract Levels</a></li>
<li class="chapter" data-level="7.5" data-path="factors.html"><a href="factors.html#Exercises_Factors"><i class="fa fa-check"></i><b>7.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>Miscellaneous</b></span></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html"><i class="fa fa-check"></i>Statistical Tables</a><ul>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#example-distributions"><i class="fa fa-check"></i>Example Distributions</a></li>
<li><a href="statistical-tables.html#mosaicplotdist-function"><code>mosaic::plotDist()</code> function</a></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#base-r-functions"><i class="fa fa-check"></i>Base R functions</a><ul>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#d-function"><i class="fa fa-check"></i>d-function</a></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#p-function"><i class="fa fa-check"></i>p-function</a></li>
<li><a href="statistical-tables.html#q-function"><code>q</code>-function</a></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#r-function"><i class="fa fa-check"></i>r-function</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="statistical-tables.html"><a href="statistical-tables.html#Exercises_Statistical_Tables"><i class="fa fa-check"></i><b>7.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html"><i class="fa fa-check"></i>Rmarkdown Tricks</a><ul>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#chunk-options"><i class="fa fa-check"></i>Chunk Options</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#verbatim-list-environments"><i class="fa fa-check"></i>Verbatim &amp; List Environments</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#mathematical-expressions"><i class="fa fa-check"></i>Mathematical expressions</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#tables"><i class="fa fa-check"></i>Tables</a><ul>
<li class="chapter" data-level="7.6.1" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#simple-tables"><i class="fa fa-check"></i><b>7.6.1</b> Simple Tables</a></li>
<li class="chapter" data-level="7.6.2" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#grid-tables"><i class="fa fa-check"></i><b>7.6.2</b> Grid Tables</a></li>
<li class="chapter" data-level="7.6.3" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#pipe-tables"><i class="fa fa-check"></i><b>7.6.3</b> Pipe Tables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#r-functions-to-produce-table-code."><i class="fa fa-check"></i>R functions to produce table code.</a><ul>
<li class="chapter" data-level="7.6.4" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#knitrkable"><i class="fa fa-check"></i><b>7.6.4</b> <code class="unnumbered">knitr::kable</code></a></li>
<li class="chapter" data-level="7.6.5" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#package-pander"><i class="fa fa-check"></i><b>7.6.5</b> Package <code class="unnumbered">pander</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#code-appendix"><i class="fa fa-check"></i>Code Appendix</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html"><i class="fa fa-check"></i>Data Wrangling Process</a><ul>
<li class="chapter" data-level="7.7" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#introduction"><i class="fa fa-check"></i><b>7.7</b> Introduction</a></li>
<li class="chapter" data-level="7.8" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#import"><i class="fa fa-check"></i><b>7.8</b> Import</a></li>
<li class="chapter" data-level="7.9" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#tidying"><i class="fa fa-check"></i><b>7.9</b> Tidying</a></li>
<li class="chapter" data-level="7.10" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#cleaning"><i class="fa fa-check"></i><b>7.10</b> Cleaning</a></li>
<li class="chapter" data-level="7.11" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#use"><i class="fa fa-check"></i><b>7.11</b> Use</a></li>
</ul></li>
<li class="part"><span><b>Deeper Details</b></span></li>
<li class="chapter" data-level="8" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>8</b> Data Structures</a><ul>
<li class="chapter" data-level="8.1" data-path="familiarization.html"><a href="familiarization.html#vectors"><i class="fa fa-check"></i><b>8.1</b> Vectors</a><ul>
<li class="chapter" data-level="8.1.1" data-path="data-structures.html"><a href="data-structures.html#accessing-vector-elements"><i class="fa fa-check"></i><b>8.1.1</b> Accessing Vector Elements</a></li>
<li class="chapter" data-level="8.1.2" data-path="data-structures.html"><a href="data-structures.html#scalar-functions-applied-to-vectors"><i class="fa fa-check"></i><b>8.1.2</b> Scalar Functions Applied to Vectors</a></li>
<li class="chapter" data-level="8.1.3" data-path="data-structures.html"><a href="data-structures.html#vector-algebra"><i class="fa fa-check"></i><b>8.1.3</b> Vector Algebra</a></li>
<li class="chapter" data-level="8.1.4" data-path="data-structures.html"><a href="data-structures.html#commonly-used-vector-functions"><i class="fa fa-check"></i><b>8.1.4</b> Commonly Used Vector Functions</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="data-structures.html"><a href="data-structures.html#matrices"><i class="fa fa-check"></i><b>8.2</b> Matrices</a></li>
<li class="chapter" data-level="8.3" data-path="data-frames.html"><a href="data-frames.html#data-frames"><i class="fa fa-check"></i><b>8.3</b> Data Frames</a><ul>
<li class="chapter" data-level="8.3.1" data-path="data-structures.html"><a href="data-structures.html#data.frames-vs-tibbles"><i class="fa fa-check"></i><b>8.3.1</b> <code>data.frames</code> vs <code>tibbles</code></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-structures.html"><a href="data-structures.html#lists"><i class="fa fa-check"></i><b>8.4</b> Lists</a></li>
<li class="chapter" data-level="8.5" data-path="data-structures.html"><a href="data-structures.html#Exercises_DataStructures"><i class="fa fa-check"></i><b>8.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i><b>9</b> Importing Data</a><ul>
<li class="chapter" data-level="9.1" data-path="importing-data.html"><a href="importing-data.html#working-directory"><i class="fa fa-check"></i><b>9.1</b> Working directory</a></li>
<li class="chapter" data-level="9.2" data-path="importing-data.html"><a href="importing-data.html#comma-separated-data"><i class="fa fa-check"></i><b>9.2</b> Comma Separated Data</a></li>
<li class="chapter" data-level="9.3" data-path="importing-data.html"><a href="importing-data.html#ms-excel"><i class="fa fa-check"></i><b>9.3</b> MS Excel</a></li>
<li class="chapter" data-level="9.4" data-path="importing-data.html"><a href="importing-data.html#multiple-files"><i class="fa fa-check"></i><b>9.4</b> Multiple files</a></li>
<li class="chapter" data-level="9.5" data-path="importing-data.html"><a href="importing-data.html#Exercises_DataImport"><i class="fa fa-check"></i><b>9.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="flow-control.html"><a href="flow-control.html#functions"><i class="fa fa-check"></i><b>10</b> Functions</a><ul>
<li class="chapter" data-level="10.1" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>10.1</b> Basic function definition</a></li>
<li class="chapter" data-level="10.2" data-path="functions.html"><a href="functions.html#parameter-defaults"><i class="fa fa-check"></i><b>10.2</b> Parameter Defaults</a></li>
<li class="chapter" data-level="10.3" data-path="functions.html"><a href="functions.html#ellipses"><i class="fa fa-check"></i><b>10.3</b> Ellipses</a></li>
<li class="chapter" data-level="10.4" data-path="functions.html"><a href="functions.html#function-overloading"><i class="fa fa-check"></i><b>10.4</b> Function Overloading</a></li>
<li class="chapter" data-level="10.5" data-path="functions.html"><a href="functions.html#debugging"><i class="fa fa-check"></i><b>10.5</b> Debugging</a><ul>
<li class="chapter" data-level="10.5.1" data-path="functions.html"><a href="functions.html#rmarkdown-recommendations"><i class="fa fa-check"></i><b>10.5.1</b> Rmarkdown Recommendations</a></li>
<li class="chapter" data-level="10.5.2" data-path="functions.html"><a href="functions.html#step-wise-execution"><i class="fa fa-check"></i><b>10.5.2</b> Step-wise Execution</a></li>
<li class="chapter" data-level="10.5.3" data-path="functions.html"><a href="functions.html#print-statements"><i class="fa fa-check"></i><b>10.5.3</b> Print Statements</a></li>
<li class="chapter" data-level="10.5.4" data-path="functions.html"><a href="functions.html#browser"><i class="fa fa-check"></i><b>10.5.4</b> <code>browser</code></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="functions.html"><a href="functions.html#scope"><i class="fa fa-check"></i><b>10.6</b> Scope</a></li>
<li class="chapter" data-level="10.7" data-path="functions.html"><a href="functions.html#Exercises_Functions"><i class="fa fa-check"></i><b>10.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="string-manipulation.html"><a href="string-manipulation.html"><i class="fa fa-check"></i><b>11</b> String Manipulation</a><ul>
<li class="chapter" data-level="11.1" data-path="string-manipulation.html"><a href="string-manipulation.html#base-function"><i class="fa fa-check"></i><b>11.1</b> Base function</a></li>
<li class="chapter" data-level="11.2" data-path="string-manipulation.html"><a href="string-manipulation.html#stringr-basic-operations"><i class="fa fa-check"></i><b>11.2</b> <code>stringr</code>: Basic operations</a><ul>
<li class="chapter" data-level="11.2.1" data-path="string-manipulation.html"><a href="string-manipulation.html#concatenating-with-str_c-or-str_join"><i class="fa fa-check"></i><b>11.2.1</b> Concatenating with <code>str_c()</code> or <code>str_join()</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="string-manipulation.html"><a href="string-manipulation.html#calculating-string-length-with-str_length"><i class="fa fa-check"></i><b>11.2.2</b> Calculating string length with <code>str_length()</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="string-manipulation.html"><a href="string-manipulation.html#extracting-substrings-with-str_sub"><i class="fa fa-check"></i><b>11.2.3</b> Extracting substrings with <code>str_sub()</code></a></li>
<li class="chapter" data-level="11.2.4" data-path="string-manipulation.html"><a href="string-manipulation.html#pad-a-string-with-str_pad"><i class="fa fa-check"></i><b>11.2.4</b> Pad a string with <code>str_pad()</code></a></li>
<li class="chapter" data-level="11.2.5" data-path="string-manipulation.html"><a href="string-manipulation.html#trim-a-string-with-str_trim"><i class="fa fa-check"></i><b>11.2.5</b> Trim a string with <code>str_trim()</code></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="string-manipulation.html"><a href="string-manipulation.html#stringr-pattern-matching-tools"><i class="fa fa-check"></i><b>11.3</b> <code>stringr</code>: Pattern Matching Tools</a><ul>
<li class="chapter" data-level="11.3.1" data-path="string-manipulation.html"><a href="string-manipulation.html#detecting-a-pattern-using-str_detect"><i class="fa fa-check"></i><b>11.3.1</b> Detecting a pattern using str_detect()</a></li>
<li class="chapter" data-level="11.3.2" data-path="string-manipulation.html"><a href="string-manipulation.html#locating-a-pattern-using-str_locate"><i class="fa fa-check"></i><b>11.3.2</b> Locating a pattern using str_locate()</a></li>
<li class="chapter" data-level="11.3.3" data-path="string-manipulation.html"><a href="string-manipulation.html#replacing-sub-strings-using-str_replace"><i class="fa fa-check"></i><b>11.3.3</b> Replacing sub-strings using <code>str_replace()</code></a></li>
<li class="chapter" data-level="11.3.4" data-path="string-manipulation.html"><a href="string-manipulation.html#splitting-into-sub-strings-using-str_split"><i class="fa fa-check"></i><b>11.3.4</b> Splitting into sub-strings using <code>str_split()</code></a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="string-manipulation.html"><a href="string-manipulation.html#regular-expressions"><i class="fa fa-check"></i><b>11.4</b> Regular Expressions</a><ul>
<li class="chapter" data-level="11.4.1" data-path="string-manipulation.html"><a href="string-manipulation.html#regular-expression-ingredients"><i class="fa fa-check"></i><b>11.4.1</b> Regular Expression Ingredients</a></li>
<li class="chapter" data-level="11.4.2" data-path="string-manipulation.html"><a href="string-manipulation.html#matching-a-specific-string"><i class="fa fa-check"></i><b>11.4.2</b> Matching a specific string</a></li>
<li class="chapter" data-level="11.4.3" data-path="string-manipulation.html"><a href="string-manipulation.html#matching-arbitrary-numbers"><i class="fa fa-check"></i><b>11.4.3</b> Matching arbitrary numbers</a></li>
<li class="chapter" data-level="11.4.4" data-path="string-manipulation.html"><a href="string-manipulation.html#greedy-matching"><i class="fa fa-check"></i><b>11.4.4</b> Greedy matching</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="string-manipulation.html"><a href="string-manipulation.html#fuzzy-pattern-matching"><i class="fa fa-check"></i><b>11.5</b> Fuzzy Pattern Matching</a><ul>
<li class="chapter" data-level="11.5.1" data-path="string-manipulation.html"><a href="string-manipulation.html#key-collision-merge"><i class="fa fa-check"></i><b>11.5.1</b> Key Collision Merge</a></li>
<li class="chapter" data-level="11.5.2" data-path="string-manipulation.html"><a href="string-manipulation.html#string-distances"><i class="fa fa-check"></i><b>11.5.2</b> String Distances</a></li>
<li class="chapter" data-level="11.5.3" data-path="string-manipulation.html"><a href="string-manipulation.html#n-gram-merge"><i class="fa fa-check"></i><b>11.5.3</b> N-gram Merge</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="string-manipulation.html"><a href="string-manipulation.html#Exercises_Strings"><i class="fa fa-check"></i><b>11.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>12</b> Dates and Times</a><ul>
<li class="chapter" data-level="12.1" data-path="dates-and-times.html"><a href="dates-and-times.html#creating-date-and-time-objects"><i class="fa fa-check"></i><b>12.1</b> Creating Date and Time objects</a></li>
<li class="chapter" data-level="12.2" data-path="dates-and-times.html"><a href="dates-and-times.html#extracting-information"><i class="fa fa-check"></i><b>12.2</b> Extracting information</a></li>
<li class="chapter" data-level="12.3" data-path="dates-and-times.html"><a href="dates-and-times.html#arithmetic-on-dates"><i class="fa fa-check"></i><b>12.3</b> Arithmetic on Dates</a></li>
<li class="chapter" data-level="12.4" data-path="dates-and-times.html"><a href="dates-and-times.html#Exercises_Dates"><i class="fa fa-check"></i><b>12.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="data-reshaping.html"><a href="data-reshaping.html"><i class="fa fa-check"></i><b>13</b> Data Reshaping</a><ul>
<li class="chapter" data-level="13.1" data-path="data-structures.html"><a href="data-structures.html#data.frames-vs-tibbles"><i class="fa fa-check"></i><b>13.1</b> <code>data.frames</code> vs <code>tibbles</code></a></li>
<li class="chapter" data-level="13.2" data-path="data-reshaping.html"><a href="data-reshaping.html#cbind-rbind"><i class="fa fa-check"></i><b>13.2</b> <code>cbind</code> &amp; <code>rbind</code></a></li>
<li class="chapter" data-level="13.3" data-path="data-reshaping.html"><a href="data-reshaping.html#tidyr"><i class="fa fa-check"></i><b>13.3</b> <code>tidyr</code></a><ul>
<li class="chapter" data-level="13.3.1" data-path="data-wrangling.html"><a href="data-wrangling.html#verbs"><i class="fa fa-check"></i><b>13.3.1</b> Verbs</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="data-reshaping.html"><a href="data-reshaping.html#storing-data-in-multiple-tables"><i class="fa fa-check"></i><b>13.4</b> Storing Data in Multiple Tables</a></li>
<li class="chapter" data-level="13.5" data-path="data-reshaping.html"><a href="data-reshaping.html#table-joins"><i class="fa fa-check"></i><b>13.5</b> Table Joins</a></li>
<li class="chapter" data-level="13.6" data-path="data-reshaping.html"><a href="data-reshaping.html#row-summations"><i class="fa fa-check"></i><b>13.6</b> Row summations</a></li>
<li class="chapter" data-level="13.7" data-path="data-reshaping.html"><a href="data-reshaping.html#Exercises_DataReshaping"><i class="fa fa-check"></i><b>13.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i>Maps</a><ul>
<li class="chapter" data-level="" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#introduction"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#coordinate-reference-systems-crs"><i class="fa fa-check"></i>Coordinate Reference Systems (CRS)</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#spatial-objects"><i class="fa fa-check"></i>Spatial Objects</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#tiles"><i class="fa fa-check"></i>Tiles</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#obtaining-spatial-data"><i class="fa fa-check"></i>Obtaining Spatial Data</a><ul>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#natural-earth-database"><i class="fa fa-check"></i>Natural Earth Database</a></li>
<li class="chapter" data-level="13.7.1" data-path="maps.html"><a href="maps.html#package-maps"><i class="fa fa-check"></i><b>13.7.1</b> Package <code class="unnumbered">maps</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#example"><i class="fa fa-check"></i>Example</a><ul>
<li class="chapter" data-level="13.7.2" data-path="maps.html"><a href="maps.html#package-leaflet"><i class="fa fa-check"></i><b>13.7.2</b> Package <code class="unnumbered">leaflet</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html"><i class="fa fa-check"></i><b>14</b> Graphing Part II</a><ul>
<li class="chapter" data-level="14.1" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#multi-plots"><i class="fa fa-check"></i><b>14.1</b> Multi-plots</a><ul>
<li class="chapter" data-level="14.1.1" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#cowplot-package"><i class="fa fa-check"></i><b>14.1.1</b> <code>cowplot</code> package</a></li>
<li class="chapter" data-level="14.1.2" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#multiplot-in-rmisc"><i class="fa fa-check"></i><b>14.1.2</b> <code>multiplot</code> in <code>Rmisc</code></a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#customized-scales"><i class="fa fa-check"></i><b>14.2</b> Customized Scales</a><ul>
<li class="chapter" data-level="14.2.1" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#color-scales"><i class="fa fa-check"></i><b>14.2.1</b> Color Scales</a></li>
<li class="chapter" data-level="14.2.2" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#setting-major-minor-ticks"><i class="fa fa-check"></i><b>14.2.2</b> Setting major &amp; minor ticks</a></li>
<li class="chapter" data-level="14.2.3" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#log-scales"><i class="fa fa-check"></i><b>14.2.3</b> Log Scales</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#themes"><i class="fa fa-check"></i><b>14.3</b> Themes</a></li>
<li class="chapter" data-level="14.4" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#mathematical-notation"><i class="fa fa-check"></i><b>14.4</b> Mathematical Notation</a></li>
<li class="chapter" data-level="14.5" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#interactive-plots-with-plotly"><i class="fa fa-check"></i><b>14.5</b> Interactive plots with <code>plotly</code></a></li>
<li class="chapter" data-level="14.6" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#geographic-maps"><i class="fa fa-check"></i><b>14.6</b> Geographic Maps</a><ul>
<li class="chapter" data-level="14.6.1" data-path="maps.html"><a href="maps.html#package-maps"><i class="fa fa-check"></i><b>14.6.1</b> Package <code>maps</code></a></li>
<li class="chapter" data-level="14.6.2" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#packages-sf-and-rnaturalearth"><i class="fa fa-check"></i><b>14.6.2</b> Packages <code>sf</code> and <code>rnaturalearth</code></a></li>
<li class="chapter" data-level="14.6.3" data-path="maps.html"><a href="maps.html#package-leaflet"><i class="fa fa-check"></i><b>14.6.3</b> Package <code>leaflet</code></a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#Exercises_Advanced_Graphing"><i class="fa fa-check"></i><b>14.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="r-packages.html"><a href="r-packages.html"><i class="fa fa-check"></i><b>15</b> R Packages</a><ul>
<li class="chapter" data-level="15.1" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#introduction"><i class="fa fa-check"></i><b>15.1</b> Introduction</a><ul>
<li class="chapter" data-level="15.1.1" data-path="r-packages.html"><a href="r-packages.html#useful-packages-and-books"><i class="fa fa-check"></i><b>15.1.1</b> Useful packages and books</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="r-packages.html"><a href="r-packages.html#package-structure"><i class="fa fa-check"></i><b>15.2</b> Package Structure</a><ul>
<li class="chapter" data-level="15.2.1" data-path="r-packages.html"><a href="r-packages.html#minimal-files-and-directories"><i class="fa fa-check"></i><b>15.2.1</b> Minimal files and directories</a></li>
<li class="chapter" data-level="15.2.2" data-path="r-packages.html"><a href="r-packages.html#optional-files-and-directories"><i class="fa fa-check"></i><b>15.2.2</b> Optional Files and Directories</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="r-packages.html"><a href="r-packages.html#documenting"><i class="fa fa-check"></i><b>15.3</b> Documenting</a><ul>
<li class="chapter" data-level="15.3.1" data-path="r-packages.html"><a href="r-packages.html#data-documentation"><i class="fa fa-check"></i><b>15.3.1</b> Data Documentation</a></li>
<li class="chapter" data-level="15.3.2" data-path="r-packages.html"><a href="r-packages.html#documenting-functions"><i class="fa fa-check"></i><b>15.3.2</b> Documenting Functions</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="r-packages.html"><a href="r-packages.html#testing"><i class="fa fa-check"></i><b>15.4</b> Testing</a></li>
<li class="chapter" data-level="15.5" data-path="r-packages.html"><a href="r-packages.html#the-description-file"><i class="fa fa-check"></i><b>15.5</b> The DESCRIPTION file</a></li>
<li class="chapter" data-level="15.6" data-path="r-packages.html"><a href="r-packages.html#sharing-your-package"><i class="fa fa-check"></i><b>15.6</b> Sharing your Package</a></li>
<li class="chapter" data-level="15.7" data-path="r-packages.html"><a href="r-packages.html#an-example-package"><i class="fa fa-check"></i><b>15.7</b> An Example Package</a></li>
<li class="chapter" data-level="15.8" data-path="r-packages.html"><a href="r-packages.html#Exercises_Packages"><i class="fa fa-check"></i><b>15.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="data-scraping.html"><a href="data-scraping.html"><i class="fa fa-check"></i><b>16</b> Data Scraping</a><ul>
<li class="chapter" data-level="16.1" data-path="data-scraping.html"><a href="data-scraping.html#web-pages"><i class="fa fa-check"></i><b>16.1</b> Web Pages</a><ul>
<li class="chapter" data-level="16.1.1" data-path="data-scraping.html"><a href="data-scraping.html#example-wikipedia-table"><i class="fa fa-check"></i><b>16.1.1</b> Example Wikipedia Table</a></li>
<li class="chapter" data-level="16.1.2" data-path="data-structures.html"><a href="data-structures.html#lists"><i class="fa fa-check"></i><b>16.1.2</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="data-scraping.html"><a href="data-scraping.html#scraping-.pdf-files"><i class="fa fa-check"></i><b>16.2</b> Scraping .pdf files</a></li>
<li class="chapter" data-level="16.3" data-path="data-scraping.html"><a href="data-scraping.html#Exercises_WebScraping"><i class="fa fa-check"></i><b>16.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="api-data-queries.html"><a href="api-data-queries.html"><i class="fa fa-check"></i><b>17</b> API Data Queries</a><ul>
<li class="chapter" data-level="17.1" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#introduction"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="api-data-queries.html"><a href="api-data-queries.html#census-bureau-api"><i class="fa fa-check"></i><b>17.2</b> Census Bureau API</a></li>
<li class="chapter" data-level="17.3" data-path="api-data-queries.html"><a href="api-data-queries.html#package-censusapi"><i class="fa fa-check"></i><b>17.3</b> Package <code>censusapi</code></a><ul>
<li class="chapter" data-level="17.3.1" data-path="api-data-queries.html"><a href="api-data-queries.html#population-estimates"><i class="fa fa-check"></i><b>17.3.1</b> Population Estimates</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="api-data-queries.html"><a href="api-data-queries.html#package-tidycensus"><i class="fa fa-check"></i><b>17.4</b> Package <code>tidycensus</code></a></li>
<li class="chapter" data-level="17.5" data-path="api-data-queries.html"><a href="api-data-queries.html#Exercises_APIs"><i class="fa fa-check"></i><b>17.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="databases.html"><a href="databases.html"><i class="fa fa-check"></i><b>18</b> Databases</a><ul>
<li class="chapter" data-level="18.1" data-path="databases.html"><a href="databases.html#tutorial-set-up"><i class="fa fa-check"></i><b>18.1</b> Tutorial Set-Up</a></li>
<li class="chapter" data-level="18.2" data-path="databases.html"><a href="databases.html#sql"><i class="fa fa-check"></i><b>18.2</b> SQL</a></li>
<li class="chapter" data-level="18.3" data-path="databases.html"><a href="databases.html#dbplyr"><i class="fa fa-check"></i><b>18.3</b> <code>dbplyr</code></a></li>
<li class="chapter" data-level="18.4" data-path="databases.html"><a href="databases.html#Exercises_DataBases"><i class="fa fa-check"></i><b>18.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="speeding-up-r.html"><a href="speeding-up-r.html"><i class="fa fa-check"></i><b>19</b> Speeding up R</a><ul>
<li class="chapter" data-level="19.1" data-path="speeding-up-r.html"><a href="speeding-up-r.html#faster-for-loops"><i class="fa fa-check"></i><b>19.1</b> Faster for loops?</a></li>
<li class="chapter" data-level="19.2" data-path="speeding-up-r.html"><a href="speeding-up-r.html#vectorizing-loops"><i class="fa fa-check"></i><b>19.2</b> Vectorizing loops</a></li>
<li class="chapter" data-level="19.3" data-path="speeding-up-r.html"><a href="speeding-up-r.html#parallel-processing"><i class="fa fa-check"></i><b>19.3</b> Parallel Processing</a></li>
<li class="chapter" data-level="19.4" data-path="speeding-up-r.html"><a href="speeding-up-r.html#parallel-aware-functions"><i class="fa fa-check"></i><b>19.4</b> Parallel Aware Functions</a><ul>
<li class="chapter" data-level="19.4.1" data-path="speeding-up-r.html"><a href="speeding-up-r.html#bootboot"><i class="fa fa-check"></i><b>19.4.1</b> <code>boot::boot</code></a></li>
<li class="chapter" data-level="19.4.2" data-path="speeding-up-r.html"><a href="speeding-up-r.html#carettrain"><i class="fa fa-check"></i><b>19.4.2</b> <code>caret::train</code></a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="speeding-up-r.html"><a href="speeding-up-r.html#parallelizing-for-loops"><i class="fa fa-check"></i><b>19.5</b> Parallelizing <code>for</code> loops</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STA 444/5 - Introductory Data Science using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="speeding-up-r" class="section level1">
<h1><span class="header-section-number">Chapter 19</span> Speeding up R</h1>
<div class="sourceCode" id="cb886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb886-1"><a href="speeding-up-r.html#cb886-1"></a><span class="kw">library</span>(microbenchmark)  <span class="co"># for measuring how long stuff takes</span></span>
<span id="cb886-2"><a href="speeding-up-r.html#cb886-2"></a></span>
<span id="cb886-3"><a href="speeding-up-r.html#cb886-3"></a><span class="kw">library</span>(doMC)      <span class="co"># do multi-core stuff</span></span>
<span id="cb886-4"><a href="speeding-up-r.html#cb886-4"></a><span class="kw">library</span>(foreach)   <span class="co"># parallelizable for loops</span></span>
<span id="cb886-5"><a href="speeding-up-r.html#cb886-5"></a></span>
<span id="cb886-6"><a href="speeding-up-r.html#cb886-6"></a><span class="kw">library</span>(tidyverse) <span class="co"># dplyr, ggplot2, etc...</span></span>
<span id="cb886-7"><a href="speeding-up-r.html#cb886-7"></a></span>
<span id="cb886-8"><a href="speeding-up-r.html#cb886-8"></a><span class="kw">library</span>(faraway)   <span class="co"># some examples</span></span>
<span id="cb886-9"><a href="speeding-up-r.html#cb886-9"></a><span class="kw">library</span>(boot)</span>
<span id="cb886-10"><a href="speeding-up-r.html#cb886-10"></a><span class="kw">library</span>(caret)</span>
<span id="cb886-11"><a href="speeding-up-r.html#cb886-11"></a><span class="kw">library</span>(glmnet)</span></code></pre></div>
<p>There is a YouTube <a href="https://youtu.be/XaoYfmPbxSA">Video Lecture</a> for this chapter.</p>
<p>Eventually if you have large enough data sets, an R user eventually writes code that is slow to execute and needs to be sped up. This chapter tries to lay out common problems and bad habits and shows how to correct them. However, the correctness and maintainability of code should take precedence over speed. Too often, misguided attempts to obtain efficient code results in an un-maintainable mess that is no faster that the initial code.</p>
<p>Hadley Wickham has a book aimed at advanced R user that describes many of the finer details about R. One section in the book describes his process for building fast, maintainable software projects and if you have the time, I highly suggest reading the on-line version,
<a href="http://adv-r.had.co.nz/Performance.html">Advanced R</a>.</p>
<p>First we need some way of measuring how long our code took to run. For this we will use the package <code>microbenchmark</code>. The idea is that we want to evaluate two or three expressions that solve a problem.</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="speeding-up-r.html#cb887-1"></a><span class="co"># The expressions can be as many lines as you&#39;d like, enclosed by { }. </span></span>
<span id="cb887-2"><a href="speeding-up-r.html#cb887-2"></a><span class="co"># For a single line, you can skip the enclosing { }.</span></span>
<span id="cb887-3"><a href="speeding-up-r.html#cb887-3"></a><span class="co"># </span></span>
<span id="cb887-4"><a href="speeding-up-r.html#cb887-4"></a><span class="co"># For evaluating large chunks of code, I like to </span></span>
<span id="cb887-5"><a href="speeding-up-r.html#cb887-5"></a><span class="co"># just wrap the code up in a function.</span></span>
<span id="cb887-6"><a href="speeding-up-r.html#cb887-6"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1000</span>)  <span class="co"># x vector of 1000 numbers between 0 and 1.</span></span>
<span id="cb887-7"><a href="speeding-up-r.html#cb887-7"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb887-8"><a href="speeding-up-r.html#cb887-8"></a>  <span class="kw">sqrt</span>(x),         <span class="co"># First expression to compare</span></span>
<span id="cb887-9"><a href="speeding-up-r.html#cb887-9"></a>  x<span class="op">^</span>(<span class="fl">0.5</span>)          <span class="co"># second expression to compare</span></span>
<span id="cb887-10"><a href="speeding-up-r.html#cb887-10"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Unit: microseconds
##     expr   min   lq  mean median    uq   max neval cld
##  sqrt(x)  2.22  2.4  3.31   2.64  3.39  12.6   100  a 
##  x^(0.5) 24.72 25.6 31.95  26.01 32.89 131.4   100   b</code></pre>
<p>What <code>microbenchmark</code> does is run the two expressions a number of times and then
produces the 5-number summary of those times. By running it multiple times (by
default, 100 times), we
account for the randomness associated with a operating system that is also running
at the same time. Being good statisticians, the <code>cld</code> column stands for compact
letter display and if the letters are different, there is a statistically
significant difference in the timing. If we cause the <code>microbenchmark()</code> function to
run more times (1000s or 100,000s times), we could eventually end up with the smallest
difference to be statistically significant, but I think we shouldn’t complain about
speed differences if a sample of 100 runs can’t detect the difference.</p>
<div id="faster-for-loops" class="section level2">
<h2><span class="header-section-number">19.1</span> Faster for loops?</h2>
<p>Often we need to perform some simple action repeatedly. It is natural to write
a <code>for</code> loop to do the action and we wish to speed the up. In this first case,
we will consider having to do the action millions of times and each chunk of
computation within the <code>for</code> takes very little time.</p>
<p>Consider frame of 4 columns, and for each of <span class="math inline">\(n\)</span> rows, we wish to know which
column has the largest value.</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb889-1"><a href="speeding-up-r.html#cb889-1"></a>make.data &lt;-<span class="st"> </span><span class="cf">function</span>(n){</span>
<span id="cb889-2"><a href="speeding-up-r.html#cb889-2"></a>  data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb889-3"><a href="speeding-up-r.html#cb889-3"></a>    <span class="dt">Norm  =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean=</span><span class="dv">5</span>, <span class="dt">sd=</span><span class="dv">2</span>),</span>
<span id="cb889-4"><a href="speeding-up-r.html#cb889-4"></a>    <span class="dt">Pois  =</span> <span class="kw">rpois</span>(n, <span class="dt">lambda =</span> <span class="dv">5</span>),</span>
<span id="cb889-5"><a href="speeding-up-r.html#cb889-5"></a>    <span class="dt">Gamma =</span> <span class="kw">rgamma</span>(n, <span class="dt">shape =</span> <span class="dv">2</span>, <span class="dt">scale =</span> <span class="dv">3</span>),</span>
<span id="cb889-6"><a href="speeding-up-r.html#cb889-6"></a>    <span class="dt">Exp   =</span> <span class="kw">rexp</span>(n, <span class="dt">rate =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>))</span>
<span id="cb889-7"><a href="speeding-up-r.html#cb889-7"></a>  <span class="kw">return</span>(data)</span>
<span id="cb889-8"><a href="speeding-up-r.html#cb889-8"></a>}</span>
<span id="cb889-9"><a href="speeding-up-r.html#cb889-9"></a></span>
<span id="cb889-10"><a href="speeding-up-r.html#cb889-10"></a>data &lt;-<span class="st"> </span><span class="kw">make.data</span>(<span class="dv">6</span>)</span>
<span id="cb889-11"><a href="speeding-up-r.html#cb889-11"></a>data</span></code></pre></div>
<pre><code>##       Norm Pois     Gamma       Exp
## 1 5.079136    7 0.7644054  2.780193
## 2 5.598038    5 7.7653753  1.231766
## 3 3.707923    2 8.6443491 11.591930
## 4 4.661450    7 1.7702589  1.181605
## 5 5.312595    3 5.2059087  9.864848
## 6 9.158192    6 7.9529147  1.590383</code></pre>
<p>The way that you might first think about solving this problem is to write a for
loop and, for each row, figure it out.</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="speeding-up-r.html#cb891-1"></a>f1 &lt;-<span class="st"> </span><span class="cf">function</span>( input ){</span>
<span id="cb891-2"><a href="speeding-up-r.html#cb891-2"></a>  output &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb891-3"><a href="speeding-up-r.html#cb891-3"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(input) ){</span>
<span id="cb891-4"><a href="speeding-up-r.html#cb891-4"></a>    output[i] &lt;-<span class="st"> </span><span class="kw">which.max</span>( input[i,] )</span>
<span id="cb891-5"><a href="speeding-up-r.html#cb891-5"></a>  }</span>
<span id="cb891-6"><a href="speeding-up-r.html#cb891-6"></a>  <span class="kw">return</span>(output)</span>
<span id="cb891-7"><a href="speeding-up-r.html#cb891-7"></a>}</span></code></pre></div>
<p>We might consider that there are two ways to return a value from a function
(using the <code>return</code> function and just printing it). In fact, I’ve always heard
that using the <code>return</code> statement is a touch slower.</p>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="speeding-up-r.html#cb892-1"></a>f2.noReturn &lt;-<span class="st"> </span><span class="cf">function</span>( input ){</span>
<span id="cb892-2"><a href="speeding-up-r.html#cb892-2"></a>  output &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb892-3"><a href="speeding-up-r.html#cb892-3"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(input) ){</span>
<span id="cb892-4"><a href="speeding-up-r.html#cb892-4"></a>    output[i] &lt;-<span class="st"> </span><span class="kw">which.max</span>( input[i,] )</span>
<span id="cb892-5"><a href="speeding-up-r.html#cb892-5"></a>  }</span>
<span id="cb892-6"><a href="speeding-up-r.html#cb892-6"></a>  output</span>
<span id="cb892-7"><a href="speeding-up-r.html#cb892-7"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="speeding-up-r.html#cb893-1"></a>data &lt;-<span class="st"> </span><span class="kw">make.data</span>(<span class="dv">1000</span>)</span>
<span id="cb893-2"><a href="speeding-up-r.html#cb893-2"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb893-3"><a href="speeding-up-r.html#cb893-3"></a>  <span class="kw">f1</span>(data),</span>
<span id="cb893-4"><a href="speeding-up-r.html#cb893-4"></a>  <span class="kw">f2.noReturn</span>(data)</span>
<span id="cb893-5"><a href="speeding-up-r.html#cb893-5"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Unit: milliseconds
##               expr  min   lq mean median   uq max neval cld
##           f1(data) 43.9 46.6 52.9   49.2 52.8 176   100   a
##  f2.noReturn(data) 44.2 46.6 50.6   48.3 51.4 105   100   a</code></pre>
<p>In fact, it looks like it is a touch slower, but not massively compared to the run-to-run variability. I prefer to use the <code>return</code> statement for readability, but if we agree have the last line of code in the function be whatever needs to be returned, readability isn’t strongly effected.</p>
<p>We next consider whether it would be faster to allocate the output vector once we figure out the number of rows needed, or just build it on the fly?</p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="speeding-up-r.html#cb895-1"></a>f3.AllocOutput &lt;-<span class="st"> </span><span class="cf">function</span>( input ){</span>
<span id="cb895-2"><a href="speeding-up-r.html#cb895-2"></a>  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(input)</span>
<span id="cb895-3"><a href="speeding-up-r.html#cb895-3"></a>  output &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NULL</span>, n)</span>
<span id="cb895-4"><a href="speeding-up-r.html#cb895-4"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(input) ){</span>
<span id="cb895-5"><a href="speeding-up-r.html#cb895-5"></a>    output[i] &lt;-<span class="st"> </span><span class="kw">which.max</span>( input[i,] )</span>
<span id="cb895-6"><a href="speeding-up-r.html#cb895-6"></a>  }</span>
<span id="cb895-7"><a href="speeding-up-r.html#cb895-7"></a>  <span class="kw">return</span>(output)</span>
<span id="cb895-8"><a href="speeding-up-r.html#cb895-8"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="speeding-up-r.html#cb896-1"></a>data &lt;-<span class="st"> </span><span class="kw">make.data</span>(<span class="dv">10000</span>)   <span class="co"># Moderately large sample size</span></span>
<span id="cb896-2"><a href="speeding-up-r.html#cb896-2"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb896-3"><a href="speeding-up-r.html#cb896-3"></a>  <span class="kw">f1</span>(data),</span>
<span id="cb896-4"><a href="speeding-up-r.html#cb896-4"></a>  <span class="kw">f3.AllocOutput</span>(data)</span>
<span id="cb896-5"><a href="speeding-up-r.html#cb896-5"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Unit: milliseconds
##                  expr min  lq mean median  uq  max neval cld
##              f1(data) 441 470  545    482 523 2484   100   a
##  f3.AllocOutput(data) 454 477  545    506 546 1440   100   a</code></pre>
<p>There isn’t a significant improvement allocating the size of output first. So given this, we shouldn’t feel to bad being lazy and using <code>output &lt;- NULL</code> to initialize things.</p>
</div>
<div id="vectorizing-loops" class="section level2">
<h2><span class="header-section-number">19.2</span> Vectorizing loops</h2>
<p>In general, <code>for</code> loops in R are very slow and we want to avoid them as much as possible. The <code>apply</code> family of functions can be quite helpful for applying a function to each row or column of a matrix or data.frame or to each element of a list.</p>
<p>To test this, instead of a <code>for</code> loop, we will use <code>apply</code>.</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="speeding-up-r.html#cb898-1"></a>f4.apply &lt;-<span class="st"> </span><span class="cf">function</span>( input ){</span>
<span id="cb898-2"><a href="speeding-up-r.html#cb898-2"></a>  output &lt;-<span class="st"> </span><span class="kw">apply</span>(input, <span class="dv">1</span>, which.max)  <span class="co"># 1 = apply to rows</span></span>
<span id="cb898-3"><a href="speeding-up-r.html#cb898-3"></a>  <span class="kw">return</span>(output)</span>
<span id="cb898-4"><a href="speeding-up-r.html#cb898-4"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb899-1"><a href="speeding-up-r.html#cb899-1"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb899-2"><a href="speeding-up-r.html#cb899-2"></a>  <span class="kw">f1</span>(data),</span>
<span id="cb899-3"><a href="speeding-up-r.html#cb899-3"></a>  <span class="kw">f4.apply</span>(data)</span>
<span id="cb899-4"><a href="speeding-up-r.html#cb899-4"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Unit: microseconds
##            expr  min   lq mean median   uq   max neval
##        f1(data) 3638 4223 5169   4697 5506 10765   100
##  f4.apply(data)  282  340  478    391  516  2959   100</code></pre>
<p>This is the type of speed up that matters. We have a 10-fold speed up in execution time and particularly the maximum time has dropped impressively.</p>
<p>Unfortunately, I have always found the <code>apply</code> functions a little cumbersome and I prefer to use <code>dplyr</code> functions for readability. For this example, we’ll compare summarizing each column by calculating the mean.</p>
<p>First for a small sample sized data:</p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb901-1"><a href="speeding-up-r.html#cb901-1"></a>data &lt;-<span class="st"> </span><span class="kw">make.data</span>(<span class="dv">1000</span>)</span>
<span id="cb901-2"><a href="speeding-up-r.html#cb901-2"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb901-3"><a href="speeding-up-r.html#cb901-3"></a>  data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">apply</span>(<span class="dv">2</span>, mean),</span>
<span id="cb901-4"><a href="speeding-up-r.html#cb901-4"></a>  data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(mean) </span>
<span id="cb901-5"><a href="speeding-up-r.html#cb901-5"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Unit: microseconds
##                          expr min  lq mean median   uq  max neval cld
##       data %&gt;% apply(2, mean) 243 280  369    337  413  855   100  a 
##  data %&gt;% summarize_all(mean) 724 915 1334   1192 1429 7023   100   b</code></pre>
<p>Unfortunately <code>dplyr</code> is a lot slower than <code>apply</code> in this case. I wonder if the dynamics would change with a larger <code>n</code>?</p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="speeding-up-r.html#cb903-1"></a>data &lt;-<span class="st"> </span><span class="kw">make.data</span>(<span class="dv">1000000</span>)</span>
<span id="cb903-2"><a href="speeding-up-r.html#cb903-2"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb903-3"><a href="speeding-up-r.html#cb903-3"></a>  data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">apply</span>(<span class="dv">2</span>, mean),</span>
<span id="cb903-4"><a href="speeding-up-r.html#cb903-4"></a>  data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(mean) </span>
<span id="cb903-5"><a href="speeding-up-r.html#cb903-5"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Unit: milliseconds
##                          expr  min   lq  mean median    uq max neval cld
##       data %&gt;% apply(2, mean) 67.1 81.1 151.9   97.0 190.5 677   100   b
##  data %&gt;% summarize_all(mean)  9.6 11.1  16.9   12.9  18.8 123   100  a</code></pre>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb905-1"><a href="speeding-up-r.html#cb905-1"></a>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">apply</span>(<span class="dv">2</span>, mean)</span></code></pre></div>
<pre><code>##     Norm     Pois    Gamma      Exp 
## 5.000913 5.000311 6.007382 4.993895</code></pre>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="speeding-up-r.html#cb907-1"></a>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(mean) </span></code></pre></div>
<pre><code>##       Norm     Pois    Gamma      Exp
## 1 5.000913 5.000311 6.007382 4.993895</code></pre>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb909-1"><a href="speeding-up-r.html#cb909-1"></a>f5.dplyr &lt;-<span class="st"> </span><span class="cf">function</span>( input ){</span>
<span id="cb909-2"><a href="speeding-up-r.html#cb909-2"></a>  input <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb909-3"><a href="speeding-up-r.html#cb909-3"></a><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># equivalent to group_by( each row )</span></span>
<span id="cb909-4"><a href="speeding-up-r.html#cb909-4"></a><span class="st">    </span><span class="kw">mutate</span>( <span class="dt">max.col=</span><span class="kw">which.max</span>(<span class="kw">c</span>(Norm, Pois, Gamma, Exp) ) ) <span class="op">%&gt;%</span></span>
<span id="cb909-5"><a href="speeding-up-r.html#cb909-5"></a><span class="st">    </span><span class="kw">pull</span>(max.col) <span class="op">%&gt;%</span></span>
<span id="cb909-6"><a href="speeding-up-r.html#cb909-6"></a><span class="st">    </span><span class="kw">return</span>()</span>
<span id="cb909-7"><a href="speeding-up-r.html#cb909-7"></a>}</span></code></pre></div>
<p>What just happened? The package <code>dplyr</code> is designed to work well for large data sets, and utilizes a modified structure, called a <code>tibble</code>, which provides massive benefits for large tables, but at the small scale, the overhead of converting the <code>data.frame</code> to a <code>tibble</code> overwhelms any speed up. But because the small sample case is already fast enough to not be noticeable, we don’t really care about the small <code>n</code> case.</p>
</div>
<div id="parallel-processing" class="section level2">
<h2><span class="header-section-number">19.3</span> Parallel Processing</h2>
<p>Most modern computers have multiple computing cores, and can run muliple processes at the same time. Sometimes this means that you can run multiple programs and switch back and forth easily without lag, but we are now interested in using as many cores as possible to get our statistical calculations completed by using muliple processing cores at the same time. This is referred to as running the process “in parallel” and there are many tasks in modern statistical computing that are “embarrassingly easily parallelized”. In particular bootstrapping and cross validation techniques are extremely easy to implement in a parallel fashion.</p>
<p>However, running commands in parallel incurs some overhead cost in set up computation, as well as all the message passing from core to core. For example, to have 5 cores all perform an analysis on a set of data, all 5 cores must have access to the data, and not overwrite any of it. So parallelizing code only makes sense if the individual steps that we pass to each core is of sufficient size that the overhead incurred is substantially less than the time to run the job.</p>
<p>We should think of executing code in parallel as having three major steps:
1. Tell R that there are multiple computing cores available and to set up a useable cluster to which we can pass jobs to.
2. Decide what ‘computational chunk’ should be sent to each core and distribute all necessary data, libraries, etc to each core.
3. Combine the results of each core back into a unified object.</p>
</div>
<div id="parallel-aware-functions" class="section level2">
<h2><span class="header-section-number">19.4</span> Parallel Aware Functions</h2>
<p>There are many packages that address problems that are “embarrassingly easily parallelized” and they will happily work with multiple cores. Methods that rely on re-sampling certainly fit into this category.</p>
<p>The first step is letting R know it has access to multiple cores. This is quite simple using the <code>doMC</code> package (aka the <em>do Multi-Core</em> package).</p>
<p>The registration of multiple cores is actually pretty easy.</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="speeding-up-r.html#cb910-1"></a>doMC<span class="op">::</span><span class="kw">registerDoMC</span>(<span class="dt">cores =</span> <span class="dv">2</span>)  <span class="co"># my laptop only has two cores.</span></span></code></pre></div>
<div id="bootboot" class="section level3">
<h3><span class="header-section-number">19.4.1</span> <code>boot::boot</code></h3>
<p>Bootstrapping relies on re-sampling the dataset and calculating test statistics from each re-sample. In R, the most common way to do this is using the package <code>boot</code> and we just need to tell the <code>boot</code> function, to use the multiple cores available. (Note, we have to have registered the cores first!)</p>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb911-1"><a href="speeding-up-r.html#cb911-1"></a><span class="co"># make the trees dataset a bit larger,</span></span>
<span id="cb911-2"><a href="speeding-up-r.html#cb911-2"></a><span class="co"># just so the overhead cost isn&#39;t as large</span></span>
<span id="cb911-3"><a href="speeding-up-r.html#cb911-3"></a><span class="co"># compared to the computation of the regression</span></span>
<span id="cb911-4"><a href="speeding-up-r.html#cb911-4"></a><span class="co"># coefficients.</span></span>
<span id="cb911-5"><a href="speeding-up-r.html#cb911-5"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>){</span>
<span id="cb911-6"><a href="speeding-up-r.html#cb911-6"></a>  trees &lt;-<span class="st"> </span><span class="kw">rbind</span>(trees, trees)</span>
<span id="cb911-7"><a href="speeding-up-r.html#cb911-7"></a>}</span>
<span id="cb911-8"><a href="speeding-up-r.html#cb911-8"></a></span>
<span id="cb911-9"><a href="speeding-up-r.html#cb911-9"></a><span class="co"># define the model using the original sample data</span></span>
<span id="cb911-10"><a href="speeding-up-r.html#cb911-10"></a>model &lt;-<span class="st"> </span><span class="kw">lm</span>( Volume <span class="op">~</span><span class="st"> </span>Girth, <span class="dt">data=</span>trees)</span>
<span id="cb911-11"><a href="speeding-up-r.html#cb911-11"></a></span>
<span id="cb911-12"><a href="speeding-up-r.html#cb911-12"></a><span class="co"># define a function that calculates the model parameters</span></span>
<span id="cb911-13"><a href="speeding-up-r.html#cb911-13"></a><span class="co"># given an index of which data points to use.</span></span>
<span id="cb911-14"><a href="speeding-up-r.html#cb911-14"></a>my.fun &lt;-<span class="st"> </span><span class="cf">function</span>(df, index){</span>
<span id="cb911-15"><a href="speeding-up-r.html#cb911-15"></a>  model.star &lt;-<span class="st"> </span><span class="kw">lm</span>( Volume <span class="op">~</span><span class="st"> </span>Girth, <span class="dt">data=</span> trees[index,] )</span>
<span id="cb911-16"><a href="speeding-up-r.html#cb911-16"></a>  model.star<span class="op">$</span>coefficients </span>
<span id="cb911-17"><a href="speeding-up-r.html#cb911-17"></a>}</span>
<span id="cb911-18"><a href="speeding-up-r.html#cb911-18"></a></span>
<span id="cb911-19"><a href="speeding-up-r.html#cb911-19"></a><span class="co"># the boot::boot() function has a parallel option we just need </span></span>
<span id="cb911-20"><a href="speeding-up-r.html#cb911-20"></a><span class="co"># to switch on</span></span>
<span id="cb911-21"><a href="speeding-up-r.html#cb911-21"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb911-22"><a href="speeding-up-r.html#cb911-22"></a>  <span class="dt">serial   =</span> boot<span class="op">::</span><span class="kw">boot</span>( trees, my.fun, <span class="dt">R=</span><span class="dv">1000</span> ),</span>
<span id="cb911-23"><a href="speeding-up-r.html#cb911-23"></a>  <span class="dt">parallel =</span> boot<span class="op">::</span><span class="kw">boot</span>( trees, my.fun, <span class="dt">R=</span><span class="dv">1000</span>, </span>
<span id="cb911-24"><a href="speeding-up-r.html#cb911-24"></a>                         <span class="dt">parallel=</span><span class="st">&#39;multicore&#39;</span>, <span class="dt">ncpus=</span><span class="dv">2</span> ) </span>
<span id="cb911-25"><a href="speeding-up-r.html#cb911-25"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Unit: milliseconds
##      expr min  lq mean median   uq  max neval cld
##    serial 829 898  985    931 1076 1554   100   b
##  parallel 629 653  759    675  739 1391   100  a</code></pre>
<p>In this case, we had a bit of a speed up, but not a factor of 2. This is due to the overhead of splitting the job across both cores.</p>
</div>
<div id="carettrain" class="section level3">
<h3><span class="header-section-number">19.4.2</span> <code>caret::train</code></h3>
<p>The statistical learning package <code>caret</code> also handles all the work to do cross validation in a parallel computing environment. The functions in <code>caret</code> have an option <code>allowParallel</code> which by default is TRUE, which controls if we should use all the cores. Assuming we have already registered the number of cores, then by default <code>caret</code> will use them all.</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="speeding-up-r.html#cb913-1"></a><span class="kw">library</span>(caret)</span>
<span id="cb913-2"><a href="speeding-up-r.html#cb913-2"></a></span>
<span id="cb913-3"><a href="speeding-up-r.html#cb913-3"></a><span class="co"># Remember to register how many cores to use!</span></span>
<span id="cb913-4"><a href="speeding-up-r.html#cb913-4"></a>doMC<span class="op">::</span><span class="kw">registerDoMC</span>(<span class="dt">cores =</span> <span class="dv">2</span>)  <span class="co"># my laptop only has two cores.</span></span>
<span id="cb913-5"><a href="speeding-up-r.html#cb913-5"></a></span>
<span id="cb913-6"><a href="speeding-up-r.html#cb913-6"></a>caret.model &lt;-<span class="st"> </span><span class="cf">function</span>(parallel){</span>
<span id="cb913-7"><a href="speeding-up-r.html#cb913-7"></a>  grid &lt;-<span class="st"> </span><span class="kw">data.frame</span>( </span>
<span id="cb913-8"><a href="speeding-up-r.html#cb913-8"></a>    <span class="dt">alpha  =</span> <span class="dv">1</span>,  <span class="co"># 1 =&gt; Lasso Regression</span></span>
<span id="cb913-9"><a href="speeding-up-r.html#cb913-9"></a>    <span class="dt">lambda =</span> <span class="kw">exp</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">1</span>, <span class="dt">length=</span><span class="dv">50</span>)))</span>
<span id="cb913-10"><a href="speeding-up-r.html#cb913-10"></a>  ctrl &lt;-<span class="st"> </span><span class="kw">trainControl</span>( </span>
<span id="cb913-11"><a href="speeding-up-r.html#cb913-11"></a>    <span class="dt">method=</span><span class="st">&#39;repeatedcv&#39;</span>, <span class="dt">number=</span><span class="dv">5</span>, <span class="dt">repeats=</span><span class="dv">4</span>,  </span>
<span id="cb913-12"><a href="speeding-up-r.html#cb913-12"></a>    <span class="dt">preProcOptions =</span> <span class="kw">c</span>(<span class="st">&#39;center&#39;</span>,<span class="st">&#39;scale&#39;</span>),</span>
<span id="cb913-13"><a href="speeding-up-r.html#cb913-13"></a>    <span class="dt">allowParallel =</span> parallel)</span>
<span id="cb913-14"><a href="speeding-up-r.html#cb913-14"></a>  model &lt;-<span class="st"> </span><span class="kw">train</span>( </span>
<span id="cb913-15"><a href="speeding-up-r.html#cb913-15"></a>    lpsa <span class="op">~</span><span class="st"> </span>. <span class="op">-</span>svi, <span class="dt">data=</span>prostate, <span class="dt">method=</span><span class="st">&#39;glmnet&#39;</span>,</span>
<span id="cb913-16"><a href="speeding-up-r.html#cb913-16"></a>    <span class="dt">trControl=</span>ctrl, </span>
<span id="cb913-17"><a href="speeding-up-r.html#cb913-17"></a>    <span class="dt">tuneGrid=</span>grid, </span>
<span id="cb913-18"><a href="speeding-up-r.html#cb913-18"></a>    <span class="dt">lambda =</span> grid<span class="op">$</span>lambda )</span>
<span id="cb913-19"><a href="speeding-up-r.html#cb913-19"></a>  <span class="kw">return</span>(model)</span>
<span id="cb913-20"><a href="speeding-up-r.html#cb913-20"></a>}</span>
<span id="cb913-21"><a href="speeding-up-r.html#cb913-21"></a>  </span>
<span id="cb913-22"><a href="speeding-up-r.html#cb913-22"></a><span class="co"># make the dataset a bit larger, just so the overhead</span></span>
<span id="cb913-23"><a href="speeding-up-r.html#cb913-23"></a><span class="co"># of moving to multi-core doesn&#39;t overwhelm the benefits</span></span>
<span id="cb913-24"><a href="speeding-up-r.html#cb913-24"></a><span class="co"># of using two processors. You should never do this</span></span>
<span id="cb913-25"><a href="speeding-up-r.html#cb913-25"></a><span class="co"># in a real analysis!</span></span>
<span id="cb913-26"><a href="speeding-up-r.html#cb913-26"></a><span class="kw">data</span>(<span class="st">&#39;prostate&#39;</span>, <span class="dt">package=</span><span class="st">&#39;faraway&#39;</span>)</span>
<span id="cb913-27"><a href="speeding-up-r.html#cb913-27"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span> ){</span>
<span id="cb913-28"><a href="speeding-up-r.html#cb913-28"></a>  prostate &lt;-<span class="st"> </span><span class="kw">rbind</span>(prostate,prostate)</span>
<span id="cb913-29"><a href="speeding-up-r.html#cb913-29"></a>}</span>
<span id="cb913-30"><a href="speeding-up-r.html#cb913-30"></a></span>
<span id="cb913-31"><a href="speeding-up-r.html#cb913-31"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb913-32"><a href="speeding-up-r.html#cb913-32"></a>  <span class="kw">caret.model</span>(<span class="dt">parallel =</span> <span class="ot">FALSE</span>),</span>
<span id="cb913-33"><a href="speeding-up-r.html#cb913-33"></a>  <span class="kw">caret.model</span>(<span class="dt">parallel =</span> <span class="ot">TRUE</span> )</span>
<span id="cb913-34"><a href="speeding-up-r.html#cb913-34"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Unit: seconds
##                           expr  min   lq mean median   uq  max neval cld
##  caret.model(parallel = FALSE) 2.68 2.72 2.87   2.77 2.91 4.42   100   b
##   caret.model(parallel = TRUE) 1.98 2.05 2.19   2.09 2.20 3.94   100  a</code></pre>
<p>Again, we saw only moderate gains by using both cores, however it didn’t really cost us anything. Because the <code>caret</code> package by default allows parallel processing, it doesn’t hurt to just load the <code>doMC</code> package and register the number of cores. Even in just the two core case, it is a good habit to get into so that when you port your code to a huge computer with many cores, the only thing to change is how many cores you have access to.</p>
</div>
</div>
<div id="parallelizing-for-loops" class="section level2">
<h2><span class="header-section-number">19.5</span> Parallelizing <code>for</code> loops</h2>
<p>One of the easiest ways to parallelize a <code>for</code> loop is using a package called <code>foreach</code>. This package was created by R-Revolutions company that was subsequently bought by Microsoft. They have a nice introduction to the package <a href="https://docs.microsoft.com/en-us/machine-learning-server/r/how-to-revoscaler-distributed-computing-foreach">here</a>.</p>
<p>We will consider an example that is common in modern statistics. We will examine parallel computing utilizing a bootstrap example where we create bootstrap samples for calculating confidence intervals for regression coefficients.</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb915-1"><a href="speeding-up-r.html#cb915-1"></a><span class="kw">ggplot</span>(trees, <span class="kw">aes</span>(<span class="dt">x=</span>Girth, <span class="dt">y=</span>Volume)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="41_SpeedingUpR_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb917-1"><a href="speeding-up-r.html#cb917-1"></a>model &lt;-<span class="st"> </span><span class="kw">lm</span>( Volume <span class="op">~</span><span class="st"> </span>Girth, <span class="dt">data=</span>trees)</span></code></pre></div>
<p>This is how we would do this previously.</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb918-1"><a href="speeding-up-r.html#cb918-1"></a><span class="co"># f is a formula</span></span>
<span id="cb918-2"><a href="speeding-up-r.html#cb918-2"></a><span class="co"># df is the input data frame</span></span>
<span id="cb918-3"><a href="speeding-up-r.html#cb918-3"></a><span class="co"># M is the number of bootstrap iterations</span></span>
<span id="cb918-4"><a href="speeding-up-r.html#cb918-4"></a>boot.for &lt;-<span class="st"> </span><span class="cf">function</span>( f, df, <span class="dt">M=</span><span class="dv">999</span>){</span>
<span id="cb918-5"><a href="speeding-up-r.html#cb918-5"></a>  output &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb918-6"><a href="speeding-up-r.html#cb918-6"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span> ){</span>
<span id="cb918-7"><a href="speeding-up-r.html#cb918-7"></a>    <span class="co"># Do stuff</span></span>
<span id="cb918-8"><a href="speeding-up-r.html#cb918-8"></a>    model.star &lt;-<span class="st"> </span><span class="kw">lm</span>( f, <span class="dt">data=</span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_frac</span>(<span class="dv">1</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>) )</span>
<span id="cb918-9"><a href="speeding-up-r.html#cb918-9"></a>    output[[i]] &lt;-<span class="st"> </span>model.star<span class="op">$</span>coefficients </span>
<span id="cb918-10"><a href="speeding-up-r.html#cb918-10"></a>  }</span>
<span id="cb918-11"><a href="speeding-up-r.html#cb918-11"></a></span>
<span id="cb918-12"><a href="speeding-up-r.html#cb918-12"></a>  <span class="co"># use rbind to put the list of results together into a data.frame</span></span>
<span id="cb918-13"><a href="speeding-up-r.html#cb918-13"></a>  output &lt;-<span class="st"> </span><span class="kw">sapply</span>(output, rbind) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">t</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>()</span>
<span id="cb918-14"><a href="speeding-up-r.html#cb918-14"></a>  <span class="kw">return</span>(output)</span>
<span id="cb918-15"><a href="speeding-up-r.html#cb918-15"></a>}</span></code></pre></div>
<p>We will first ask about how to do the same thing using the function <code>foreach</code></p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="speeding-up-r.html#cb919-1"></a><span class="co"># f is a formula</span></span>
<span id="cb919-2"><a href="speeding-up-r.html#cb919-2"></a><span class="co"># df is the input data frame</span></span>
<span id="cb919-3"><a href="speeding-up-r.html#cb919-3"></a><span class="co"># M is the number of bootstrap iterations</span></span>
<span id="cb919-4"><a href="speeding-up-r.html#cb919-4"></a>boot.foreach &lt;-<span class="st"> </span><span class="cf">function</span>(f, df, <span class="dt">M=</span><span class="dv">999</span>){</span>
<span id="cb919-5"><a href="speeding-up-r.html#cb919-5"></a>  output &lt;-<span class="st"> </span><span class="kw">foreach</span>( <span class="dt">i=</span><span class="dv">1</span><span class="op">:</span><span class="dv">100</span> ) <span class="op">%dopar%</span><span class="st"> </span>{</span>
<span id="cb919-6"><a href="speeding-up-r.html#cb919-6"></a>    <span class="co"># Do stuff</span></span>
<span id="cb919-7"><a href="speeding-up-r.html#cb919-7"></a>    model.star &lt;-<span class="st"> </span><span class="kw">lm</span>( f, <span class="dt">data=</span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_frac</span>(<span class="dv">1</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>) )</span>
<span id="cb919-8"><a href="speeding-up-r.html#cb919-8"></a>    model.star<span class="op">$</span>coefficients </span>
<span id="cb919-9"><a href="speeding-up-r.html#cb919-9"></a>  }</span>
<span id="cb919-10"><a href="speeding-up-r.html#cb919-10"></a>  </span>
<span id="cb919-11"><a href="speeding-up-r.html#cb919-11"></a>  <span class="co"># use rbind to put the list of results together into a data.frame</span></span>
<span id="cb919-12"><a href="speeding-up-r.html#cb919-12"></a>  output &lt;-<span class="st"> </span><span class="kw">sapply</span>(output, rbind) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">t</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>()</span>
<span id="cb919-13"><a href="speeding-up-r.html#cb919-13"></a>  <span class="kw">return</span>(output)</span>
<span id="cb919-14"><a href="speeding-up-r.html#cb919-14"></a>}</span></code></pre></div>
<p>Not much has changed in our code. Lets see which is faster.</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="speeding-up-r.html#cb920-1"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb920-2"><a href="speeding-up-r.html#cb920-2"></a>  <span class="kw">boot.for</span>( Volume<span class="op">~</span>Girth, trees ),</span>
<span id="cb920-3"><a href="speeding-up-r.html#cb920-3"></a>  <span class="kw">boot.foreach</span>( Volume<span class="op">~</span>Girth, trees )</span>
<span id="cb920-4"><a href="speeding-up-r.html#cb920-4"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Unit: milliseconds
##                                 expr min  lq mean median  uq  max neval cld
##      boot.for(Volume ~ Girth, trees) 302 335  388    354 389  790   100   a
##  boot.foreach(Volume ~ Girth, trees) 272 327  406    338 393 1232   100   a</code></pre>
<p>In this case, the overhead associated with splitting the job across two cores, copying the data over, and then combining the results back together was more than we saved by using both cores. If the nugget of computation within each pass of the <code>for</code> loop was larger, then it would pay to use both cores.</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="speeding-up-r.html#cb922-1"></a><span class="co"># massiveTrees has 31000 observations</span></span>
<span id="cb922-2"><a href="speeding-up-r.html#cb922-2"></a>massiveTrees &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb922-3"><a href="speeding-up-r.html#cb922-3"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span> ){</span>
<span id="cb922-4"><a href="speeding-up-r.html#cb922-4"></a>  massiveTrees &lt;-<span class="st"> </span><span class="kw">rbind</span>(massiveTrees, trees)</span>
<span id="cb922-5"><a href="speeding-up-r.html#cb922-5"></a>}</span>
<span id="cb922-6"><a href="speeding-up-r.html#cb922-6"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb922-7"><a href="speeding-up-r.html#cb922-7"></a>  <span class="kw">boot.for</span>( Volume<span class="op">~</span>Girth, massiveTrees )  ,</span>
<span id="cb922-8"><a href="speeding-up-r.html#cb922-8"></a>  <span class="kw">boot.foreach</span>( Volume<span class="op">~</span>Girth, massiveTrees )</span>
<span id="cb922-9"><a href="speeding-up-r.html#cb922-9"></a>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Unit: seconds
##                                        expr  min    lq  mean median    uq  max
##      boot.for(Volume ~ Girth, massiveTrees) 14.2 14.87 15.35  15.21 15.58 21.3
##  boot.foreach(Volume ~ Girth, massiveTrees)  7.7  8.73  9.12   9.02  9.33 11.7
##  neval cld
##    100   b
##    100  a</code></pre>
<p>Because we often generate a bunch of results that we want to see as a data.frame, the <code>foreach</code> function includes a <code>.combine</code> option which allows us to specify a function to do the combining.</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="speeding-up-r.html#cb924-1"></a>output &lt;-<span class="st"> </span><span class="kw">foreach</span>( <span class="dt">i=</span><span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="dt">.combine=</span>rbind ) <span class="op">%dopar%</span><span class="st"> </span>{</span>
<span id="cb924-2"><a href="speeding-up-r.html#cb924-2"></a>  <span class="co"># Do stuff</span></span>
<span id="cb924-3"><a href="speeding-up-r.html#cb924-3"></a>  model.star &lt;-<span class="st"> </span><span class="kw">lm</span>( Volume <span class="op">~</span><span class="st"> </span>Girth, <span class="dt">data=</span> trees <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_frac</span>(<span class="dv">1</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>) )</span>
<span id="cb924-4"><a href="speeding-up-r.html#cb924-4"></a>  model.star<span class="op">$</span>coefficients <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">t</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>()</span>
<span id="cb924-5"><a href="speeding-up-r.html#cb924-5"></a>}</span></code></pre></div>
<p>It is important to recognize that the data.frame <code>trees</code> was utilized inside the <code>foreach</code> loop. So when we called the <code>foreach</code> loop and distributed the workload across the cores, it was smart enough to distribute the data to each core. However, if there were functions that we utilized inside the for loop that came from a package, we need to tell each core to load the function.</p>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb925-1"><a href="speeding-up-r.html#cb925-1"></a>output &lt;-<span class="st"> </span><span class="kw">foreach</span>( <span class="dt">i=</span><span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="dt">.combine=</span>rbind, <span class="dt">.packages=</span><span class="st">&#39;dplyr&#39;</span> ) <span class="op">%dopar%</span><span class="st"> </span>{</span>
<span id="cb925-2"><a href="speeding-up-r.html#cb925-2"></a>  <span class="co"># Do stuff</span></span>
<span id="cb925-3"><a href="speeding-up-r.html#cb925-3"></a>  model.star &lt;-<span class="st"> </span><span class="kw">lm</span>( Volume <span class="op">~</span><span class="st"> </span>Girth, <span class="dt">data=</span> trees <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_frac</span>(<span class="dv">1</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>) )</span>
<span id="cb925-4"><a href="speeding-up-r.html#cb925-4"></a>  model.star<span class="op">$</span>coefficients <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">t</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>()</span>
<span id="cb925-5"><a href="speeding-up-r.html#cb925-5"></a>}</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="databases.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"],
"google": false,
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dereksonderegger/444/blob/master/41_SpeedingUpR.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/dereksonderegger/444/raw/master/41_SpeedingUpR.Rmd",
"text": null
},
"download": [["Introduction_to_DataScience_with_R.pdf", "PDF"]],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
