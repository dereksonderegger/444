<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 4 Graphing using ggplot2 | STA 444/5 - Data wrangling using R</title>
  <meta name="description" content="Chapter 4 Graphing using ggplot2 | STA 444/5 - Data wrangling using R">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 4 Graphing using ggplot2 | STA 444/5 - Data wrangling using R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/Cover1.png" />
  
  <meta name="github-repo" content="dereksonderegger/444" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Graphing using ggplot2 | STA 444/5 - Data wrangling using R" />
  
  
  <meta name="twitter:image" content="images/Cover1.png" />

<meta name="author" content="Derek L. Sonderegger">


<meta name="date" content="2019-07-02">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="3-introduction-to-graphing-using-ggplot2.html">
<link rel="next" href="5-introduction-to-data-wrangling-using-dplyr.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://dereksonderegger.github.io/444/Statistical_Methods_I.pdf" target="blank">PDF version</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="1-familiarization.html"><a href="1-familiarization.html"><i class="fa fa-check"></i><b>1</b> Familiarization</a><ul>
<li class="chapter" data-level="1.1" data-path="1-familiarization.html"><a href="1-familiarization.html#r-file-types"><i class="fa fa-check"></i><b>1.1</b> R file Types</a><ul>
<li class="chapter" data-level="1.1.1" data-path="1-familiarization.html"><a href="1-familiarization.html#r-scripts-.r-files"><i class="fa fa-check"></i><b>1.1.1</b> R Scripts (.R files)</a></li>
<li class="chapter" data-level="1.1.2" data-path="1-familiarization.html"><a href="1-familiarization.html#r-markdown-.rmd-files"><i class="fa fa-check"></i><b>1.1.2</b> R Markdown (.Rmd files)</a></li>
<li class="chapter" data-level="1.1.3" data-path="1-familiarization.html"><a href="1-familiarization.html#r-notebooks-.rmd-files"><i class="fa fa-check"></i><b>1.1.3</b> R Notebooks (.Rmd files)</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="1-familiarization.html"><a href="1-familiarization.html#r-as-a-simple-calculator"><i class="fa fa-check"></i><b>1.2</b> R as a simple calculator</a></li>
<li class="chapter" data-level="1.3" data-path="1-familiarization.html"><a href="1-familiarization.html#assignment"><i class="fa fa-check"></i><b>1.3</b> Assignment</a></li>
<li class="chapter" data-level="1.4" data-path="1-familiarization.html"><a href="1-familiarization.html#packages"><i class="fa fa-check"></i><b>1.4</b> Packages</a></li>
<li class="chapter" data-level="1.5" data-path="1-familiarization.html"><a href="1-familiarization.html#finding-help"><i class="fa fa-check"></i><b>1.5</b> Finding Help</a><ul>
<li class="chapter" data-level="1.5.1" data-path="1-familiarization.html"><a href="1-familiarization.html#how-does-this-function-work"><i class="fa fa-check"></i><b>1.5.1</b> How does this function work?</a></li>
<li class="chapter" data-level="1.5.2" data-path="1-familiarization.html"><a href="1-familiarization.html#how-does-this-package-work"><i class="fa fa-check"></i><b>1.5.2</b> How does this package work?</a></li>
<li class="chapter" data-level="1.5.3" data-path="1-familiarization.html"><a href="1-familiarization.html#how-do-i-do-xxx"><i class="fa fa-check"></i><b>1.5.3</b> How do I do XXX?</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="1-familiarization.html"><a href="1-familiarization.html#exercises"><i class="fa fa-check"></i><b>1.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-introduction-to-data-frames.html"><a href="2-introduction-to-data-frames.html"><i class="fa fa-check"></i><b>2</b> Introduction to Data Frames</a><ul>
<li class="chapter" data-level="2.1" data-path="2-introduction-to-data-frames.html"><a href="2-introduction-to-data-frames.html#introduction-to-importing-data"><i class="fa fa-check"></i><b>2.1</b> Introduction to Importing Data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="2-introduction-to-data-frames.html"><a href="2-introduction-to-data-frames.html#from-a-package"><i class="fa fa-check"></i><b>2.1.1</b> From a Package</a></li>
<li class="chapter" data-level="2.1.2" data-path="2-introduction-to-data-frames.html"><a href="2-introduction-to-data-frames.html#import-from-.csv-or-.xls-files"><i class="fa fa-check"></i><b>2.1.2</b> Import from <code>.csv</code> or <code>.xls</code> files</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="2-introduction-to-data-frames.html"><a href="2-introduction-to-data-frames.html#data-frame-manipulation"><i class="fa fa-check"></i><b>2.2</b> Data Frame Manipulation</a><ul>
<li class="chapter" data-level="2.2.1" data-path="2-introduction-to-data-frames.html"><a href="2-introduction-to-data-frames.html#verbs"><i class="fa fa-check"></i><b>2.2.1</b> Verbs</a></li>
<li class="chapter" data-level="2.2.2" data-path="2-introduction-to-data-frames.html"><a href="2-introduction-to-data-frames.html#split-apply-combine"><i class="fa fa-check"></i><b>2.2.2</b> Split, apply, combine</a></li>
<li class="chapter" data-level="2.2.3" data-path="2-introduction-to-data-frames.html"><a href="2-introduction-to-data-frames.html#chaining-commands-together"><i class="fa fa-check"></i><b>2.2.3</b> Chaining commands together</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="2-introduction-to-data-frames.html"><a href="2-introduction-to-data-frames.html#exercises-1"><i class="fa fa-check"></i><b>2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-introduction-to-graphing-using-ggplot2.html"><a href="3-introduction-to-graphing-using-ggplot2.html"><i class="fa fa-check"></i><b>3</b> Introduction to Graphing using <code>ggplot2</code></a></li>
<li class="chapter" data-level="4" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html"><i class="fa fa-check"></i><b>4</b> Graphing using <code>ggplot2</code></a><ul>
<li class="chapter" data-level="4.1" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#basic-graphs"><i class="fa fa-check"></i><b>4.1</b> Basic Graphs</a><ul>
<li class="chapter" data-level="4.1.1" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#bar-charts"><i class="fa fa-check"></i><b>4.1.1</b> Bar Charts</a></li>
<li class="chapter" data-level="4.1.2" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#histograms"><i class="fa fa-check"></i><b>4.1.2</b> Histograms</a></li>
<li class="chapter" data-level="4.1.3" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#scatterplots"><i class="fa fa-check"></i><b>4.1.3</b> Scatterplots</a></li>
<li class="chapter" data-level="4.1.4" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#box-plots"><i class="fa fa-check"></i><b>4.1.4</b> Box Plots</a></li>
<li class="chapter" data-level="4.1.5" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#labels"><i class="fa fa-check"></i><b>4.1.5</b> Labels</a></li>
<li class="chapter" data-level="4.1.6" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#color-scales"><i class="fa fa-check"></i><b>4.1.6</b> Color Scales</a></li>
<li class="chapter" data-level="4.1.7" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#adjusting-axes"><i class="fa fa-check"></i><b>4.1.7</b> Adjusting axes</a></li>
<li class="chapter" data-level="4.1.8" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#zooming-inout"><i class="fa fa-check"></i><b>4.1.8</b> Zooming in/out</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#cookbook-examples"><i class="fa fa-check"></i><b>4.2</b> Cookbook Examples</a><ul>
<li class="chapter" data-level="4.2.1" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#scatterplot-with-prediction-ribbons"><i class="fa fa-check"></i><b>4.2.1</b> Scatterplot with prediction ribbons</a></li>
<li class="chapter" data-level="4.2.2" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#bar-plot"><i class="fa fa-check"></i><b>4.2.2</b> Bar Plot</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="4-graphing-using-ggplot2.html"><a href="4-graphing-using-ggplot2.html#exercises-2"><i class="fa fa-check"></i><b>4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-introduction-to-data-wrangling-using-dplyr.html"><a href="5-introduction-to-data-wrangling-using-dplyr.html"><i class="fa fa-check"></i><b>5</b> Introduction to Data Wrangling using <code>dplyr</code></a><ul>
<li class="chapter" data-level="5.1" data-path="5-introduction-to-data-wrangling-using-dplyr.html"><a href="5-introduction-to-data-wrangling-using-dplyr.html#mutate-1"><i class="fa fa-check"></i><b>5.1</b> <code>mutate</code></a></li>
<li class="chapter" data-level="5.2" data-path="5-introduction-to-data-wrangling-using-dplyr.html"><a href="5-introduction-to-data-wrangling-using-dplyr.html#group_by"><i class="fa fa-check"></i><b>5.2</b> <code>group_by</code></a></li>
<li class="chapter" data-level="5.3" data-path="5-introduction-to-data-wrangling-using-dplyr.html"><a href="5-introduction-to-data-wrangling-using-dplyr.html#summarize"><i class="fa fa-check"></i><b>5.3</b> <code>summarize</code></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-introduction-to-using-model-objects.html"><a href="6-introduction-to-using-model-objects.html"><i class="fa fa-check"></i><b>6</b> Introduction to using Model Objects</a><ul>
<li class="chapter" data-level="6.1" data-path="6-introduction-to-using-model-objects.html"><a href="6-introduction-to-using-model-objects.html#formula-notation"><i class="fa fa-check"></i><b>6.1</b> formula notation</a></li>
<li class="chapter" data-level="6.2" data-path="6-introduction-to-using-model-objects.html"><a href="6-introduction-to-using-model-objects.html#building-models"><i class="fa fa-check"></i><b>6.2</b> Building models</a><ul>
<li class="chapter" data-level="6.2.1" data-path="6-introduction-to-using-model-objects.html"><a href="6-introduction-to-using-model-objects.html#t-tests"><i class="fa fa-check"></i><b>6.2.1</b> t-tests</a></li>
<li class="chapter" data-level="6.2.2" data-path="6-introduction-to-using-model-objects.html"><a href="6-introduction-to-using-model-objects.html#lm-objects"><i class="fa fa-check"></i><b>6.2.2</b> lm objects</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="6-introduction-to-using-model-objects.html"><a href="6-introduction-to-using-model-objects.html#accessor-function-using-traditional-functions"><i class="fa fa-check"></i><b>6.3</b> Accessor function using traditional functions</a></li>
<li class="chapter" data-level="6.4" data-path="6-introduction-to-using-model-objects.html"><a href="6-introduction-to-using-model-objects.html#accessing-model-results-using-broom"><i class="fa fa-check"></i><b>6.4</b> Accessing model results using <code>broom</code></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-graphing-data-and-model-results.html"><a href="7-graphing-data-and-model-results.html"><i class="fa fa-check"></i><b>7</b> Graphing data and model results</a><ul>
<li class="chapter" data-level="7.1" data-path="7-graphing-data-and-model-results.html"><a href="7-graphing-data-and-model-results.html#process"><i class="fa fa-check"></i><b>7.1</b> Process</a></li>
<li class="chapter" data-level="7.2" data-path="7-graphing-data-and-model-results.html"><a href="7-graphing-data-and-model-results.html#augmenting-data-with-model-output"><i class="fa fa-check"></i><b>7.2</b> Augmenting data with model output</a></li>
<li class="chapter" data-level="7.3" data-path="7-graphing-data-and-model-results.html"><a href="7-graphing-data-and-model-results.html#plotting-using-ggplot2"><i class="fa fa-check"></i><b>7.3</b> Plotting using <code>ggplot2</code></a></li>
</ul></li>
<li class="part"><span><b>Deeper Details</b></span></li>
<li class="chapter" data-level="8" data-path="8-factors.html"><a href="8-factors.html"><i class="fa fa-check"></i><b>8</b> Factors</a><ul>
<li class="chapter" data-level="8.1" data-path="8-factors.html"><a href="8-factors.html#how-factors-are-stored"><i class="fa fa-check"></i><b>8.1</b> How factors are stored</a></li>
<li class="chapter" data-level="8.2" data-path="8-factors.html"><a href="8-factors.html#using-forcats"><i class="fa fa-check"></i><b>8.2</b> Using <code>forcats</code></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="9-data-frames-tibbles-oh-my.html"><a href="9-data-frames-tibbles-oh-my.html"><i class="fa fa-check"></i><b>9</b> Data Frames, tibbles, oh my!</a><ul>
<li class="chapter" data-level="9.1" data-path="9-data-frames-tibbles-oh-my.html"><a href="9-data-frames-tibbles-oh-my.html#why-extend-the-data-frame"><i class="fa fa-check"></i><b>9.1</b> Why extend the data frame</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-data-import.html"><a href="10-data-import.html"><i class="fa fa-check"></i><b>10</b> Data Import</a></li>
<li class="chapter" data-level="11" data-path="11-data-frame-manipulation-using-dplyr.html"><a href="11-data-frame-manipulation-using-dplyr.html"><i class="fa fa-check"></i><b>11</b> Data frame Manipulation using dplyr</a></li>
<li class="chapter" data-level="12" data-path="12-data-frame.html"><a href="12-data-frame.html"><i class="fa fa-check"></i><b>12</b> Data frame</a><ul>
<li class="chapter" data-level="12.1" data-path="12-data-frame.html"><a href="12-data-frame.html#reshaping"><i class="fa fa-check"></i><b>12.1</b> reshaping</a></li>
<li class="chapter" data-level="12.2" data-path="12-data-frame.html"><a href="12-data-frame.html#merges"><i class="fa fa-check"></i><b>12.2</b> merges</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="13-more-ggplot2.html"><a href="13-more-ggplot2.html"><i class="fa fa-check"></i><b>13</b> More ggplot2</a></li>
<li class="chapter" data-level="14" data-path="14-flow-control.html"><a href="14-flow-control.html"><i class="fa fa-check"></i><b>14</b> Flow Control</a></li>
<li class="chapter" data-level="15" data-path="15-functions.html"><a href="15-functions.html"><i class="fa fa-check"></i><b>15</b> Functions</a></li>
<li class="chapter" data-level="16" data-path="16-strings.html"><a href="16-strings.html"><i class="fa fa-check"></i><b>16</b> Strings</a></li>
<li class="chapter" data-level="17" data-path="17-dates.html"><a href="17-dates.html"><i class="fa fa-check"></i><b>17</b> Dates</a></li>
<li class="chapter" data-level="18" data-path="18-performance-issues.html"><a href="18-performance-issues.html"><i class="fa fa-check"></i><b>18</b> Performance Issues</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STA 444/5 - Data wrangling using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="graphing-using-ggplot2" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Graphing using <code>ggplot2</code></h1>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)  <span class="co"># my favorite graphing system</span>
<span class="kw">library</span>(dplyr)    <span class="co"># data frame manipulations</span></code></pre>
<p>There are three major “systems” of making graphs in R. The basic plotting commands in R are quite effective but the commands do not have a way of being combined in easy ways. Lattice graphics (which the <code>mosaic</code> package uses) makes it possible to create some quite complicated graphs but it is very difficult to do make non-standard graphs. The last package, <code>ggplot2</code> tries to not anticipate what the user wants to do, but rather provide the mechanisms for pulling together different graphical concepts and the user gets to decide which elements to combine.</p>
<p>To make the most of <code>ggplot2</code> it is important to wrap your mind around “The Grammar of Graphics”. Briefly, the act of building a graph can be broken down into three steps.</p>
<ol style="list-style-type: decimal">
<li><p>Define what data we are using.</p></li>
<li><p>What is the major relationship we wish to examine?</p></li>
<li><p>In what way should we present that relationship? These relationships can be presented in multiple ways, and the process of creating a good graph relies on building layers upon layers of information. For example, we might start with printing the raw data and then overlay a regression line over the top.</p></li>
</ol>
<p>Next, it should be noted that <code>ggplot2</code> is designed to act on data frames. It is actually hard to just draw three data points and for simple graphs it might be easier to use the base graphing system in R. However for any real data analysis project, the data will already be in a data frame and this is not an annoyance.</p>
<p>These notes are sufficient for creating simple graphs using <code>ggplot2</code>, but are not intended to be exhaustive. There are many places online to get help with <code>ggplot2</code>. One very nice resource is the website, <a href="http://www.cookbook-r.com/Graphs/">http://www.cookbook-r.com/Graphs/</a>, which gives much of the information available in the book R Graphics Cookbook which I highly recommend. Second is just googling your problems and see what you can find on websites such as StackExchange.</p>
<p>One way that <code>ggplot2</code> makes it easy to form very complicated graphs is that it provides a large number of basic building blocks that, when stacked upon each other, can produce extremely complicated graphs. A full list is available at <a href="http://docs.ggplot2.org/current/">http://docs.ggplot2.org/current/</a> but the following list gives some idea of different building blocks. These different geometries are different ways to display the relationship between variables and can be combined in many interesting ways.</p>
<table>
<thead>
<tr class="header">
<th>Geom</th>
<th>Description</th>
<th>Required Aesthetics</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>geom_histogram</code></td>
<td>A histogram</td>
<td><code>x</code></td>
</tr>
<tr class="even">
<td><code>geom_bar</code></td>
<td>A barplot</td>
<td><code>x</code></td>
</tr>
<tr class="odd">
<td><code>geom_density</code></td>
<td>A density plot of data. (smoothed histogram)</td>
<td><code>x</code></td>
</tr>
<tr class="even">
<td><code>geom_boxplot</code></td>
<td>Boxplots</td>
<td><code>x, y</code></td>
</tr>
<tr class="odd">
<td><code>geom_line</code></td>
<td>Draw a line (after sorting x-values)</td>
<td><code>x, y</code></td>
</tr>
<tr class="even">
<td><code>geom_path</code></td>
<td>Draw a line (without sorting x-values)</td>
<td><code>x, y</code></td>
</tr>
<tr class="odd">
<td><code>geom_point</code></td>
<td>Draw points (for a scatterplot)</td>
<td><code>x, y</code></td>
</tr>
<tr class="even">
<td><code>geom_smooth</code></td>
<td>Add a ribbon that summarizes a scatterplot</td>
<td><code>x, y</code></td>
</tr>
<tr class="odd">
<td><code>geom_ribbon</code></td>
<td>Enclose a region, and color the interior</td>
<td><code>ymin, ymax</code></td>
</tr>
<tr class="even">
<td><code>geom_errorbar</code></td>
<td>Error bars</td>
<td><code>ymin, ymax</code></td>
</tr>
<tr class="odd">
<td><code>geom_text</code></td>
<td>Add text to a graph</td>
<td><code>x, y, label</code></td>
</tr>
<tr class="even">
<td><code>geom_label</code></td>
<td>Add text to a graph</td>
<td><code>x, y, label</code></td>
</tr>
<tr class="odd">
<td><code>geom_tile</code></td>
<td>Create Heat map</td>
<td><code>x, y, fill</code></td>
</tr>
</tbody>
</table>
<p>A graph can be built up layer by layer, where:</p>
<ul>
<li>Each layer corresponds to a <code>geom</code>, each of which requires a dataset and a mapping between an aesthetic and a column of the data set.
<ul>
<li>If you don’t specify either, then the layer inherits everything defined in the <code>ggplot()</code> command.</li>
<li>You can have different datasets for each layer!</li>
</ul></li>
<li>Layers can be added with a <code>+</code>, or you can define two plots and add them together (second one over-writes anything that conflicts).</li>
</ul>
<div id="basic-graphs" class="section level2">
<h2><span class="header-section-number">4.1</span> Basic Graphs</h2>
<div id="bar-charts" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Bar Charts</h3>
<p>Bar charts and histograms are how we think about displaying informtion about a single covariate. That is to say, we are not trying to make a graph of the relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, but rather understanding what values of <span class="math inline">\(x\)</span> are present and how frequently they show up.</p>
<p>For displaying a categorical variable on the x-axis, a bar chart is a good option. Here we consider a data set that gives the fuel efficiency of different classes of vehicles in two different years. This is a subset of data that the EPA makes available on <a href="http://fueleconomy.gov">http://fueleconomy.gov</a>. It contains only model which had a new release every year between 1999 and 2008 and therefore represents the most popular cars sold in the US. It includes information for each model for years 1999 and 2008. The dataset is included in the <code>ggplot2</code> package as <code>mpg</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(mpg, <span class="dt">package=</span><span class="st">&#39;ggplot2&#39;</span>)  <span class="co"># load the dataset</span>
<span class="kw">str</span>(mpg)</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    234 obs. of  11 variables:
##  $ manufacturer: chr  &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; ...
##  $ model       : chr  &quot;a4&quot; &quot;a4&quot; &quot;a4&quot; &quot;a4&quot; ...
##  $ displ       : num  1.8 1.8 2 2 2.8 2.8 3.1 1.8 1.8 2 ...
##  $ year        : int  1999 1999 2008 2008 1999 1999 2008 1999 1999 2008 ...
##  $ cyl         : int  4 4 4 4 6 6 6 4 4 4 ...
##  $ trans       : chr  &quot;auto(l5)&quot; &quot;manual(m5)&quot; &quot;manual(m6)&quot; &quot;auto(av)&quot; ...
##  $ drv         : chr  &quot;f&quot; &quot;f&quot; &quot;f&quot; &quot;f&quot; ...
##  $ cty         : int  18 21 20 21 16 18 18 18 16 20 ...
##  $ hwy         : int  29 29 31 30 26 26 27 26 25 28 ...
##  $ fl          : chr  &quot;p&quot; &quot;p&quot; &quot;p&quot; &quot;p&quot; ...
##  $ class       : chr  &quot;compact&quot; &quot;compact&quot; &quot;compact&quot; &quot;compact&quot; ...</code></pre>
<p>First we could summarize the data by how many models there are in the different classes.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>mpg, <span class="kw">aes</span>(<span class="dt">x=</span>class)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<ol style="list-style-type: decimal">
<li><p>The data set we wish to use is specified using <code>data=mpg</code>. This is the first argument defined in the function, so you could skip the <code>data=</code> part if the input data.frame is the first argument.</p></li>
<li><p>The column in the data that we wish to investigate is defined in the <code>aes(x=class)</code> part. This means the x-axis will be the car’s class, which is indicated by the column named <code>class</code>.</p></li>
<li><p>The way we want to display this information is using a bar chart.</p></li>
</ol>
<p>By default, the <code>geom_bar()</code> just counts the number of cases and displays how many observations were in each factor level. If I have a data frame that I have already summarized, <code>geom_col</code> will allow you to set the height of the bar by a <span class="math inline">\(y\)</span> column.</p>
</div>
<div id="histograms" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Histograms</h3>
<p>Histograms perform a similar task as a bar graph, but with continuous numerical data. It focuses on a single variable and gives how frequently particular ranges of the data occur.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x=</span>hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_histogram</span>()</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Just as <code>geom_bar</code> by default calculated the number of observations in each level of my factor of interest, <code>geom_histogram</code> breaks up the x-axis into distinct bins (by default, 30 bins), and then counts how many observations fall into each bin, and displys the number as a bar. To change the number of bins, we could either tell it the number of bins (e.g. <code>bins=20</code>) or the width of each bin (e.g. <code>binwidth=4</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x=</span>hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">8</span>)       <span class="co"># 8 bins</span></code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Often we want to rescale the y-axis so that it is in terms of density, which is
<span class="math display">\[density=\frac{\#\;observations\;in\;bin}{total\;number\;observations}\cdot\frac{1}{bin\;width}\]</span></p>
<p>To ask <code>geom_histogram</code> to calculate the density instead of counts, we simply add an option to the <code>aes()</code> list that specifies that the y-axis should be the density. Notice that this only rescales the y-axis and the shape of the histogram is identical.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x=</span>hwy, <span class="dt">y=</span>..density..)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">8</span>)       <span class="co"># 8 bins</span></code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="scatterplots" class="section level3">
<h3><span class="header-section-number">4.1.3</span> Scatterplots</h3>
<p>To start with, we’ll make a very simple scatterplot using the <code>iris</code> dataset. Recall that the <code>iris</code> dataset contains observations on 150 iris plants where we’ve measured the length and width of the petals and sepals. We will make a scatterplot of <code>Sepal.Length</code> versus <code>Petal.Length</code>, which are two columns in the dataset.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(iris)  <span class="co"># load the iris dataset that comes with R</span>
<span class="kw">str</span>(iris)   <span class="co"># what columns do we have to play with...</span></code></pre>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  5 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>( <span class="dt">data=</span>iris, <span class="kw">aes</span>(<span class="dt">x=</span>Sepal.Length, <span class="dt">y=</span>Petal.Length) ) <span class="op">+</span><span class="st">  </span>
<span class="st">    </span><span class="kw">geom_point</span>(  )</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<ol style="list-style-type: decimal">
<li><p>The data set we wish to use is specified using <code>data=iris</code>.</p></li>
<li><p>The relationship we want to explore is <code>x=Sepal.Length</code> and <code>y=Petal.Length</code>. This means the x-axis will be the Sepal Length and the y-axis will be the Petal Length.</p></li>
<li><p>The way we want to display this relationship is through graphing 1 point for every observation.</p></li>
</ol>
<p>We can define other attributes that might reflect other aspects of the data. For example, we might want for the color of the data point to change dynamically based on the species of iris.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>( <span class="dt">data=</span>iris, <span class="kw">aes</span>(<span class="dt">x=</span>Sepal.Length, <span class="dt">y=</span>Petal.Length, <span class="dt">color=</span>Species) ) <span class="op">+</span><span class="st">  </span>
<span class="st">    </span><span class="kw">geom_point</span>(  )</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>The <code>aes()</code> command inside the previous section of code is quite mysterious. The way to think about the <code>aes()</code> is that it gives you a way to define relationships that are data dependent. In the previous graph, the x-value and y-value for each point was defined dynamically by the data, as was the color. If we just wanted all the data points to be colored blue and larger, then the following code would do that</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>( <span class="dt">data=</span>iris, <span class="kw">aes</span>(<span class="dt">x=</span>Sepal.Length, <span class="dt">y=</span>Petal.Length) ) <span class="op">+</span><span class="st">  </span>
<span class="st">    </span><span class="kw">geom_point</span>( <span class="dt">color=</span><span class="st">&#39;blue&#39;</span>, <span class="dt">size=</span><span class="dv">4</span> )</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>The important part isn’t that color and size were defined in the <code>geom_point()</code> but that they were defined outside of an <code>aes()</code> function!</p>
<ol style="list-style-type: decimal">
<li><p>Anything set inside an <code>aes()</code> command will be of the form <code>attribute=Column_Name</code> and will change based on the data.</p></li>
<li><p>Anything set outside an <code>aes()</code> command will be in the form <code>attribute=value</code> and will be fixed.</p></li>
</ol>
</div>
<div id="box-plots" class="section level3">
<h3><span class="header-section-number">4.1.4</span> Box Plots</h3>
<p>Boxplots are a common way to show a categorical variable on the x-axis and continuous on the y-axis.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x=</span>class, <span class="dt">y=</span>hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>The boxes show the <span class="math inline">\(25^{th}\)</span>, <span class="math inline">\(50^{th}\)</span>, and <span class="math inline">\(75^{th}\)</span> percentile and the lines coming off the box extend to the smallest and largest non-outlier observation.</p>
</div>
<div id="labels" class="section level3">
<h3><span class="header-section-number">4.1.5</span> Labels</h3>
<p>To make a graph more understandable, it is necessary to tweak labels for the axes and add a main title and such. Here we’ll adjust labels in a graph, including the legend labels.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Treat the number of cylinders in a car as a categorical variable (4,6 or 8)</span>
mtcars<span class="op">$</span>cyl &lt;-<span class="st"> </span><span class="kw">factor</span>(mtcars<span class="op">$</span>cyl) 

<span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x=</span>wt, <span class="dt">y=</span>mpg, <span class="dt">col=</span>cyl)) <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>( <span class="dt">title=</span><span class="st">&#39;Weight vs Miles per Gallon&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>( <span class="dt">x=</span><span class="st">&quot;Weight in tons (2000 lbs)&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Miles per Gallon (US)&quot;</span> ) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>( <span class="dt">color=</span><span class="st">&quot;Cylinders&quot;</span>)     </code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>You could either call the <code>labs()</code> command repeatedly with each label, or you could provide multiple arguements to just one <code>labs()</code> call.</p>
</div>
<div id="color-scales" class="section level3">
<h3><span class="header-section-number">4.1.6</span> Color Scales</h3>
<p>Adjusting the color palette for the color scales is not particularly hard, but it isn’t intuitive. You can either set them up using a set of predefined palettes or you can straight up pick the colors. Furthermore we need to recognize that picking colors for a continuous covariate is different than for a factor. In the continuous case, we have to pick a low and high colors and <code>ggplot</code> will smoothly transition between the two. In the discrete case with a factor, each factor level gets its own color.</p>
<p>To make these choices, we will use the functions that modify the scales. In particular, if we are modifying the <code>color</code> aesthetic, we will use the <code>scale_color_XXX</code> functions where the <code>XXX</code> gets replaced by something more specific. If we are modifying the <code>fill</code> colors, then we will use the <code>scale_fill_XXX</code> family of functions.</p>
<div id="colors-for-factors" class="section level4">
<h4><span class="header-section-number">4.1.6.1</span> Colors for Factors</h4>
<p>We can set the colors manually using the function <code>scale_color_manual</code> which expects the name of the colors for each factor level. The order given in the <code>values</code> argument corresponds to the order of the levels of the factor.</p>
<p>For a nice list of the named colors you can use, I like to refer to this webpage: <a href="https://www.nceas.ucsb.edu/~frazier/RSpatialGuides/colorPaletteCheatsheet.pdf">https://www.nceas.ucsb.edu/~frazier/RSpatialGuides/colorPaletteCheatsheet.pdf</a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Sepal.Width, <span class="dt">y=</span>Sepal.Length, <span class="dt">color=</span>Species)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&#39;blue&#39;</span>, <span class="st">&#39;darkmagenta&#39;</span>, <span class="st">&#39;aquamarine&#39;</span>))</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>If you want to instead pick a color palette and let the palette pick the colors to be farthest apart based on the number of factor levels, you can use <code>scale_color_manual</code> and then have the values chosen by one of the palette functions where you just have to tell it how many levels you have.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(colorspace)   <span class="co"># these two packages have some decent </span>
<span class="kw">library</span>(grDevices)    <span class="co"># color palettes functions.</span>

<span class="kw">rainbow</span>(<span class="dv">6</span>)   <span class="co"># if we have six factor levels, what colors should we use? </span></code></pre>
<pre><code>## [1] &quot;#FF0000FF&quot; &quot;#FFFF00FF&quot; &quot;#00FF00FF&quot; &quot;#00FFFFFF&quot; &quot;#0000FFFF&quot; &quot;#FF00FFFF&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Sepal.Width, <span class="dt">y=</span>Sepal.Length, <span class="dt">color=</span>Species)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">rainbow</span>(<span class="dv">3</span>))</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="colors-for-continuous-values" class="section level4">
<h4><span class="header-section-number">4.1.6.2</span> Colors for continuous values</h4>
<p>For this example, we will consider an elevation map of the Maunga Whau volcano in New Zealand. This dataset comes built into R as the matrix <code>volcano</code>, but I’ve modified it slightly and saved it to a package I have on github called <code>dsdata</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">&#39;dereksonderegger/dsdata&#39;</span>)</code></pre>
<pre><code>## Skipping install of &#39;dsData&#39; from a github remote, the SHA1 (43b2f6d8) has not changed since last install.
##   Use `force = TRUE` to force installation</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&#39;Eden&#39;</span>, <span class="dt">package=</span><span class="st">&#39;dsData&#39;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>( Eden, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>elevation)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_raster</span>()</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>The default gradient isn’t too bad, but we might want to manually chose two colors to smoothly scale between. Because I want to effect the colors I’ve chosen for the <code>fill</code> aesthetic, I have to modify this using <code>scale_fill_XXX</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>( Eden, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>elevation)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;blue&quot;</span>)</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>I think we ought to have the blue color come in a little earlier. Also, I want to specify a middle color so that our graph transitions from red to green to blue. To do this, we also have to specify where the middle color should be located along the elevation range.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>( Eden, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>elevation)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">low =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">mid=</span><span class="st">&#39;green&#39;</span>, <span class="dt">high =</span> <span class="st">&quot;blue&quot;</span>,
                       <span class="dt">midpoint=</span><span class="dv">135</span>)</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>If we don’t want to specify the colors manually we can, as usual, specify the color palette. The <code>gradientn</code> functions allow us to specify a large numbers intermediate colors.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>( Eden, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>elevation)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colours =</span> <span class="kw">terrain.colors</span>(<span class="dv">5</span>))</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
</div>
<div id="adjusting-axes" class="section level3">
<h3><span class="header-section-number">4.1.7</span> Adjusting axes</h3>
<div id="setting-breakpoints" class="section level4">
<h4><span class="header-section-number">4.1.7.1</span> Setting breakpoints</h4>
<p>Sometimes the default axis breakpoints aren’t quite what I want and I want to add a number or remove a number. To do this, we will modify the x or y scale. Typically I only have a problem when the axis is continuous, so we will concentrate on that case.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x=</span>class, <span class="dt">y=</span>hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() </code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>In this case, suppose that we want the major breakpoints (which have labels) to occur every 5 mpg, and the minor breakpoints (which just have a white line) to occur midway between those (so every 2.5 mpg).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x=</span>class, <span class="dt">y=</span>hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>( <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">45</span>, <span class="dt">by=</span><span class="dv">5</span>) ) </code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>If we wanted to adjust the minor breaks, we could do that using the <code>minor_breaks</code> argument. If we want to remove the minor breaks completely, we could set the minor breaks to be <code>NULL</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x=</span>class, <span class="dt">y=</span>hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>( <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">45</span>, <span class="dt">by=</span><span class="dv">5</span>), <span class="dt">minor_breaks =</span> <span class="ot">NULL</span> ) </code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
</div>
<div id="zooming-inout" class="section level3">
<h3><span class="header-section-number">4.1.8</span> Zooming in/out</h3>
<p>It is often important to be able to force the graph to have a particular range in either the x-axis or the y-axis. Given a particular range of interest, there are two ways that we could this:</p>
<ul>
<li>Remove all data points that fall outside the range and just plot the reduced dataset. This is accomplished using the <code>xlim()</code> and <code>ylim()</code> functions, or setting either of those inside another <code>scale_XXX</code> function.</li>
<li>Use all the data to create a graph and just zoom in/out in that graph. This is accomplished using the <code>coord_cartesian()</code> function</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(trees, <span class="kw">aes</span>(<span class="dt">x=</span>Girth, <span class="dt">y=</span>Volume)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>)</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>If we want to reset the x-axis to stop at <span class="math inline">\(x=19\)</span>, and <span class="math inline">\(y=60\)</span>, then we could use the <code>xlim()</code> and <code>ylim()</code> functions, but this will cause the regression line to be chopped off and it won’t even use that data point when calculating the regression.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Danger!  This removes the data points first!</span>
<span class="kw">ggplot</span>(trees, <span class="kw">aes</span>(<span class="dt">x=</span>Girth, <span class="dt">y=</span>Volume)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>( <span class="dv">8</span>, <span class="dv">19</span> ) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">60</span>)</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Alternatively, we could use the <code>coord_cartesion</code> function to chop the axes _after_everything has been calculated.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Safer!  Create the graph and then just zoom in</span>
<span class="kw">ggplot</span>(trees, <span class="kw">aes</span>(<span class="dt">x=</span>Girth, <span class="dt">y=</span>Volume)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>( <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">19</span> ), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">60</span>))</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
</div>
<div id="cookbook-examples" class="section level2">
<h2><span class="header-section-number">4.2</span> Cookbook Examples</h2>
<div id="scatterplot-with-prediction-ribbons" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Scatterplot with prediction ribbons</h3>
<p>Often I want to create a scatterplot and then graph the predicted values as a ribbon on top. While it is possible to do this automatically using the <code>geom_smoother()</code> function, I prefer not to do this because I don’t have much control over how the model is created.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fit a linear model to the trees dataset</span>
model &lt;-<span class="st"> </span><span class="kw">lm</span>( Volume <span class="op">~</span><span class="st"> </span>Girth, <span class="dt">data=</span>trees )

<span class="co"># add the fitted values and confidence interval values for each observation</span>
<span class="co"># to the original data frame, and call the augmented dataset trees.aug.</span>
trees.aug &lt;-<span class="st"> </span>trees <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cbind</span>( <span class="kw">predict</span>(model, <span class="dt">interval=</span><span class="st">&#39;confidence&#39;</span>, <span class="dt">newdata=</span>.) )


<span class="co"># Plot the augmented data. Alpha is the opacity of the ribbon</span>
<span class="kw">ggplot</span>(trees.aug, <span class="kw">aes</span>(<span class="dt">x=</span>Girth, <span class="dt">y=</span>Volume)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>( <span class="kw">aes</span>(<span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr), <span class="dt">alpha=</span>.<span class="dv">4</span>, <span class="dt">fill=</span><span class="st">&#39;darkgrey&#39;</span> ) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>( <span class="kw">aes</span>(<span class="dt">y=</span>fit) ) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>( <span class="kw">aes</span>( <span class="dt">y =</span> Volume ) )</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
</div>
<div id="bar-plot" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Bar Plot</h3>
<p>Suppose that you just want make some barplots and add <span class="math inline">\(\pm\)</span> S.E. bars. This should be really easy to do, but in the base graphics in R, it is a pain. Fortunately in <code>ggplot2</code> this is easy. First, define a data frame with the bar heights you want to graph and the <span class="math inline">\(\pm\)</span> values you wish to use.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Calculate the mean and sd of the Petal Widths for each species</span>
stats &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>( <span class="dt">Mean =</span> <span class="kw">mean</span>(Petal.Width),                 <span class="co"># Mean   = ybar</span>
             <span class="dt">StdErr =</span> <span class="kw">sd</span>(Petal.Width)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">n</span>()) ) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># StdErr = s / sqrt(n)</span>
<span class="st">  </span><span class="kw">mutate</span>( <span class="dt">lwr =</span> Mean <span class="op">-</span><span class="st"> </span>StdErr,
          <span class="dt">upr =</span> Mean <span class="op">+</span><span class="st"> </span>StdErr )
stats</code></pre>
<pre><code>## # A tibble: 3 x 5
##   Species     Mean StdErr   lwr   upr
##   &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 setosa     0.246 0.0149 0.231 0.261
## 2 versicolor 1.33  0.0280 1.30  1.35 
## 3 virginica  2.03  0.0388 1.99  2.06</code></pre>
<p>Next we take these summary statistics and define the following graph which makes a bar graph of the means and error bars that are <span class="math inline">\(\pm\)</span> 1 estimated standard deviation of the mean (usually referred to as the standard errors of the means). By default, <code>geom_bar()</code> tries to draw a bar plot based on how many observations each group has. What I want, though, is to draw bars of the height I specified, so to do that I have to add <code>stat='identity'</code> to specify that it should just use the heights I tell it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(stats, <span class="kw">aes</span>(<span class="dt">x=</span>Species)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>( <span class="kw">aes</span>(<span class="dt">y=</span>Mean), <span class="dt">stat=</span><span class="st">&#39;identity&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_errorbar</span>( <span class="kw">aes</span>(<span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr) )</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>While this isn’t too bad, we would like to make this a bit more pleasing to look at. Each of the bars is a little too wide and the error bars should be a tad narrower than then bar. Also, the fill color for the bars is too dark. So I’ll change all of these, by setting those attributes <em>outside of an <code>aes()</code> command</em>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(stats, <span class="kw">aes</span>(<span class="dt">x=</span>Species)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>( <span class="kw">aes</span>(<span class="dt">y=</span>Mean), <span class="dt">stat=</span><span class="st">&#39;identity&#39;</span>, <span class="dt">fill=</span><span class="st">&#39;grey&#39;</span>, <span class="dt">width=</span>.<span class="dv">6</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_errorbar</span>( <span class="kw">aes</span>(<span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr), <span class="dt">color=</span><span class="st">&#39;red&#39;</span>, <span class="dt">width=</span>.<span class="dv">4</span> )</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>The last thing to notice is that the <em>order</em> in which the different layers matter. This is similar to Photoshop or GIS software where the layers added last can obscure prior layers. In the graph below, the lower part of the error bar is obscured by the grey bar.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(stats, <span class="kw">aes</span>(<span class="dt">x=</span>Species)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_errorbar</span>( <span class="kw">aes</span>(<span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr), <span class="dt">color=</span><span class="st">&#39;red&#39;</span>, <span class="dt">width=</span>.<span class="dv">4</span> ) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>( <span class="kw">aes</span>(<span class="dt">y=</span>Mean), <span class="dt">stat=</span><span class="st">&#39;identity&#39;</span>, <span class="dt">fill=</span><span class="st">&#39;grey&#39;</span>, <span class="dt">width=</span>.<span class="dv">6</span>)</code></pre>
<p><img src="03_Intro_to_Graphing_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
</div>
</div>
<div id="exercises-2" class="section level2">
<h2><span class="header-section-number">4.3</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>For the dataset trees, which should already be pre-loaded. Look at the help file using <code>?trees</code> for more information about this data set. We wish to build a scatterplot that compares the height and girth of these cherry trees to the volume of lumber that was produced.</p>
<ol style="list-style-type: lower-alpha">
<li>Create a graph using ggplot2 with Height on the x-axis, Volume on the y-axis, and Girth as the either the size of the data point or the color of the data point. Which do you think is a more intuitive representation?</li>
<li>Add appropriate labels for the main title and the x and y axes.</li>
</ol></li>
<li><p>Consider the following small dataset that represents the number of times per day my wife played “Ring around the Rosy” with my daughter relative to the number of days since she has learned this game. The column <code>yhat</code> represents the best fitting line through the data, and <code>lwr</code> and <code>upr</code> represent a 95% confidence interval for the predicted value on that day.</p>
<pre class="sourceCode r"><code class="sourceCode r">Rosy &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">times =</span> <span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">11</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>),
  <span class="dt">day   =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,
  <span class="dt">yhat  =</span> <span class="kw">c</span>(<span class="fl">14.36</span>, <span class="fl">12.29</span>, <span class="fl">10.21</span>, <span class="fl">8.14</span>, <span class="fl">6.07</span>, <span class="fl">4.00</span>,  <span class="fl">1.93</span>),
  <span class="dt">lwr   =</span> <span class="kw">c</span>( <span class="fl">9.54</span>,  <span class="fl">8.5</span>,   <span class="fl">7.22</span>, <span class="fl">5.47</span>, <span class="fl">3.08</span>, <span class="fl">0.22</span>, <span class="fl">-2.89</span>),
  <span class="dt">upr   =</span> <span class="kw">c</span>(<span class="fl">19.18</span>, <span class="fl">16.07</span>, <span class="fl">13.2</span>, <span class="fl">10.82</span>, <span class="fl">9.06</span>, <span class="fl">7.78</span>,  <span class="fl">6.75</span>))</code></pre>
<ol style="list-style-type: lower-alpha">
<li><p>Using <code>ggplot()</code> and <code>geom_point()</code>, create a scatterplot with <code>day</code> along the x-axis and <code>times</code> along the y-axis.</p></li>
<li><p>Add a line to the graph where the x-values are the <code>day</code> values but now the y-values are the predicted values which we’ve called <code>yhat</code>. Notice that you have to set the aesthetic y=times for the points and y=yhat for the line. Because each <code>geom_</code> will accept an <code>aes()</code> command, you can specify the <code>y</code> attribute to be different for different layers of the graph.</p></li>
<li><p>Add a ribbon that represents the confidence region of the regression line. The <code>geom_ribbon()</code> function requires an <code>x</code>, <code>ymin</code>, and <code>ymax</code> columns to be defined. For examples of using <code>geom_ribbon()</code> see the online documentation: <a href="http://docs.ggplot2.org/current/geom_ribbon.html">http://docs.ggplot2.org/current/geom_ribbon.html</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(Rosy, <span class="kw">aes</span>(<span class="dt">x=</span>day)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span>times)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>( <span class="kw">aes</span>(<span class="dt">y=</span>yhat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>( <span class="kw">aes</span>(<span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr), <span class="dt">fill=</span><span class="st">&#39;salmon&#39;</span>)</code></pre></li>
<li>What happened when you added the ribbon? Did some points get hidden? If so, why?</li>
<li>Reorder the statements that created the graph so that the ribbon is on the bottom and the data points are on top and the regression line is visible.</li>
<li>The color of the ribbon fill is ugly. Use Google to find a list of named colors available to <code>ggplot2</code>. For example, I googled “ggplot2 named colors” and found the following link: <a href="http://sape.inf.usi.ch/quick-reference/ggplot2/colour">http://sape.inf.usi.ch/quick-reference/ggplot2/colour</a>. Choose a color for the fill that is pleasing to you.</li>
<li><p>Add labels for the x-axis and y-axis that are appropriate along with a main title.</p></li>
</ol></li>
<li><p>The R package <code>babynames</code> contains a single dataset that lists the number of children registered with Social Security with a particular name along with the proportion out of all children born in a given year. The dataset covers the from 1880 to the present. We want to plot the relative popularity of the names ‘Elise’ and ‘Casey’.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Load the package. If it is not found on your computer, download the package from CRAN.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(babynames)
<span class="kw">data</span>(<span class="st">&quot;babynames&quot;</span>)</code></pre></li>
<li>Read the help file for the data set <code>babynames</code> to get a sense of the columns</li>
<li>Create a small dataset that only has the names ‘Elise’ and ‘Casey’.</li>
<li><p>Make a plot where the x-axis is the year and the y-axis is the proportion of babies given the names. Use a line to display this relationship and distinguish the two names by color. Notice this graph is a bit ugly because there is a lot of year-to-year variability that we should smooth over.</p></li>
<li><p>We’ll use <code>dplyr</code> to collapse the individual years into decades using the following code:</p>
<pre class="sourceCode r"><code class="sourceCode r">small &lt;-<span class="st"> </span>babynames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>( name<span class="op">==</span><span class="st">&#39;Elise&#39;</span> <span class="op">|</span><span class="st"> </span>name<span class="op">==</span><span class="st">&#39;Casey&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>( <span class="dt">decade =</span> <span class="kw">cut</span>(year, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1869</span>,<span class="dv">2019</span>,<span class="dt">by=</span><span class="dv">10</span>) )) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(name, decade) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>( <span class="dt">prop =</span> <span class="kw">mean</span>(prop),
             <span class="dt">year =</span> <span class="kw">min</span>(year)) </code></pre></li>
<li>Now draw the same graph you had in part (d).</li>
<li><p>Next we’ll create an area plot where the height is the total proportion of the both names and the colors split up the proportion.</p></li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small, <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>prop, <span class="dt">fill=</span>name)) <span class="op">+</span><span class="st"> </span>
<span class="st">   </span><span class="kw">geom_area</span>()</code></pre>
<p>This is a pretty neat graph as it show the relative popularity of the name over time and can easily be expanded to many many names. In fact, there is a wonderful website that takes this same data and allows you select the names quite nicely: <a href="http://www.babynamewizard.com/voyager">http://www.babynamewizard.com/voyager</a>. My wife and I used this a lot while figuring out what to name our children. Notice that this site really uses the same graph type we just built but there are a few extra neat interactivity tricks.</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="3-introduction-to-graphing-using-ggplot2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="5-introduction-to-data-wrangling-using-dplyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"],
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dereksonderegger/570/raw/master/03_Intro_to_Graphing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": [["Statistical_Methods_I.pdf", "PDF"], ["Statistical_Methods_I.epub", "EPUB"]],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
