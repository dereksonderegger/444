<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 12 Data Reshaping | STA 444/5 - Introductory Data Science using R</title>
  <meta name="description" content="Chapter 12 Data Reshaping | STA 444/5 - Introductory Data Science using R" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 12 Data Reshaping | STA 444/5 - Introductory Data Science using R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/Cover1.png" />
  
  <meta name="github-repo" content="dereksonderegger/444" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 12 Data Reshaping | STA 444/5 - Introductory Data Science using R" />
  
  
  <meta name="twitter:image" content="images/Cover1.png" />

<meta name="author" content="Derek L. Sonderegger" />


<meta name="date" content="2019-09-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="11-dates-and-times.html">
<link rel="next" href="13-r-packages.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-resources"><i class="fa fa-check"></i>Other Resources</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="1-familiarization.html"><a href="1-familiarization.html"><i class="fa fa-check"></i><b>1</b> Familiarization</a><ul>
<li class="chapter" data-level="1.1" data-path="1-familiarization.html"><a href="1-familiarization.html#r-file-types"><i class="fa fa-check"></i><b>1.1</b> R file Types</a><ul>
<li class="chapter" data-level="1.1.1" data-path="1-familiarization.html"><a href="1-familiarization.html#r-scripts-.r-files"><i class="fa fa-check"></i><b>1.1.1</b> R Scripts (.R files)</a></li>
<li class="chapter" data-level="1.1.2" data-path="1-familiarization.html"><a href="1-familiarization.html#r-markdown-.rmd-files"><i class="fa fa-check"></i><b>1.1.2</b> R Markdown (.Rmd files)</a></li>
<li class="chapter" data-level="1.1.3" data-path="1-familiarization.html"><a href="1-familiarization.html#r-notebooks-.rmd-files"><i class="fa fa-check"></i><b>1.1.3</b> R Notebooks (.Rmd files)</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="1-familiarization.html"><a href="1-familiarization.html#r-as-a-simple-calculator"><i class="fa fa-check"></i><b>1.2</b> R as a simple calculator</a></li>
<li class="chapter" data-level="1.3" data-path="1-familiarization.html"><a href="1-familiarization.html#assignment"><i class="fa fa-check"></i><b>1.3</b> Assignment</a></li>
<li class="chapter" data-level="1.4" data-path="1-familiarization.html"><a href="1-familiarization.html#vectors"><i class="fa fa-check"></i><b>1.4</b> Vectors</a></li>
<li class="chapter" data-level="1.5" data-path="1-familiarization.html"><a href="1-familiarization.html#packages"><i class="fa fa-check"></i><b>1.5</b> Packages</a></li>
<li class="chapter" data-level="1.6" data-path="1-familiarization.html"><a href="1-familiarization.html#finding-help"><i class="fa fa-check"></i><b>1.6</b> Finding Help</a><ul>
<li class="chapter" data-level="1.6.1" data-path="1-familiarization.html"><a href="1-familiarization.html#how-does-this-function-work"><i class="fa fa-check"></i><b>1.6.1</b> How does this function work?</a></li>
<li class="chapter" data-level="1.6.2" data-path="1-familiarization.html"><a href="1-familiarization.html#how-does-this-package-work"><i class="fa fa-check"></i><b>1.6.2</b> How does this package work?</a></li>
<li class="chapter" data-level="1.6.3" data-path="1-familiarization.html"><a href="1-familiarization.html#how-do-i-do-xxx"><i class="fa fa-check"></i><b>1.6.3</b> How do I do XXX?</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="1-familiarization.html"><a href="1-familiarization.html#exercises"><i class="fa fa-check"></i><b>1.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-data-frames.html"><a href="2-data-frames.html"><i class="fa fa-check"></i><b>2</b> Data Frames</a><ul>
<li class="chapter" data-level="2.1" data-path="2-data-frames.html"><a href="2-data-frames.html#introduction-to-importing-data"><i class="fa fa-check"></i><b>2.1</b> Introduction to Importing Data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="2-data-frames.html"><a href="2-data-frames.html#from-a-package"><i class="fa fa-check"></i><b>2.1.1</b> From a Package</a></li>
<li class="chapter" data-level="2.1.2" data-path="2-data-frames.html"><a href="2-data-frames.html#import-from-.csv-or-.xls-files"><i class="fa fa-check"></i><b>2.1.2</b> Import from <code>.csv</code> or <code>.xls</code> files</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="2-data-frames.html"><a href="2-data-frames.html#data-types"><i class="fa fa-check"></i><b>2.2</b> Data Types</a></li>
<li class="chapter" data-level="2.3" data-path="2-data-frames.html"><a href="2-data-frames.html#basic-manipulation"><i class="fa fa-check"></i><b>2.3</b> Basic Manipulation</a></li>
<li class="chapter" data-level="2.4" data-path="2-data-frames.html"><a href="2-data-frames.html#exercises-1"><i class="fa fa-check"></i><b>2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-graphing.html"><a href="3-graphing.html"><i class="fa fa-check"></i><b>3</b> Graphing</a><ul>
<li class="chapter" data-level="3.1" data-path="3-graphing.html"><a href="3-graphing.html#basic-graphs"><i class="fa fa-check"></i><b>3.1</b> Basic Graphs</a><ul>
<li class="chapter" data-level="3.1.1" data-path="3-graphing.html"><a href="3-graphing.html#scatterplots"><i class="fa fa-check"></i><b>3.1.1</b> Scatterplots</a></li>
<li class="chapter" data-level="3.1.2" data-path="3-graphing.html"><a href="3-graphing.html#box-plots"><i class="fa fa-check"></i><b>3.1.2</b> Box Plots</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-graphing.html"><a href="3-graphing.html#title-axis-labels"><i class="fa fa-check"></i><b>3.2</b> Title &amp; Axis Labels</a></li>
<li class="chapter" data-level="3.3" data-path="3-graphing.html"><a href="3-graphing.html#annotation"><i class="fa fa-check"></i><b>3.3</b> Annotation</a><ul>
<li class="chapter" data-level="3.3.1" data-path="3-graphing.html"><a href="3-graphing.html#using-a-data.frame"><i class="fa fa-check"></i><b>3.3.1</b> Using a <code>data.frame</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="3-graphing.html"><a href="3-graphing.html#setting-attributes-in-line"><i class="fa fa-check"></i><b>3.3.2</b> Setting attributes in-line</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="3-graphing.html"><a href="3-graphing.html#faceting"><i class="fa fa-check"></i><b>3.4</b> Faceting</a></li>
<li class="chapter" data-level="3.5" data-path="3-graphing.html"><a href="3-graphing.html#exercises-2"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-data-wrangling.html"><a href="4-data-wrangling.html"><i class="fa fa-check"></i><b>4</b> Data Wrangling</a><ul>
<li class="chapter" data-level="4.1" data-path="4-data-wrangling.html"><a href="4-data-wrangling.html#verbs"><i class="fa fa-check"></i><b>4.1</b> Verbs</a><ul>
<li class="chapter" data-level="4.1.1" data-path="4-data-wrangling.html"><a href="4-data-wrangling.html#subsetting"><i class="fa fa-check"></i><b>4.1.1</b> Subsetting</a></li>
<li class="chapter" data-level="4.1.2" data-path="4-data-wrangling.html"><a href="4-data-wrangling.html#arrange"><i class="fa fa-check"></i><b>4.1.2</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="4.1.3" data-path="4-data-wrangling.html"><a href="4-data-wrangling.html#mutate"><i class="fa fa-check"></i><b>4.1.3</b> mutate()</a></li>
<li class="chapter" data-level="4.1.4" data-path="4-data-wrangling.html"><a href="4-data-wrangling.html#summarise"><i class="fa fa-check"></i><b>4.1.4</b> summarise()</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-data-wrangling.html"><a href="4-data-wrangling.html#split-apply-combine"><i class="fa fa-check"></i><b>4.2</b> Split, apply, combine</a></li>
<li class="chapter" data-level="4.3" data-path="4-data-wrangling.html"><a href="4-data-wrangling.html#exercises-3"><i class="fa fa-check"></i><b>4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-statistical-models.html"><a href="5-statistical-models.html"><i class="fa fa-check"></i><b>5</b> Statistical Models</a><ul>
<li class="chapter" data-level="5.1" data-path="5-statistical-models.html"><a href="5-statistical-models.html#formula-notation"><i class="fa fa-check"></i><b>5.1</b> Formula Notation</a></li>
<li class="chapter" data-level="5.2" data-path="5-statistical-models.html"><a href="5-statistical-models.html#basic-models"><i class="fa fa-check"></i><b>5.2</b> Basic Models</a><ul>
<li class="chapter" data-level="5.2.1" data-path="5-statistical-models.html"><a href="5-statistical-models.html#t-tests"><i class="fa fa-check"></i><b>5.2.1</b> t-tests</a></li>
<li class="chapter" data-level="5.2.2" data-path="5-statistical-models.html"><a href="5-statistical-models.html#lm-objects"><i class="fa fa-check"></i><b>5.2.2</b> lm objects</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="5-statistical-models.html"><a href="5-statistical-models.html#accessor-function"><i class="fa fa-check"></i><b>5.3</b> Accessor function</a></li>
<li class="chapter" data-level="5.4" data-path="5-statistical-models.html"><a href="5-statistical-models.html#exercises-4"><i class="fa fa-check"></i><b>5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-flow-control.html"><a href="6-flow-control.html"><i class="fa fa-check"></i><b>6</b> Flow Control</a><ul>
<li class="chapter" data-level="6.1" data-path="6-flow-control.html"><a href="6-flow-control.html#decision-statements"><i class="fa fa-check"></i><b>6.1</b> Decision statements</a><ul>
<li class="chapter" data-level="6.1.1" data-path="6-flow-control.html"><a href="6-flow-control.html#in-dplyr-wrangling"><i class="fa fa-check"></i><b>6.1.1</b> In <code>dplyr</code> wrangling</a></li>
<li class="chapter" data-level="6.1.2" data-path="6-flow-control.html"><a href="6-flow-control.html#general-if-else"><i class="fa fa-check"></i><b>6.1.2</b> General <code>if else</code></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="6-flow-control.html"><a href="6-flow-control.html#loops"><i class="fa fa-check"></i><b>6.2</b> Loops</a><ul>
<li class="chapter" data-level="6.2.1" data-path="6-flow-control.html"><a href="6-flow-control.html#while-loops"><i class="fa fa-check"></i><b>6.2.1</b> <code>while</code> Loops</a></li>
<li class="chapter" data-level="6.2.2" data-path="6-flow-control.html"><a href="6-flow-control.html#for-loops"><i class="fa fa-check"></i><b>6.2.2</b> <code>for</code> Loops</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="6-flow-control.html"><a href="6-flow-control.html#exercises-5"><i class="fa fa-check"></i><b>6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-factors.html"><a href="7-factors.html"><i class="fa fa-check"></i><b>7</b> Factors</a><ul>
<li class="chapter" data-level="7.1" data-path="7-factors.html"><a href="7-factors.html#creation-and-structure"><i class="fa fa-check"></i><b>7.1</b> Creation and Structure</a></li>
<li class="chapter" data-level="7.2" data-path="7-factors.html"><a href="7-factors.html#change-labels"><i class="fa fa-check"></i><b>7.2</b> Change Labels</a></li>
<li class="chapter" data-level="7.3" data-path="7-factors.html"><a href="7-factors.html#reorder-levels-1"><i class="fa fa-check"></i><b>7.3</b> Reorder Levels</a></li>
<li class="chapter" data-level="7.4" data-path="7-factors.html"><a href="7-factors.html#add-or-substract-levels"><i class="fa fa-check"></i><b>7.4</b> Add or substract Levels</a></li>
</ul></li>
<li class="part"><span><b>Miscellanious</b></span></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html"><i class="fa fa-check"></i>Statistical Tables</a><ul>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#example-distributions"><i class="fa fa-check"></i>Example Distributions</a></li>
<li><a href="statistical-tables.html#mosaicplotdist-function"><code>mosaic::plotDist()</code> function</a></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#base-r-functions"><i class="fa fa-check"></i>Base R functions</a><ul>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#d-function"><i class="fa fa-check"></i>d-function</a></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#p-function"><i class="fa fa-check"></i>p-function</a></li>
<li><a href="statistical-tables.html#q-function"><code>q</code>-function</a></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#r-function"><i class="fa fa-check"></i>r-function</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#exercises-6"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html"><i class="fa fa-check"></i>Rmarkdown Tricks</a><ul>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#chunk-options"><i class="fa fa-check"></i>Chunk Options</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#verbatim-list-environments"><i class="fa fa-check"></i>Verbatim &amp; List Environments</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#mathematical-expressions"><i class="fa fa-check"></i>Mathematical expressions</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#tables"><i class="fa fa-check"></i>Tables</a><ul>
<li class="chapter" data-level="7.4.1" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#simple-tables"><i class="fa fa-check"></i><b>7.4.1</b> Simple Tables</a></li>
<li class="chapter" data-level="7.4.2" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#grid-tables"><i class="fa fa-check"></i><b>7.4.2</b> Grid Tables</a></li>
<li class="chapter" data-level="7.4.3" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#pipe-tables"><i class="fa fa-check"></i><b>7.4.3</b> Pipe Tables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#r-functions-to-produce-table-code."><i class="fa fa-check"></i>R functions to produce table code.</a><ul>
<li class="chapter" data-level="7.4.4" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#knitrkable"><i class="fa fa-check"></i><b>7.4.4</b> <code class="unnumbered">knitr::kable</code></a></li>
<li class="chapter" data-level="7.4.5" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#package-pander"><i class="fa fa-check"></i><b>7.4.5</b> Package <code class="unnumbered">pander</code></a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Deeper Details</b></span></li>
<li class="chapter" data-level="8" data-path="8-importing-data.html"><a href="8-importing-data.html"><i class="fa fa-check"></i><b>8</b> Importing Data</a><ul>
<li class="chapter" data-level="8.1" data-path="8-importing-data.html"><a href="8-importing-data.html#working-directory"><i class="fa fa-check"></i><b>8.1</b> Working directory</a></li>
<li class="chapter" data-level="8.2" data-path="8-importing-data.html"><a href="8-importing-data.html#comma-separated-data"><i class="fa fa-check"></i><b>8.2</b> Comma Separated Data</a></li>
<li class="chapter" data-level="8.3" data-path="8-importing-data.html"><a href="8-importing-data.html#ms-excel"><i class="fa fa-check"></i><b>8.3</b> MS Excel</a></li>
<li class="chapter" data-level="8.4" data-path="8-importing-data.html"><a href="8-importing-data.html#exercises-7"><i class="fa fa-check"></i><b>8.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="9-user-defined-functions.html"><a href="9-user-defined-functions.html"><i class="fa fa-check"></i><b>9</b> User Defined Functions</a><ul>
<li class="chapter" data-level="9.1" data-path="9-user-defined-functions.html"><a href="9-user-defined-functions.html#basic-function-definition"><i class="fa fa-check"></i><b>9.1</b> Basic function definition</a></li>
<li class="chapter" data-level="9.2" data-path="9-user-defined-functions.html"><a href="9-user-defined-functions.html#parameter-defaults"><i class="fa fa-check"></i><b>9.2</b> Parameter Defaults</a></li>
<li class="chapter" data-level="9.3" data-path="9-user-defined-functions.html"><a href="9-user-defined-functions.html#ellipses"><i class="fa fa-check"></i><b>9.3</b> Ellipses</a></li>
<li class="chapter" data-level="9.4" data-path="9-user-defined-functions.html"><a href="9-user-defined-functions.html#function-overloading"><i class="fa fa-check"></i><b>9.4</b> Function Overloading</a></li>
<li class="chapter" data-level="9.5" data-path="9-user-defined-functions.html"><a href="9-user-defined-functions.html#scope"><i class="fa fa-check"></i><b>9.5</b> Scope</a></li>
<li class="chapter" data-level="9.6" data-path="9-user-defined-functions.html"><a href="9-user-defined-functions.html#exercises-8"><i class="fa fa-check"></i><b>9.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html"><i class="fa fa-check"></i><b>10</b> String Manipulation</a><ul>
<li class="chapter" data-level="10.1" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#base-function"><i class="fa fa-check"></i><b>10.1</b> Base function</a></li>
<li class="chapter" data-level="10.2" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#package-stringr-basic-operations"><i class="fa fa-check"></i><b>10.2</b> Package <code>stringr</code>: basic operations</a><ul>
<li class="chapter" data-level="10.2.1" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#concatenating-with-str_c-or-str_join"><i class="fa fa-check"></i><b>10.2.1</b> Concatenating with <code>str_c()</code> or <code>str_join()</code></a></li>
<li class="chapter" data-level="10.2.2" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#calculating-string-length-with-str_length"><i class="fa fa-check"></i><b>10.2.2</b> Calculating string length with <code>str_length()</code></a></li>
<li class="chapter" data-level="10.2.3" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#extracting-substrings-with-str_sub"><i class="fa fa-check"></i><b>10.2.3</b> Extracting substrings with <code>str_sub()</code></a></li>
<li class="chapter" data-level="10.2.4" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#pad-a-string-with-str_pad"><i class="fa fa-check"></i><b>10.2.4</b> Pad a string with <code>str_pad()</code></a></li>
<li class="chapter" data-level="10.2.5" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#trim-a-string-with-str_trim"><i class="fa fa-check"></i><b>10.2.5</b> Trim a string with <code>str_trim()</code></a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#package-stringr-pattern-matching"><i class="fa fa-check"></i><b>10.3</b> Package <code>stringr</code>: Pattern Matching</a><ul>
<li class="chapter" data-level="10.3.1" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#detecting-a-pattern-using-str_detect"><i class="fa fa-check"></i><b>10.3.1</b> Detecting a pattern using str_detect()</a></li>
<li class="chapter" data-level="10.3.2" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#locating-a-pattern-using-str_locate"><i class="fa fa-check"></i><b>10.3.2</b> Locating a pattern using str_locate()</a></li>
<li class="chapter" data-level="10.3.3" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#replacing-substrings-using-str_replace"><i class="fa fa-check"></i><b>10.3.3</b> Replacing substrings using <code>str_replace()</code></a></li>
<li class="chapter" data-level="10.3.4" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#splitting-into-substrings-using-str_split"><i class="fa fa-check"></i><b>10.3.4</b> Splitting into substrings using <code>str_split()</code></a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#regular-expressions"><i class="fa fa-check"></i><b>10.4</b> Regular Expressions</a></li>
<li class="chapter" data-level="10.5" data-path="10-string-manipulation.html"><a href="10-string-manipulation.html#exercises-9"><i class="fa fa-check"></i><b>10.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="11-dates-and-times.html"><a href="11-dates-and-times.html"><i class="fa fa-check"></i><b>11</b> Dates and Times</a><ul>
<li class="chapter" data-level="11.1" data-path="11-dates-and-times.html"><a href="11-dates-and-times.html#creating-date-and-time-objects"><i class="fa fa-check"></i><b>11.1</b> Creating Date and Time objects</a></li>
<li class="chapter" data-level="11.2" data-path="11-dates-and-times.html"><a href="11-dates-and-times.html#extracting-information"><i class="fa fa-check"></i><b>11.2</b> Extracting information</a></li>
<li class="chapter" data-level="11.3" data-path="11-dates-and-times.html"><a href="11-dates-and-times.html#arithmetic-on-dates"><i class="fa fa-check"></i><b>11.3</b> Arithmetic on Dates</a></li>
<li class="chapter" data-level="11.4" data-path="11-dates-and-times.html"><a href="11-dates-and-times.html#exercises-10"><i class="fa fa-check"></i><b>11.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="12-data-reshaping.html"><a href="12-data-reshaping.html"><i class="fa fa-check"></i><b>12</b> Data Reshaping</a><ul>
<li class="chapter" data-level="12.1" data-path="12-data-reshaping.html"><a href="12-data-reshaping.html#tidyr"><i class="fa fa-check"></i><b>12.1</b> <code>tidyr</code></a><ul>
<li class="chapter" data-level="12.1.1" data-path="12-data-reshaping.html"><a href="12-data-reshaping.html#verbs-1"><i class="fa fa-check"></i><b>12.1.1</b> Verbs</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="12-data-reshaping.html"><a href="12-data-reshaping.html#storing-data-in-multiple-tables"><i class="fa fa-check"></i><b>12.2</b> Storing Data in Multiple Tables</a></li>
<li class="chapter" data-level="12.3" data-path="12-data-reshaping.html"><a href="12-data-reshaping.html#table-joins"><i class="fa fa-check"></i><b>12.3</b> Table Joins</a></li>
<li class="chapter" data-level="12.4" data-path="12-data-reshaping.html"><a href="12-data-reshaping.html#exercises-11"><i class="fa fa-check"></i><b>12.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="13-r-packages.html"><a href="13-r-packages.html"><i class="fa fa-check"></i><b>13</b> R Packages</a><ul>
<li class="chapter" data-level="13.1" data-path="13-r-packages.html"><a href="13-r-packages.html#introduction"><i class="fa fa-check"></i><b>13.1</b> Introduction</a><ul>
<li class="chapter" data-level="13.1.1" data-path="13-r-packages.html"><a href="13-r-packages.html#useful-packages-and-books"><i class="fa fa-check"></i><b>13.1.1</b> Useful packages and books</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="13-r-packages.html"><a href="13-r-packages.html#package-structure"><i class="fa fa-check"></i><b>13.2</b> Package Structure</a><ul>
<li class="chapter" data-level="13.2.1" data-path="13-r-packages.html"><a href="13-r-packages.html#minimal-files-and-directories"><i class="fa fa-check"></i><b>13.2.1</b> Minimal files and directories</a></li>
<li class="chapter" data-level="13.2.2" data-path="13-r-packages.html"><a href="13-r-packages.html#optional-files-and-directories"><i class="fa fa-check"></i><b>13.2.2</b> Optional Files and Directories</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="13-r-packages.html"><a href="13-r-packages.html#documenting"><i class="fa fa-check"></i><b>13.3</b> Documenting</a><ul>
<li class="chapter" data-level="13.3.1" data-path="13-r-packages.html"><a href="13-r-packages.html#dataset-documentation"><i class="fa fa-check"></i><b>13.3.1</b> Dataset Documentation</a></li>
<li class="chapter" data-level="13.3.2" data-path="13-r-packages.html"><a href="13-r-packages.html#documenting-functions"><i class="fa fa-check"></i><b>13.3.2</b> Documenting Functions</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="13-r-packages.html"><a href="13-r-packages.html#the-description-file"><i class="fa fa-check"></i><b>13.4</b> The DESCRIPTION file</a><ul>
<li class="chapter" data-level="13.4.1" data-path="13-r-packages.html"><a href="13-r-packages.html#a-simple-analysis-package"><i class="fa fa-check"></i><b>13.4.1</b> A Simple Analysis Package</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="13-r-packages.html"><a href="13-r-packages.html#sharing-your-package"><i class="fa fa-check"></i><b>13.5</b> Sharing your Package</a></li>
<li class="chapter" data-level="13.6" data-path="13-r-packages.html"><a href="13-r-packages.html#exercises-12"><i class="fa fa-check"></i><b>13.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="14-speeding-up-r.html"><a href="14-speeding-up-r.html"><i class="fa fa-check"></i><b>14</b> Speeding up R</a><ul>
<li class="chapter" data-level="14.1" data-path="14-speeding-up-r.html"><a href="14-speeding-up-r.html#faster-for-loops"><i class="fa fa-check"></i><b>14.1</b> Faster for loops?</a></li>
<li class="chapter" data-level="14.2" data-path="14-speeding-up-r.html"><a href="14-speeding-up-r.html#vectorizing-loops"><i class="fa fa-check"></i><b>14.2</b> Vectorizing loops</a></li>
<li class="chapter" data-level="14.3" data-path="14-speeding-up-r.html"><a href="14-speeding-up-r.html#parallel-processing"><i class="fa fa-check"></i><b>14.3</b> Parallel Processing</a></li>
<li class="chapter" data-level="14.4" data-path="14-speeding-up-r.html"><a href="14-speeding-up-r.html#parallelizing-for-loops"><i class="fa fa-check"></i><b>14.4</b> Parallelizing for loops</a></li>
<li class="chapter" data-level="14.5" data-path="14-speeding-up-r.html"><a href="14-speeding-up-r.html#parallel-aware-functions"><i class="fa fa-check"></i><b>14.5</b> Parallel Aware Functions</a><ul>
<li class="chapter" data-level="14.5.1" data-path="14-speeding-up-r.html"><a href="14-speeding-up-r.html#bootboot"><i class="fa fa-check"></i><b>14.5.1</b> <code>boot::boot</code></a></li>
<li class="chapter" data-level="14.5.2" data-path="14-speeding-up-r.html"><a href="14-speeding-up-r.html#carettrain"><i class="fa fa-check"></i><b>14.5.2</b> <code>caret::train</code></a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STA 444/5 - Introductory Data Science using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-reshaping" class="section level1">
<h1><span class="header-section-number">Chapter 12</span> Data Reshaping</h1>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" data-line-number="1"><span class="co"># library(tidyr)   # for the gather/spread commands</span></a>
<a class="sourceLine" id="cb426-2" data-line-number="2"><span class="co"># library(dplyr)   # for the join stuff</span></a>
<a class="sourceLine" id="cb426-3" data-line-number="3"><span class="kw">library</span>(tidyverse) <span class="co"># dplyr, tidyr, ggplot2, etc.</span></a></code></pre></div>
<p>Most of the time, our data is in the form of a data frame and we are interested in exploring the relationships. However most procedures in R expect the data to show up in a ‘long’ format where each row is an observation and each column is a covariate. In practice, the data is often not stored like that and the data comes to us with repeated observations included on a single row. This is often done as a memory saving technique or because there is some structure in the data that makes the ‘wide’ format attractive. As a result, we need a way to convert data from ‘wide’ to ‘long’ and vice-versa.</p>
<p>Next we need a way to squish two data frames together. It is often advantagous to store data that would be be repeated seperately in a different table so that a particular piece of information lives in only one location. This makes the data easier to modify, and more likely to maintain consistence. However, this practice requires that, when necessary, we can add information to a table, that might involve a lot of duplicated rows.</p>
<div id="tidyr" class="section level2">
<h2><span class="header-section-number">12.1</span> <code>tidyr</code></h2>
<p>There is a common issue with obtaining data with many columns that you wish were organized as rows. For example, I might have data in a grade book that has several homework scores and I’d like to produce a nice graph that has assignment number on the x-axis and score on the y-axis. Unfortunately this is incredibly hard to do when the data is arranged in the following way:</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb427-1" data-line-number="1">grade.book &lt;-<span class="st"> </span><span class="kw">rbind</span>(</a>
<a class="sourceLine" id="cb427-2" data-line-number="2">  <span class="kw">data.frame</span>(<span class="dt">name=</span><span class="st">&#39;Alison&#39;</span>,  <span class="dt">HW.1=</span><span class="dv">8</span>, <span class="dt">HW.2=</span><span class="dv">5</span>, <span class="dt">HW.3=</span><span class="dv">8</span>, <span class="dt">HW.4=</span><span class="dv">4</span>),</a>
<a class="sourceLine" id="cb427-3" data-line-number="3">  <span class="kw">data.frame</span>(<span class="dt">name=</span><span class="st">&#39;Brandon&#39;</span>, <span class="dt">HW.1=</span><span class="dv">5</span>, <span class="dt">HW.2=</span><span class="dv">3</span>, <span class="dt">HW.3=</span><span class="dv">6</span>, <span class="dt">HW.4=</span><span class="dv">9</span>),</a>
<a class="sourceLine" id="cb427-4" data-line-number="4">  <span class="kw">data.frame</span>(<span class="dt">name=</span><span class="st">&#39;Charles&#39;</span>, <span class="dt">HW.1=</span><span class="dv">9</span>, <span class="dt">HW.2=</span><span class="dv">7</span>, <span class="dt">HW.3=</span><span class="dv">9</span>, <span class="dt">HW.4=</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb427-5" data-line-number="5">grade.book</a></code></pre></div>
<pre><code>##      name HW.1 HW.2 HW.3 HW.4
## 1  Alison    8    5    8    4
## 2 Brandon    5    3    6    9
## 3 Charles    9    7    9   10</code></pre>
<p>What we want to do is turn this data frame from a <em>wide</em> data frame into a <em>long</em> data frame. In MS Excel this is called pivoting. Essentially I’d like to create a data frame with three columns: <code>name</code>, <code>assignment</code>, and <code>score</code>. That is to say that each homework datum really has three pieces of information: who it came from, which homework it was, and what the score was. It doesn’t conceptually matter if I store it as 3 rows of 4 columns or 12 rows so long as there is a way to identify how a student scored on a particular homework. So we want to reshape the HW1 to HW4 columns into two columns (assignment and score).</p>
<p>This package was built by the same people that created dplyr and ggplot2 and there is a nice introduction at: [<a href="http://blog.rstudio.org/2014/07/22/introducing-tidyr/" class="uri">http://blog.rstudio.org/2014/07/22/introducing-tidyr/</a>]</p>
<div id="verbs-1" class="section level3">
<h3><span class="header-section-number">12.1.1</span> Verbs</h3>
<p>As with the dplyr package, there are two main verbs to remember:</p>
<ol style="list-style-type: decimal">
<li><p><code>gather</code> - Gather multiple columns that are related into two columns that contain the original column name and the value. For example for columns HW1, HW2, HW3 we would gather them into two column HomeworkNumber and Score. In this case, we refer to HomeworkNumber as the key column and Score as the value column. So for any key:value pair you know everything you need.</p></li>
<li><p><code>spread</code> - This is the opposite of gather. This takes a key column (or columns) and a results column and forms a new column for each level of the key column(s).</p></li>
</ol>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb429-1" data-line-number="1"><span class="co"># first we gather the score columns into columns we&#39;ll name Assesment and Score</span></a>
<a class="sourceLine" id="cb429-2" data-line-number="2">tidy.scores &lt;-<span class="st"> </span>grade.book <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb429-3" data-line-number="3"><span class="st">  </span><span class="kw">gather</span>( <span class="dt">key=</span>Homework,  <span class="co"># What should I call the key column</span></a>
<a class="sourceLine" id="cb429-4" data-line-number="4">          <span class="dt">value=</span>Score,      <span class="co"># What should I call the values column</span></a>
<a class="sourceLine" id="cb429-5" data-line-number="5">          HW<span class="fl">.1</span><span class="op">:</span>HW<span class="fl">.4</span>         <span class="co"># which columns to apply this to</span></a>
<a class="sourceLine" id="cb429-6" data-line-number="6">          )</a>
<a class="sourceLine" id="cb429-7" data-line-number="7">tidy.scores</a></code></pre></div>
<pre><code>##       name Homework Score
## 1   Alison     HW.1     8
## 2  Brandon     HW.1     5
## 3  Charles     HW.1     9
## 4   Alison     HW.2     5
## 5  Brandon     HW.2     3
## 6  Charles     HW.2     7
## 7   Alison     HW.3     8
## 8  Brandon     HW.3     6
## 9  Charles     HW.3     9
## 10  Alison     HW.4     4
## 11 Brandon     HW.4     9
## 12 Charles     HW.4    10</code></pre>
<p>To spread the key:value pairs out into a matrix, we use the <code>spread()</code> command.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb431-1" data-line-number="1"><span class="co"># Turn the Assessment/Score pair of columns into one column per factor level of Assessment</span></a>
<a class="sourceLine" id="cb431-2" data-line-number="2">tidy.scores <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">spread</span>( <span class="dt">key=</span>Homework, <span class="dt">value=</span>Score )</a></code></pre></div>
<pre><code>##      name HW.1 HW.2 HW.3 HW.4
## 1  Alison    8    5    8    4
## 2 Brandon    5    3    6    9
## 3 Charles    9    7    9   10</code></pre>
<p>One way to keep straight which is the <code>key</code> column is that the key is the category, while <code>value</code> is the numerical value or response.</p>
</div>
</div>
<div id="storing-data-in-multiple-tables" class="section level2">
<h2><span class="header-section-number">12.2</span> Storing Data in Multiple Tables</h2>
<p>In many datasets it is common to store data across multiple tables, usually with the goal of minimizing memory used as well as providing minimal duplication of information so any change that must be made is only made in a single place.</p>
<p>To see the rational why we might do this, consider building a data set of blood donations by a variety of donors across several years. For each blood donation, we will perform some assay and measure certain qualities about the blood and the patients health at the donation.</p>
<pre><code>##   Donor Hemoglobin Systolic Diastolic
## 1 Derek       17.4      121        80
## 2  Jeff       16.9      145       101</code></pre>
<p>But now we have to ask, what happens when we have a donor that has given blood multiple times? In this case we should just have multiple rows per person along with a date column to uniquely identify a particular donation.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb434-1" data-line-number="1">donations</a></code></pre></div>
<pre><code>##   Donor       Date Hemoglobin Systolic Diastolic
## 1 Derek 2017-04-14       17.4      120        79
## 2 Derek 2017-06-20       16.5      121        80
## 3  Jeff 2017-08-14       16.9      145       101</code></pre>
<p>I would like to include additional information about the donor where that infomation doesn’t change overtime. For example we might want to have information about the donar’s birthdate, sex, blood type. However, I don’t want that information in <em>every single donation line</em>. Otherwise if I mistype a birthday and have to correct it, I would have to correct it <em>everywhere</em>. For information about the donor, should live in a <code>donors</code> table, while information about a particular donation should live in the <code>donations</code> table.</p>
<p>Furthermore, there are many Jeffs and Dereks in the world and to maintain a unique identifier (without using Social Security numbers) I will just create a <code>Donor_ID</code> code that will uniquely identify a person. Similarly I will create a <code>Donation_ID</code> that will uniquely identify a dontation.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" data-line-number="1">donors</a></code></pre></div>
<pre><code>##   Donor_ID F_Name L_Name B_Type      Birth       Street      City State
## 1  Donor_1  Derek    Lee     O+ 1976-09-17 7392 Willard Flagstaff    AZ
## 2  Donor_2   Jeff  Smith      A 1974-06-23     873 Vine   Bozeman    MT</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" data-line-number="1">donations</a></code></pre></div>
<pre><code>##   Donation_ID Donor_ID       Date Hemoglobin Systolic Diastolic
## 1  Donation_1  Donor_1 2017-04-14       17.4      120        79
## 2  Donation_2  Donor_1 2017-06-20       16.5      121        80
## 3  Donation_3  Donor_2 2017-08-14       16.9      145       101</code></pre>
<p>If we have a new donor walk in and give blood, then we’ll have to create a new entry in the <code>donors</code> table as well as a new entry in the <code>donations</code> table. If an experienced donor gives again, we just have to create a new entry in the donations table.</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" data-line-number="1">donors</a></code></pre></div>
<pre><code>##   Donor_ID F_Name L_Name B_Type      Birth       Street      City State
## 1  Donor_1  Derek    Lee     O+ 1976-09-17 7392 Willard Flagstaff    AZ
## 2  Donor_2   Jeff  Smith      A 1974-06-23     873 Vine   Bozeman    MT
## 3  Donor_3 Aubrey    Lee     O+ 1980-12-15 7392 Willard Flagstaff    AZ</code></pre>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb442-1" data-line-number="1">donations</a></code></pre></div>
<pre><code>##   Donation_ID Donor_ID       Date Hemoglobin Systolic Diastolic
## 1  Donation_1  Donor_1 2017-04-14       17.4      120        79
## 2  Donation_2  Donor_1 2017-06-20       16.5      121        80
## 3  Donation_3  Donor_2 2017-08-14       16.9      145       101
## 4  Donation_4  Donor_1 2017-08-26       17.6      120        79
## 5  Donation_5  Donor_3 2017-08-26       16.1      137        90</code></pre>
<p>This data storage set-up might be flexible enough for us. However what happens if somebody moves? If we don’t want to keep the historical information, then we could just change the person’s <code>Street_Address</code>, <code>City</code>, and <code>State</code> values. If we do want to keep that, then we could create <code>donor_addresses</code> table that contains a <code>Start_Date</code> and <code>End_Date</code> that denotes the period of time that the address was valid.</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" data-line-number="1">donor_addresses</a></code></pre></div>
<pre><code>##   Donor_ID       Street      City State Start_Date   End_Date
## 1  Donor_1 346 Treeline   Pullman    WA 2015-01-26 2016-06-27
## 2  Donor_1     645 Main Flagstsff    AZ 2016-06-28 2017-07-02
## 3  Donor_1 7392 Willard Flagstaff    AZ 2017-07-03       &lt;NA&gt;
## 4  Donor_2     873 Vine   Bozeman    MT 2015-03-17       &lt;NA&gt;
## 5  Donor_3 7392 Willard Flagstaff    AZ 2017-06-01       &lt;NA&gt;</code></pre>
<p>Given this data structure, we can now easily create new donations as well as store donor information. In the event that we need to change something about a donor, there is only <em>one</em> place to make that change.</p>
<p>However, having data spread across multiple tables is challenging because I often want that information squished back together. For example, the blood donations services might want to find all ‘O’ or ‘O+’ donors in Flagstaff and their current mailing address and send them some notification about blood supplies being low. So we need someway to join the <code>donors</code> and <code>donor_addresses</code> tables together in a sensible manner.</p>
</div>
<div id="table-joins" class="section level2">
<h2><span class="header-section-number">12.3</span> Table Joins</h2>
<p>Often we need to squish together two data frames but they do not have the same number of rows. Consider the case where we have a data frame of observations of fish and a separate data frame that contains information about lake (perhaps surface area, max depth, pH, etc). I want to store them as two separate tables so that when I have to record a lake level observation, I only input it <em>one</em> place. This decreases the chance that I make a copy/paste error.</p>
<p>To illustrate the different types of table joins, we’ll consider two different tables.</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb446-1" data-line-number="1"><span class="co"># tibbles are just data.frames that print a bit nicer and don&#39;t automatically</span></a>
<a class="sourceLine" id="cb446-2" data-line-number="2"><span class="co"># convert character columns into factors.  They behave a bit more consistently</span></a>
<a class="sourceLine" id="cb446-3" data-line-number="3"><span class="co"># in a wide variety of situations compared to data.frames.</span></a>
<a class="sourceLine" id="cb446-4" data-line-number="4">Fish.Data &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb446-5" data-line-number="5">  <span class="dt">Lake_ID =</span> <span class="kw">c</span>(<span class="st">&#39;A&#39;</span>,<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;C&#39;</span>), </a>
<a class="sourceLine" id="cb446-6" data-line-number="6">  <span class="dt">Fish.Weight=</span><span class="kw">rnorm</span>(<span class="dv">6</span>, <span class="dt">mean=</span><span class="dv">260</span>, <span class="dt">sd=</span><span class="dv">25</span>) ) <span class="co"># make up some data</span></a>
<a class="sourceLine" id="cb446-7" data-line-number="7">Lake.Data &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb446-8" data-line-number="8">  <span class="dt">Lake_ID =</span> <span class="kw">c</span>(    <span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>),   </a>
<a class="sourceLine" id="cb446-9" data-line-number="9">  <span class="dt">Lake_Name =</span> <span class="kw">c</span>(<span class="st">&#39;Lake Elaine&#39;</span>, <span class="st">&#39;Mormon Lake&#39;</span>, <span class="st">&#39;Lake Mary&#39;</span>),   </a>
<a class="sourceLine" id="cb446-10" data-line-number="10">  <span class="dt">pH=</span><span class="kw">c</span>(<span class="fl">6.5</span>, <span class="fl">6.3</span>, <span class="fl">6.1</span>),</a>
<a class="sourceLine" id="cb446-11" data-line-number="11">  <span class="dt">area =</span> <span class="kw">c</span>(<span class="dv">40</span>, <span class="dv">210</span>, <span class="dv">240</span>),</a>
<a class="sourceLine" id="cb446-12" data-line-number="12">  <span class="dt">avg_depth =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">38</span>))</a></code></pre></div>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb447-1" data-line-number="1">Fish.Data</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   Lake_ID Fish.Weight
##   &lt;chr&gt;         &lt;dbl&gt;
## 1 A              257.
## 2 A              289.
## 3 B              274.
## 4 B              245.
## 5 C              263.
## 6 C              257.</code></pre>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb449-1" data-line-number="1">Lake.Data</a></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   Lake_ID Lake_Name      pH  area avg_depth
##   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 B       Lake Elaine   6.5    40         8
## 2 C       Mormon Lake   6.3   210        10
## 3 D       Lake Mary     6.1   240        38</code></pre>
<p>Notice that each of these tables has a column labled <code>Lake_ID</code>. When we join these two tables, the row that describes lake <code>A</code> should be duplicated for each row in the <code>Fish.Data</code> that corresponds with fish caught from lake <code>A</code>.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb451-1" data-line-number="1"><span class="kw">full_join</span>(Fish.Data, Lake.Data)</a></code></pre></div>
<pre><code>## Joining, by = &quot;Lake_ID&quot;</code></pre>
<pre><code>## # A tibble: 7 x 6
##   Lake_ID Fish.Weight Lake_Name      pH  area avg_depth
##   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 A              257. &lt;NA&gt;         NA      NA        NA
## 2 A              289. &lt;NA&gt;         NA      NA        NA
## 3 B              274. Lake Elaine   6.5    40         8
## 4 B              245. Lake Elaine   6.5    40         8
## 5 C              263. Mormon Lake   6.3   210        10
## 6 C              257. Mormon Lake   6.3   210        10
## 7 D               NA  Lake Mary     6.1   240        38</code></pre>
<p>Notice that because we didn’t have any fish caught in lake <code>D</code> and we don’t have any Lake information about lake <code>A</code>, when we join these two tables, we end up introducing missing observations into the resulting data frame.</p>
<p>The other types of joins govern the behavor or these missing data.</p>
<p><strong><code>left_join(A, B)</code></strong> For each row in A, match with a row in B, but don’t create any more rows than what was already in A.</p>
<p><strong><code>inner_join(A,B)</code></strong> Only match row values where both data frames have a value.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb454-1" data-line-number="1"><span class="kw">left_join</span>(Fish.Data, Lake.Data)</a></code></pre></div>
<pre><code>## Joining, by = &quot;Lake_ID&quot;</code></pre>
<pre><code>## # A tibble: 6 x 6
##   Lake_ID Fish.Weight Lake_Name      pH  area avg_depth
##   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 A              257. &lt;NA&gt;         NA      NA        NA
## 2 A              289. &lt;NA&gt;         NA      NA        NA
## 3 B              274. Lake Elaine   6.5    40         8
## 4 B              245. Lake Elaine   6.5    40         8
## 5 C              263. Mormon Lake   6.3   210        10
## 6 C              257. Mormon Lake   6.3   210        10</code></pre>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb457-1" data-line-number="1"><span class="kw">inner_join</span>(Fish.Data, Lake.Data)</a></code></pre></div>
<pre><code>## Joining, by = &quot;Lake_ID&quot;</code></pre>
<pre><code>## # A tibble: 4 x 6
##   Lake_ID Fish.Weight Lake_Name      pH  area avg_depth
##   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 B              274. Lake Elaine   6.5    40         8
## 2 B              245. Lake Elaine   6.5    40         8
## 3 C              263. Mormon Lake   6.3   210        10
## 4 C              257. Mormon Lake   6.3   210        10</code></pre>
<p>The above examples assumed that the column used to join the two tables was named the same in both tables. This is good practice to try to do, but sometimes you have to work with data where that isn’t the case. In that situation you can use the <code>by=c(&quot;ColName.A&quot;=&quot;ColName.B&quot;)</code> syntax where <code>ColName.A</code> represents the name of the column in the first data frame and <code>ColName.B</code> is the equivalent column in the second data frame.</p>
<p>Finally, the combination of <code>gather</code> and <code>join</code> allows me to do some very complex calculations across many columns of a data set. For example, I might gather up a set of columns, calculate some summary statistics, and then join the result back to original data set.</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb460-1" data-line-number="1">grade.book <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb460-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb460-3" data-line-number="3"><span class="st">  </span><span class="kw">gather</span>( <span class="dt">key=</span>Homework, <span class="dt">value=</span>Score, HW<span class="fl">.1</span><span class="op">:</span>HW<span class="fl">.4</span> ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb460-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>( <span class="dt">HW.avg =</span> <span class="kw">mean</span>(Score) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb460-5" data-line-number="5"><span class="st">  </span><span class="kw">left_join</span>( grade.book, . )</a></code></pre></div>
<pre><code>## Joining, by = &quot;name&quot;</code></pre>
<pre><code>##      name HW.1 HW.2 HW.3 HW.4 HW.avg
## 1  Alison    8    5    8    4   6.25
## 2 Brandon    5    3    6    9   5.75
## 3 Charles    9    7    9   10   8.75</code></pre>
</div>
<div id="exercises-11" class="section level2">
<h2><span class="header-section-number">12.4</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>Suppose we are given information about the maximum daily temperature from a weather station in Flagstaff, AZ. The file is available at the GitHub site that this book is hosted on.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb463-1" data-line-number="1">FlagTemp &lt;-<span class="st">  </span><span class="kw">read.csv</span>(</a>
<a class="sourceLine" id="cb463-2" data-line-number="2">  <span class="st">&#39;https://github.com/dereksonderegger/570L/raw/master/data-raw/FlagMaxTemp.csv&#39;</span>,</a>
<a class="sourceLine" id="cb463-3" data-line-number="3">   <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">sep=</span><span class="st">&#39;,&#39;</span>)</a></code></pre></div>
<p>This file is in a wide format, where each row represents a month and the columns X1, X2, …, X31 represent the day of the month the observation was made.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Convert data set to the long format where the data has only four columns: <code>Year</code>, <code>Month</code>, <code>Day</code>, <code>Tmax</code>.</p></li>
<li><p>Calculate the average monthly maximum temperature for each Month in the dataset (So there will be 365 mean maximum temperatures). <em>You’ll probably have some issues taking the mean because there are a number of values that are missing and by default R refuses to take means and sums when there is missing data. The argument <code>na.rm=TRUE</code> to <code>mean()</code> allows you to force R to remove the missing observations before calculating the mean.</em></p></li>
<li><p>Convert the average month maximums back to a wide data format where each line represents a year and there are 12 columns of temperature data (one for each month) along with a column for the year. <em>There will be a couple of months that still have missing data because the weather station was out of commision for those months and there was NO data for the entire month.</em></p></li>
</ol></li>
<li>A common task is to take a set of data that has multiple categorical variables and create a table of the number of cases for each combination. An introductory statistics textbook contains a dataset summarizing student surveys from several sections of an intro class. The two variables of interest for us are <code>Gender</code> and <code>Year</code> which are the students gender and year in college.
<ol style="list-style-type: lower-alpha">
<li><p>Download the dataset and correctly order the <code>Year</code> variable using the following:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb464-1" data-line-number="1">Survey &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;http://www.lock5stat.com/datasets/StudentSurvey.csv&#39;</span>, <span class="dt">na.strings=</span><span class="kw">c</span>(<span class="st">&#39;&#39;</span>,<span class="st">&#39; &#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb464-2" data-line-number="2"><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">Year =</span> <span class="kw">factor</span>(Year, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&#39;FirstYear&#39;</span>,<span class="st">&#39;Sophomore&#39;</span>,<span class="st">&#39;Junior&#39;</span>,<span class="st">&#39;Senior&#39;</span>)))</a></code></pre></div></li>
<li>Using some combination of <code>dplyr</code> functions, produce a data set with eight rows that contains the number of responses for each gender:year combination. <em>Notice there are two females that neglected to give their Year and you should remove them first. The function <code>is.na(Year)</code> will return logical values indicating if the Year value was missing and you can flip those values using the negation operator <code>!</code>. So you might consider using <code>!is.na(Year)</code> as the argument to a <code>filter()</code> command. Alternatively you could sort on <code>Year</code> and remove the first two rows using <code>slice(-2:-1)</code>. Next you’ll want to summarize each Year/Gender group using the <code>n()</code> function which gives the number of rows in a data set.</em></li>
<li><p>Using <code>tidyr</code> commands, produce a table of the number of responses in the following form:</p>
<table>
<thead>
<tr class="header">
<th align="center">Gender</th>
<th align="center">First Year</th>
<th align="center">Sophmore</th>
<th align="center">Junior</th>
<th align="center">Senior</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>Female</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center"><strong>Male</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody>
</table></li>
</ol></li>
<li><p>The package <code>nycflights13</code> contains information about all the flights that arrived in or left from New York City in 2013. This package contains five data tables, but there are three data tables we will work with. The data table <code>flights</code> gives information about a particular flight, <code>airports</code> gives information about a particular airport, and <code>airlines</code> gives information about each airline. Create a table of all the flights on February 14th by Virgin America that has columns for the carrier, destination, departure time, and flight duration. Join this table with the airports information for the destination. Notice that because the column for the destination airport code doesn’t match up between <code>flights</code> and <code>airports</code>, you’ll have to use the <code>by=c(&quot;TableA.Col&quot;=&quot;TableB.Col&quot;)</code> argument where you insert the correct names for <code>TableA.Col</code> and <code>TableB.Col</code>.</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="11-dates-and-times.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="13-r-packages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"],
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dereksonderegger/444/raw/master/28_DataReshaping.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
