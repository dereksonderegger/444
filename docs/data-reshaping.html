<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 Data Reshaping | STA 444/5 - Introductory Data Science using R</title>
  <meta name="description" content="Chapter 13 Data Reshaping | STA 444/5 - Introductory Data Science using R" />
  <meta name="generator" content="bookdown 0.20.6 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 Data Reshaping | STA 444/5 - Introductory Data Science using R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/Cover1.png" />
  
  <meta name="github-repo" content="dereksonderegger/444" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 Data Reshaping | STA 444/5 - Introductory Data Science using R" />
  
  
  <meta name="twitter:image" content="images/Cover1.png" />

<meta name="author" content="Derek L. Sonderegger" />


<meta name="date" content="2020-11-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dates-and-times.html"/>
<link rel="next" href="maps.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-resources"><i class="fa fa-check"></i>Other Resources</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="part"><span><b>Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="familiarization.html"><a href="familiarization.html"><i class="fa fa-check"></i><b>1</b> Familiarization</a>
<ul>
<li class="chapter" data-level="1.1" data-path="familiarization.html"><a href="familiarization.html#working-within-an-rmarkdown-file"><i class="fa fa-check"></i><b>1.1</b> Working within an Rmarkdown File</a></li>
<li class="chapter" data-level="1.2" data-path="familiarization.html"><a href="familiarization.html#r-file-types"><i class="fa fa-check"></i><b>1.2</b> R file Types</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="familiarization.html"><a href="familiarization.html#r-scripts-.r-files"><i class="fa fa-check"></i><b>1.2.1</b> R Scripts (.R files)</a></li>
<li class="chapter" data-level="1.2.2" data-path="familiarization.html"><a href="familiarization.html#r-markdown-.rmd-files"><i class="fa fa-check"></i><b>1.2.2</b> R Markdown (.Rmd files)</a></li>
<li class="chapter" data-level="1.2.3" data-path="familiarization.html"><a href="familiarization.html#r-notebooks-.rmd-files"><i class="fa fa-check"></i><b>1.2.3</b> R Notebooks (.Rmd files)</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="familiarization.html"><a href="familiarization.html#r-as-a-simple-calculator"><i class="fa fa-check"></i><b>1.3</b> R as a simple calculator</a></li>
<li class="chapter" data-level="1.4" data-path="familiarization.html"><a href="familiarization.html#assignment"><i class="fa fa-check"></i><b>1.4</b> Assignment</a></li>
<li class="chapter" data-level="1.5" data-path="familiarization.html"><a href="familiarization.html#vectors"><i class="fa fa-check"></i><b>1.5</b> Vectors</a></li>
<li class="chapter" data-level="1.6" data-path="familiarization.html"><a href="familiarization.html#packages"><i class="fa fa-check"></i><b>1.6</b> Packages</a></li>
<li class="chapter" data-level="1.7" data-path="familiarization.html"><a href="familiarization.html#finding-help"><i class="fa fa-check"></i><b>1.7</b> Finding Help</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="familiarization.html"><a href="familiarization.html#how-does-this-function-work"><i class="fa fa-check"></i><b>1.7.1</b> How does this function work?</a></li>
<li class="chapter" data-level="1.7.2" data-path="familiarization.html"><a href="familiarization.html#how-does-this-package-work"><i class="fa fa-check"></i><b>1.7.2</b> How does this package work?</a></li>
<li class="chapter" data-level="1.7.3" data-path="familiarization.html"><a href="familiarization.html#how-do-i-do-xxx"><i class="fa fa-check"></i><b>1.7.3</b> How do I do XXX?</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="familiarization.html"><a href="familiarization.html#Exercises_Familiarization"><i class="fa fa-check"></i><b>1.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-frames.html"><a href="data-frames.html"><i class="fa fa-check"></i><b>2</b> Data Frames</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-frames.html"><a href="data-frames.html#introduction-to-importing-data"><i class="fa fa-check"></i><b>2.1</b> Introduction to Importing Data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-frames.html"><a href="data-frames.html#from-a-package"><i class="fa fa-check"></i><b>2.1.1</b> From a Package</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-frames.html"><a href="data-frames.html#import-from-.csv-or-.xls-files"><i class="fa fa-check"></i><b>2.1.2</b> Import from <code>.csv</code> or <code>.xls</code> files</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-frames.html"><a href="data-frames.html#data-types"><i class="fa fa-check"></i><b>2.2</b> Data Types</a></li>
<li class="chapter" data-level="2.3" data-path="data-frames.html"><a href="data-frames.html#basic-manipulation"><i class="fa fa-check"></i><b>2.3</b> Basic Manipulation</a></li>
<li class="chapter" data-level="2.4" data-path="data-frames.html"><a href="data-frames.html#Exercises_IntroDataFrames"><i class="fa fa-check"></i><b>2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="graphing.html"><a href="graphing.html"><i class="fa fa-check"></i><b>3</b> Graphing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="graphing.html"><a href="graphing.html#basic-graphs"><i class="fa fa-check"></i><b>3.1</b> Basic Graphs</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="graphing.html"><a href="graphing.html#scatterplots"><i class="fa fa-check"></i><b>3.1.1</b> Scatterplots</a></li>
<li class="chapter" data-level="3.1.2" data-path="graphing.html"><a href="graphing.html#box-plots"><i class="fa fa-check"></i><b>3.1.2</b> Box Plots</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="graphing.html"><a href="graphing.html#faceting"><i class="fa fa-check"></i><b>3.2</b> Faceting</a></li>
<li class="chapter" data-level="3.3" data-path="graphing.html"><a href="graphing.html#annotation"><i class="fa fa-check"></i><b>3.3</b> Annotation</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="graphing.html"><a href="graphing.html#axis-labels-and-titles"><i class="fa fa-check"></i><b>3.3.1</b> Axis Labels and Titles</a></li>
<li class="chapter" data-level="3.3.2" data-path="graphing.html"><a href="graphing.html#text-labels"><i class="fa fa-check"></i><b>3.3.2</b> Text Labels</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="graphing.html"><a href="graphing.html#Exercises_IntroGraphing"><i class="fa fa-check"></i><b>3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>4</b> Data Wrangling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-wrangling.html"><a href="data-wrangling.html#verbs"><i class="fa fa-check"></i><b>4.1</b> Verbs</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="data-wrangling.html"><a href="data-wrangling.html#add_row"><i class="fa fa-check"></i><b>4.1.1</b> <code>add_row</code></a></li>
<li class="chapter" data-level="4.1.2" data-path="data-wrangling.html"><a href="data-wrangling.html#bind_rows"><i class="fa fa-check"></i><b>4.1.2</b> <code>bind_rows</code></a></li>
<li class="chapter" data-level="4.1.3" data-path="data-wrangling.html"><a href="data-wrangling.html#subsetting"><i class="fa fa-check"></i><b>4.1.3</b> Subsetting</a></li>
<li class="chapter" data-level="4.1.4" data-path="data-wrangling.html"><a href="data-wrangling.html#arrange"><i class="fa fa-check"></i><b>4.1.4</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="4.1.5" data-path="data-wrangling.html"><a href="data-wrangling.html#mutate"><i class="fa fa-check"></i><b>4.1.5</b> mutate()</a></li>
<li class="chapter" data-level="4.1.6" data-path="data-wrangling.html"><a href="data-wrangling.html#summarise"><i class="fa fa-check"></i><b>4.1.6</b> summarise()</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="data-wrangling.html"><a href="data-wrangling.html#split-apply-combine"><i class="fa fa-check"></i><b>4.2</b> Split, apply, combine</a></li>
<li class="chapter" data-level="4.3" data-path="data-wrangling.html"><a href="data-wrangling.html#Exercises_IntroDataWrangling"><i class="fa fa-check"></i><b>4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>5</b> Statistical Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="statistical-models.html"><a href="statistical-models.html#formula-notation"><i class="fa fa-check"></i><b>5.1</b> Formula Notation</a></li>
<li class="chapter" data-level="5.2" data-path="statistical-models.html"><a href="statistical-models.html#basic-models"><i class="fa fa-check"></i><b>5.2</b> Basic Models</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="statistical-models.html"><a href="statistical-models.html#t-tests"><i class="fa fa-check"></i><b>5.2.1</b> t-tests</a></li>
<li class="chapter" data-level="5.2.2" data-path="statistical-models.html"><a href="statistical-models.html#lm-objects"><i class="fa fa-check"></i><b>5.2.2</b> lm objects</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="statistical-models.html"><a href="statistical-models.html#accessor-function"><i class="fa fa-check"></i><b>5.3</b> Accessor function</a></li>
<li class="chapter" data-level="5.4" data-path="statistical-models.html"><a href="statistical-models.html#Exercises_ModelBuilding"><i class="fa fa-check"></i><b>5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="flow-control.html"><a href="flow-control.html"><i class="fa fa-check"></i><b>6</b> Flow Control</a>
<ul>
<li class="chapter" data-level="6.1" data-path="flow-control.html"><a href="flow-control.html#logical-expressions"><i class="fa fa-check"></i><b>6.1</b> Logical Expressions</a></li>
<li class="chapter" data-level="6.2" data-path="flow-control.html"><a href="flow-control.html#decision-statements"><i class="fa fa-check"></i><b>6.2</b> Decision statements</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="flow-control.html"><a href="flow-control.html#in-dplyr-wrangling"><i class="fa fa-check"></i><b>6.2.1</b> In <code>dplyr</code> wrangling</a></li>
<li class="chapter" data-level="6.2.2" data-path="flow-control.html"><a href="flow-control.html#general-if-else"><i class="fa fa-check"></i><b>6.2.2</b> General <code>if else</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="flow-control.html"><a href="flow-control.html#loops"><i class="fa fa-check"></i><b>6.3</b> Loops</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="flow-control.html"><a href="flow-control.html#while-loops"><i class="fa fa-check"></i><b>6.3.1</b> <code>while</code> Loops</a></li>
<li class="chapter" data-level="6.3.2" data-path="flow-control.html"><a href="flow-control.html#for-loops"><i class="fa fa-check"></i><b>6.3.2</b> <code>for</code> Loops</a></li>
<li class="chapter" data-level="6.3.3" data-path="flow-control.html"><a href="flow-control.html#mosaicdo-loops"><i class="fa fa-check"></i><b>6.3.3</b> <code>mosaic::do()</code> loops</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="flow-control.html"><a href="flow-control.html#functions"><i class="fa fa-check"></i><b>6.4</b> Functions</a></li>
<li class="chapter" data-level="6.5" data-path="flow-control.html"><a href="flow-control.html#Exercises_FlowControl"><i class="fa fa-check"></i><b>6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>7</b> Factors</a>
<ul>
<li class="chapter" data-level="7.1" data-path="factors.html"><a href="factors.html#creation-and-structure"><i class="fa fa-check"></i><b>7.1</b> Creation and Structure</a></li>
<li class="chapter" data-level="7.2" data-path="factors.html"><a href="factors.html#change-labels"><i class="fa fa-check"></i><b>7.2</b> Change Labels</a></li>
<li class="chapter" data-level="7.3" data-path="factors.html"><a href="factors.html#reorder-levels-1"><i class="fa fa-check"></i><b>7.3</b> Reorder Levels</a></li>
<li class="chapter" data-level="7.4" data-path="factors.html"><a href="factors.html#add-or-substract-levels"><i class="fa fa-check"></i><b>7.4</b> Add or substract Levels</a></li>
<li class="chapter" data-level="7.5" data-path="factors.html"><a href="factors.html#Exercises_Factors"><i class="fa fa-check"></i><b>7.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>Miscellaneous</b></span></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html"><i class="fa fa-check"></i>Statistical Tables</a>
<ul>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#example-distributions"><i class="fa fa-check"></i>Example Distributions</a></li>
<li><a href="statistical-tables.html#mosaicplotdist-function"><code>mosaic::plotDist()</code> function</a></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#base-r-functions"><i class="fa fa-check"></i>Base R functions</a>
<ul>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#d-function"><i class="fa fa-check"></i>d-function</a></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#p-function"><i class="fa fa-check"></i>p-function</a></li>
<li><a href="statistical-tables.html#q-function"><code>q</code>-function</a></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#r-function"><i class="fa fa-check"></i>r-function</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="statistical-tables.html"><a href="statistical-tables.html#Exercises_Statistical_Tables"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html"><i class="fa fa-check"></i>Rmarkdown Tricks</a>
<ul>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#chunk-options"><i class="fa fa-check"></i>Chunk Options</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#verbatim-list-environments"><i class="fa fa-check"></i>Verbatim &amp; List Environments</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#mathematical-expressions"><i class="fa fa-check"></i>Mathematical expressions</a></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#tables"><i class="fa fa-check"></i>Tables</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#simple-tables"><i class="fa fa-check"></i><b>7.5.1</b> Simple Tables</a></li>
<li class="chapter" data-level="7.5.2" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#grid-tables"><i class="fa fa-check"></i><b>7.5.2</b> Grid Tables</a></li>
<li class="chapter" data-level="7.5.3" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#pipe-tables"><i class="fa fa-check"></i><b>7.5.3</b> Pipe Tables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#r-functions-to-produce-table-code."><i class="fa fa-check"></i>R functions to produce table code.</a>
<ul>
<li class="chapter" data-level="7.5.4" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#knitrkable"><i class="fa fa-check"></i><b>7.5.4</b> <code class="unnumbered">knitr::kable</code></a></li>
<li class="chapter" data-level="7.5.5" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#package-pander"><i class="fa fa-check"></i><b>7.5.5</b> Package <code class="unnumbered">pander</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="rmarkdown-tricks.html"><a href="rmarkdown-tricks.html#code-appendix"><i class="fa fa-check"></i>Code Appendix</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html"><i class="fa fa-check"></i>Data Wrangling Process</a>
<ul>
<li class="chapter" data-level="7.6" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#introduction"><i class="fa fa-check"></i><b>7.6</b> Introduction</a></li>
<li class="chapter" data-level="7.7" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#import"><i class="fa fa-check"></i><b>7.7</b> Import</a></li>
<li class="chapter" data-level="7.8" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#tidying"><i class="fa fa-check"></i><b>7.8</b> Tidying</a></li>
<li class="chapter" data-level="7.9" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#cleaning"><i class="fa fa-check"></i><b>7.9</b> Cleaning</a></li>
<li class="chapter" data-level="7.10" data-path="data-wrangling-process.html"><a href="data-wrangling-process.html#use"><i class="fa fa-check"></i><b>7.10</b> Use</a></li>
</ul></li>
<li class="part"><span><b>Deeper Details</b></span></li>
<li class="chapter" data-level="8" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>8</b> Data Structures</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-structures.html"><a href="data-structures.html#DataStructures_Vectors"><i class="fa fa-check"></i><b>8.1</b> Vectors</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="data-structures.html"><a href="data-structures.html#DataStructures_AccessingVectorElements"><i class="fa fa-check"></i><b>8.1.1</b> Accessing Vector Elements</a></li>
<li class="chapter" data-level="8.1.2" data-path="data-structures.html"><a href="data-structures.html#DataStructures_ScalarFunctions"><i class="fa fa-check"></i><b>8.1.2</b> Scalar Functions Applied to Vectors</a></li>
<li class="chapter" data-level="8.1.3" data-path="data-structures.html"><a href="data-structures.html#DataStructures_VectorAlgebra"><i class="fa fa-check"></i><b>8.1.3</b> Vector Algebra</a></li>
<li class="chapter" data-level="8.1.4" data-path="data-structures.html"><a href="data-structures.html#DataStructures_CommonVectorFunctions"><i class="fa fa-check"></i><b>8.1.4</b> Commonly Used Vector Functions</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="data-structures.html"><a href="data-structures.html#DataStructures_Matrices"><i class="fa fa-check"></i><b>8.2</b> Matrices</a></li>
<li class="chapter" data-level="8.3" data-path="data-structures.html"><a href="data-structures.html#DataStructures_DataFrames"><i class="fa fa-check"></i><b>8.3</b> Data Frames</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-structures.html"><a href="data-structures.html#DataStructures_Tibbles"><i class="fa fa-check"></i><b>8.3.1</b> <code>data.frames</code> vs <code>tibbles</code></a></li>
<li class="chapter" data-level="8.3.2" data-path="data-structures.html"><a href="data-structures.html#access-via-vs"><i class="fa fa-check"></i><b>8.3.2</b> Access via <code>[ ]</code> vs <code>[[ ]]</code></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-structures.html"><a href="data-structures.html#DataStructures_Lists"><i class="fa fa-check"></i><b>8.4</b> Lists</a></li>
<li class="chapter" data-level="8.5" data-path="data-structures.html"><a href="data-structures.html#Exercises_DataStructures"><i class="fa fa-check"></i><b>8.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i><b>9</b> Importing Data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="importing-data.html"><a href="importing-data.html#working-directory"><i class="fa fa-check"></i><b>9.1</b> Working directory</a></li>
<li class="chapter" data-level="9.2" data-path="importing-data.html"><a href="importing-data.html#comma-separated-data"><i class="fa fa-check"></i><b>9.2</b> Comma Separated Data</a></li>
<li class="chapter" data-level="9.3" data-path="importing-data.html"><a href="importing-data.html#ms-excel"><i class="fa fa-check"></i><b>9.3</b> MS Excel</a></li>
<li class="chapter" data-level="9.4" data-path="importing-data.html"><a href="importing-data.html#multiple-files"><i class="fa fa-check"></i><b>9.4</b> Multiple files</a></li>
<li class="chapter" data-level="9.5" data-path="importing-data.html"><a href="importing-data.html#Exercises_DataImport"><i class="fa fa-check"></i><b>9.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html"><i class="fa fa-check"></i><b>10</b> Functions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html#basic-function-definition"><i class="fa fa-check"></i><b>10.1</b> Basic function definition</a></li>
<li class="chapter" data-level="10.2" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html#parameter-defaults"><i class="fa fa-check"></i><b>10.2</b> Parameter Defaults</a></li>
<li class="chapter" data-level="10.3" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html#ellipses"><i class="fa fa-check"></i><b>10.3</b> Ellipses</a></li>
<li class="chapter" data-level="10.4" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html#function-overloading"><i class="fa fa-check"></i><b>10.4</b> Function Overloading</a></li>
<li class="chapter" data-level="10.5" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html#debugging"><i class="fa fa-check"></i><b>10.5</b> Debugging</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html#rmarkdown-recommendations"><i class="fa fa-check"></i><b>10.5.1</b> Rmarkdown Recommendations</a></li>
<li class="chapter" data-level="10.5.2" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html#step-wise-execution"><i class="fa fa-check"></i><b>10.5.2</b> Step-wise Execution</a></li>
<li class="chapter" data-level="10.5.3" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html#print-statements"><i class="fa fa-check"></i><b>10.5.3</b> Print Statements</a></li>
<li class="chapter" data-level="10.5.4" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html#browser"><i class="fa fa-check"></i><b>10.5.4</b> <code>browser</code></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html#scope"><i class="fa fa-check"></i><b>10.6</b> Scope</a></li>
<li class="chapter" data-level="10.7" data-path="Function-Chapter-Details.html"><a href="Function-Chapter-Details.html#Exercises_Functions"><i class="fa fa-check"></i><b>10.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="string-manipulation.html"><a href="string-manipulation.html"><i class="fa fa-check"></i><b>11</b> String Manipulation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="string-manipulation.html"><a href="string-manipulation.html#base-function"><i class="fa fa-check"></i><b>11.1</b> Base function</a></li>
<li class="chapter" data-level="11.2" data-path="string-manipulation.html"><a href="string-manipulation.html#stringr-basic-operations"><i class="fa fa-check"></i><b>11.2</b> <code>stringr</code>: Basic operations</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="string-manipulation.html"><a href="string-manipulation.html#concatenating-with-str_c-or-str_join"><i class="fa fa-check"></i><b>11.2.1</b> Concatenating with <code>str_c()</code> or <code>str_join()</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="string-manipulation.html"><a href="string-manipulation.html#calculating-string-length-with-str_length"><i class="fa fa-check"></i><b>11.2.2</b> Calculating string length with <code>str_length()</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="string-manipulation.html"><a href="string-manipulation.html#extracting-substrings-with-str_sub"><i class="fa fa-check"></i><b>11.2.3</b> Extracting substrings with <code>str_sub()</code></a></li>
<li class="chapter" data-level="11.2.4" data-path="string-manipulation.html"><a href="string-manipulation.html#pad-a-string-with-str_pad"><i class="fa fa-check"></i><b>11.2.4</b> Pad a string with <code>str_pad()</code></a></li>
<li class="chapter" data-level="11.2.5" data-path="string-manipulation.html"><a href="string-manipulation.html#trim-a-string-with-str_trim"><i class="fa fa-check"></i><b>11.2.5</b> Trim a string with <code>str_trim()</code></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="string-manipulation.html"><a href="string-manipulation.html#stringr-pattern-matching-tools"><i class="fa fa-check"></i><b>11.3</b> <code>stringr</code>: Pattern Matching Tools</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="string-manipulation.html"><a href="string-manipulation.html#detecting-a-pattern-using-str_detect"><i class="fa fa-check"></i><b>11.3.1</b> Detecting a pattern using str_detect()</a></li>
<li class="chapter" data-level="11.3.2" data-path="string-manipulation.html"><a href="string-manipulation.html#locating-a-pattern-using-str_locate"><i class="fa fa-check"></i><b>11.3.2</b> Locating a pattern using str_locate()</a></li>
<li class="chapter" data-level="11.3.3" data-path="string-manipulation.html"><a href="string-manipulation.html#replacing-sub-strings-using-str_replace"><i class="fa fa-check"></i><b>11.3.3</b> Replacing sub-strings using <code>str_replace()</code></a></li>
<li class="chapter" data-level="11.3.4" data-path="string-manipulation.html"><a href="string-manipulation.html#splitting-into-sub-strings-using-str_split-and-tidyrseparate"><i class="fa fa-check"></i><b>11.3.4</b> Splitting into sub-strings using <code>str_split()</code> and <code>tidyr::separate()</code></a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="string-manipulation.html"><a href="string-manipulation.html#regular-expressions"><i class="fa fa-check"></i><b>11.4</b> Regular Expressions</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="string-manipulation.html"><a href="string-manipulation.html#regular-expression-ingredients"><i class="fa fa-check"></i><b>11.4.1</b> Regular Expression Ingredients</a></li>
<li class="chapter" data-level="11.4.2" data-path="string-manipulation.html"><a href="string-manipulation.html#matching-a-specific-string"><i class="fa fa-check"></i><b>11.4.2</b> Matching a specific string</a></li>
<li class="chapter" data-level="11.4.3" data-path="string-manipulation.html"><a href="string-manipulation.html#matching-arbitrary-numbers"><i class="fa fa-check"></i><b>11.4.3</b> Matching arbitrary numbers</a></li>
<li class="chapter" data-level="11.4.4" data-path="string-manipulation.html"><a href="string-manipulation.html#greedy-matching"><i class="fa fa-check"></i><b>11.4.4</b> Greedy matching</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="string-manipulation.html"><a href="string-manipulation.html#fuzzy-pattern-matching"><i class="fa fa-check"></i><b>11.5</b> Fuzzy Pattern Matching</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="string-manipulation.html"><a href="string-manipulation.html#key-collision-merge"><i class="fa fa-check"></i><b>11.5.1</b> Key Collision Merge</a></li>
<li class="chapter" data-level="11.5.2" data-path="string-manipulation.html"><a href="string-manipulation.html#string-distances"><i class="fa fa-check"></i><b>11.5.2</b> String Distances</a></li>
<li class="chapter" data-level="11.5.3" data-path="string-manipulation.html"><a href="string-manipulation.html#n-gram-merge"><i class="fa fa-check"></i><b>11.5.3</b> N-gram Merge</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="string-manipulation.html"><a href="string-manipulation.html#Exercises_Strings"><i class="fa fa-check"></i><b>11.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>12</b> Dates and Times</a>
<ul>
<li class="chapter" data-level="12.1" data-path="dates-and-times.html"><a href="dates-and-times.html#creating-date-and-time-objects"><i class="fa fa-check"></i><b>12.1</b> Creating Date and Time objects</a></li>
<li class="chapter" data-level="12.2" data-path="dates-and-times.html"><a href="dates-and-times.html#time-zones"><i class="fa fa-check"></i><b>12.2</b> Time Zones</a></li>
<li class="chapter" data-level="12.3" data-path="dates-and-times.html"><a href="dates-and-times.html#extracting-information"><i class="fa fa-check"></i><b>12.3</b> Extracting information</a></li>
<li class="chapter" data-level="12.4" data-path="dates-and-times.html"><a href="dates-and-times.html#printing-dates"><i class="fa fa-check"></i><b>12.4</b> Printing Dates</a></li>
<li class="chapter" data-level="12.5" data-path="dates-and-times.html"><a href="dates-and-times.html#arithmetic-on-dates"><i class="fa fa-check"></i><b>12.5</b> Arithmetic on Dates</a></li>
<li class="chapter" data-level="12.6" data-path="dates-and-times.html"><a href="dates-and-times.html#Exercises_Dates"><i class="fa fa-check"></i><b>12.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="data-reshaping.html"><a href="data-reshaping.html"><i class="fa fa-check"></i><b>13</b> Data Reshaping</a>
<ul>
<li class="chapter" data-level="13.1" data-path="data-reshaping.html"><a href="data-reshaping.html#cbind-rbind"><i class="fa fa-check"></i><b>13.1</b> <code>cbind</code> &amp; <code>rbind</code></a></li>
<li class="chapter" data-level="13.2" data-path="data-reshaping.html"><a href="data-reshaping.html#table-pivots"><i class="fa fa-check"></i><b>13.2</b> Table Pivots</a></li>
<li class="chapter" data-level="13.3" data-path="data-reshaping.html"><a href="data-reshaping.html#spreading-a-single-column-with-separate"><i class="fa fa-check"></i><b>13.3</b> Spreading a Single Column with <code>separate</code></a></li>
<li class="chapter" data-level="13.4" data-path="data-reshaping.html"><a href="data-reshaping.html#storing-data-in-multiple-tables"><i class="fa fa-check"></i><b>13.4</b> Storing Data in Multiple Tables</a></li>
<li class="chapter" data-level="13.5" data-path="data-reshaping.html"><a href="data-reshaping.html#table-joins"><i class="fa fa-check"></i><b>13.5</b> Table Joins</a></li>
<li class="chapter" data-level="13.6" data-path="data-reshaping.html"><a href="data-reshaping.html#row-wise-calculations"><i class="fa fa-check"></i><b>13.6</b> Row-wise Calculations</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="data-reshaping.html"><a href="data-reshaping.html#using-base-apply-function"><i class="fa fa-check"></i><b>13.6.1</b> Using base <code>apply()</code> function</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="data-reshaping.html"><a href="data-reshaping.html#Exercises_DataReshaping"><i class="fa fa-check"></i><b>13.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i>Maps</a>
<ul>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#introduction-1"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#coordinate-reference-systems-crs"><i class="fa fa-check"></i>Coordinate Reference Systems (CRS)</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#spatial-objects"><i class="fa fa-check"></i>Spatial Objects</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#tiles"><i class="fa fa-check"></i>Tiles</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#obtaining-spatial-data"><i class="fa fa-check"></i>Obtaining Spatial Data</a>
<ul>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#natural-earth-database"><i class="fa fa-check"></i>Natural Earth Database</a></li>
<li class="chapter" data-level="13.7.1" data-path="maps.html"><a href="maps.html#package-maps"><i class="fa fa-check"></i><b>13.7.1</b> Package <code class="unnumbered">maps</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#example"><i class="fa fa-check"></i>Example</a>
<ul>
<li class="chapter" data-level="13.7.2" data-path="maps.html"><a href="maps.html#package-leaflet"><i class="fa fa-check"></i><b>13.7.2</b> Package <code class="unnumbered">leaflet</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html"><i class="fa fa-check"></i><b>14</b> Graphing Part II</a>
<ul>
<li class="chapter" data-level="14.1" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#multi-plots"><i class="fa fa-check"></i><b>14.1</b> Multi-plots</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#cowplot-package"><i class="fa fa-check"></i><b>14.1.1</b> <code>cowplot</code> package</a></li>
<li class="chapter" data-level="14.1.2" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#multiplot-in-rmisc"><i class="fa fa-check"></i><b>14.1.2</b> <code>multiplot</code> in <code>Rmisc</code></a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#customized-scales"><i class="fa fa-check"></i><b>14.2</b> Customized Scales</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#color-scales"><i class="fa fa-check"></i><b>14.2.1</b> Color Scales</a></li>
<li class="chapter" data-level="14.2.2" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#setting-major-minor-ticks"><i class="fa fa-check"></i><b>14.2.2</b> Setting major &amp; minor ticks</a></li>
<li class="chapter" data-level="14.2.3" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#log-scales"><i class="fa fa-check"></i><b>14.2.3</b> Log Scales</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#themes"><i class="fa fa-check"></i><b>14.3</b> Themes</a></li>
<li class="chapter" data-level="14.4" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#mathematical-notation"><i class="fa fa-check"></i><b>14.4</b> Mathematical Notation</a></li>
<li class="chapter" data-level="14.5" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#interactive-plots-with-plotly"><i class="fa fa-check"></i><b>14.5</b> Interactive plots with <code>plotly</code></a></li>
<li class="chapter" data-level="14.6" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#geographic-maps"><i class="fa fa-check"></i><b>14.6</b> Geographic Maps</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#package-maps-1"><i class="fa fa-check"></i><b>14.6.1</b> Package <code>maps</code></a></li>
<li class="chapter" data-level="14.6.2" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#packages-sf-and-rnaturalearth"><i class="fa fa-check"></i><b>14.6.2</b> Packages <code>sf</code> and <code>rnaturalearth</code></a></li>
<li class="chapter" data-level="14.6.3" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#package-leaflet-1"><i class="fa fa-check"></i><b>14.6.3</b> Package <code>leaflet</code></a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="graphing-part-ii.html"><a href="graphing-part-ii.html#Exercises_Advanced_Graphing"><i class="fa fa-check"></i><b>14.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="r-packages.html"><a href="r-packages.html"><i class="fa fa-check"></i><b>15</b> R Packages</a>
<ul>
<li class="chapter" data-level="15.1" data-path="r-packages.html"><a href="r-packages.html#introduction-2"><i class="fa fa-check"></i><b>15.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="r-packages.html"><a href="r-packages.html#useful-packages-and-books"><i class="fa fa-check"></i><b>15.1.1</b> Useful packages and books</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="r-packages.html"><a href="r-packages.html#package-structure"><i class="fa fa-check"></i><b>15.2</b> Package Structure</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="r-packages.html"><a href="r-packages.html#minimal-files-and-directories"><i class="fa fa-check"></i><b>15.2.1</b> Minimal files and directories</a></li>
<li class="chapter" data-level="15.2.2" data-path="r-packages.html"><a href="r-packages.html#optional-files-and-directories"><i class="fa fa-check"></i><b>15.2.2</b> Optional Files and Directories</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="r-packages.html"><a href="r-packages.html#documenting"><i class="fa fa-check"></i><b>15.3</b> Documenting</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="r-packages.html"><a href="r-packages.html#data-documentation"><i class="fa fa-check"></i><b>15.3.1</b> Data Documentation</a></li>
<li class="chapter" data-level="15.3.2" data-path="r-packages.html"><a href="r-packages.html#documenting-functions"><i class="fa fa-check"></i><b>15.3.2</b> Documenting Functions</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="r-packages.html"><a href="r-packages.html#testing"><i class="fa fa-check"></i><b>15.4</b> Testing</a></li>
<li class="chapter" data-level="15.5" data-path="r-packages.html"><a href="r-packages.html#the-description-file"><i class="fa fa-check"></i><b>15.5</b> The DESCRIPTION file</a></li>
<li class="chapter" data-level="15.6" data-path="r-packages.html"><a href="r-packages.html#sharing-your-package"><i class="fa fa-check"></i><b>15.6</b> Sharing your Package</a></li>
<li class="chapter" data-level="15.7" data-path="r-packages.html"><a href="r-packages.html#an-example-package"><i class="fa fa-check"></i><b>15.7</b> An Example Package</a></li>
<li class="chapter" data-level="15.8" data-path="r-packages.html"><a href="r-packages.html#Exercises_Packages"><i class="fa fa-check"></i><b>15.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="data-scraping.html"><a href="data-scraping.html"><i class="fa fa-check"></i><b>16</b> Data Scraping</a>
<ul>
<li class="chapter" data-level="16.1" data-path="data-scraping.html"><a href="data-scraping.html#web-pages"><i class="fa fa-check"></i><b>16.1</b> Web Pages</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="data-scraping.html"><a href="data-scraping.html#example-wikipedia-table"><i class="fa fa-check"></i><b>16.1.1</b> Example Wikipedia Table</a></li>
<li class="chapter" data-level="16.1.2" data-path="data-scraping.html"><a href="data-scraping.html#lists"><i class="fa fa-check"></i><b>16.1.2</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="data-scraping.html"><a href="data-scraping.html#scraping-.pdf-files"><i class="fa fa-check"></i><b>16.2</b> Scraping .pdf files</a></li>
<li class="chapter" data-level="16.3" data-path="data-scraping.html"><a href="data-scraping.html#Exercises_WebScraping"><i class="fa fa-check"></i><b>16.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="api-data-queries.html"><a href="api-data-queries.html"><i class="fa fa-check"></i><b>17</b> API Data Queries</a>
<ul>
<li class="chapter" data-level="17.1" data-path="api-data-queries.html"><a href="api-data-queries.html#introduction-3"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="api-data-queries.html"><a href="api-data-queries.html#census-bureau-api"><i class="fa fa-check"></i><b>17.2</b> Census Bureau API</a></li>
<li class="chapter" data-level="17.3" data-path="api-data-queries.html"><a href="api-data-queries.html#package-censusapi"><i class="fa fa-check"></i><b>17.3</b> Package <code>censusapi</code></a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="api-data-queries.html"><a href="api-data-queries.html#population-estimates"><i class="fa fa-check"></i><b>17.3.1</b> Population Estimates</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="api-data-queries.html"><a href="api-data-queries.html#package-tidycensus"><i class="fa fa-check"></i><b>17.4</b> Package <code>tidycensus</code></a></li>
<li class="chapter" data-level="17.5" data-path="api-data-queries.html"><a href="api-data-queries.html#Exercises_APIs"><i class="fa fa-check"></i><b>17.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="databases.html"><a href="databases.html"><i class="fa fa-check"></i><b>18</b> Databases</a>
<ul>
<li class="chapter" data-level="18.1" data-path="databases.html"><a href="databases.html#introduction-4"><i class="fa fa-check"></i><b>18.1</b> Introduction</a></li>
<li class="chapter" data-level="18.2" data-path="databases.html"><a href="databases.html#establishing-a-connection"><i class="fa fa-check"></i><b>18.2</b> Establishing a Connection</a></li>
<li class="chapter" data-level="18.3" data-path="databases.html"><a href="databases.html#basic-sql-commands"><i class="fa fa-check"></i><b>18.3</b> Basic SQL Commands</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="databases.html"><a href="databases.html#select-rows"><i class="fa fa-check"></i><b>18.3.1</b> SELECT rows</a></li>
<li class="chapter" data-level="18.3.2" data-path="databases.html"><a href="databases.html#insert-a-new-row"><i class="fa fa-check"></i><b>18.3.2</b> INSERT a new Row</a></li>
<li class="chapter" data-level="18.3.3" data-path="databases.html"><a href="databases.html#update-a-row"><i class="fa fa-check"></i><b>18.3.3</b> UPDATE a row</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="databases.html"><a href="databases.html#passing-r-variables-into-sql-chunks"><i class="fa fa-check"></i><b>18.4</b> Passing R variables into SQL chunks</a></li>
<li class="chapter" data-level="18.5" data-path="databases.html"><a href="databases.html#reading-tables-using-dbplyr"><i class="fa fa-check"></i><b>18.5</b> Reading tables using <code>dbplyr</code></a></li>
<li class="chapter" data-level="18.6" data-path="databases.html"><a href="databases.html#Exercises_DataBases"><i class="fa fa-check"></i><b>18.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="speeding-up-r.html"><a href="speeding-up-r.html"><i class="fa fa-check"></i><b>19</b> Speeding up R</a>
<ul>
<li class="chapter" data-level="19.1" data-path="speeding-up-r.html"><a href="speeding-up-r.html#faster-for-loops"><i class="fa fa-check"></i><b>19.1</b> Faster for loops?</a></li>
<li class="chapter" data-level="19.2" data-path="speeding-up-r.html"><a href="speeding-up-r.html#vectorizing-loops"><i class="fa fa-check"></i><b>19.2</b> Vectorizing loops</a></li>
<li class="chapter" data-level="19.3" data-path="speeding-up-r.html"><a href="speeding-up-r.html#parallel-processing"><i class="fa fa-check"></i><b>19.3</b> Parallel Processing</a></li>
<li class="chapter" data-level="19.4" data-path="speeding-up-r.html"><a href="speeding-up-r.html#parallel-aware-functions"><i class="fa fa-check"></i><b>19.4</b> Parallel Aware Functions</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="speeding-up-r.html"><a href="speeding-up-r.html#bootboot"><i class="fa fa-check"></i><b>19.4.1</b> <code>boot::boot</code></a></li>
<li class="chapter" data-level="19.4.2" data-path="speeding-up-r.html"><a href="speeding-up-r.html#carettrain"><i class="fa fa-check"></i><b>19.4.2</b> <code>caret::train</code></a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="speeding-up-r.html"><a href="speeding-up-r.html#parallelizing-for-loops"><i class="fa fa-check"></i><b>19.5</b> Parallelizing <code>for</code> loops</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cheatsheet.html"><a href="cheatsheet.html"><i class="fa fa-check"></i>CheatSheet</a>
<ul>
<li class="chapter" data-level="" data-path="cheatsheet.html"><a href="cheatsheet.html#importing-data-and-loading-packages"><i class="fa fa-check"></i>Importing Data and Loading Packages</a></li>
<li class="chapter" data-level="" data-path="cheatsheet.html"><a href="cheatsheet.html#useful-vectorized-functions"><i class="fa fa-check"></i>Useful vectorized functions</a></li>
<li class="chapter" data-level="" data-path="cheatsheet.html"><a href="cheatsheet.html#data-frame-tibble-manipulation"><i class="fa fa-check"></i>Data frame (tibble) manipulation</a></li>
<li class="chapter" data-level="" data-path="cheatsheet.html"><a href="cheatsheet.html#data-frame-tibble-reshaping"><i class="fa fa-check"></i>Data frame (tibble) reshaping</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STA 444/5 - Introductory Data Science using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-reshaping" class="section level1" number="13">
<h1><span class="header-section-number">Chapter 13</span> Data Reshaping</h1>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="data-reshaping.html#cb735-1" aria-hidden="true"></a><span class="co"># library(tidyr)   # for the gather/spread commands</span></span>
<span id="cb735-2"><a href="data-reshaping.html#cb735-2" aria-hidden="true"></a><span class="co"># library(dplyr)   # for the join stuff</span></span>
<span id="cb735-3"><a href="data-reshaping.html#cb735-3" aria-hidden="true"></a><span class="kw">library</span>(tidyverse) <span class="co"># dplyr, tidyr, ggplot2, etc.</span></span></code></pre></div>
<p>I have a YouTube <a href="https://youtu.be/sVTfG2TH_gU">Video Lecture</a> for this chapter.</p>
<p>Most of the time, our data is in the form of a data frame and we are interested in exploring the relationships. However most procedures in R expect the data to show up in a ‘long’ format where each row is an observation and each column is a covariate. In practice, the data is often not stored like that and the data comes to us with repeated observations included on a single row. This is often done as a memory saving technique or because there is some structure in the data that makes the ‘wide’ format attractive. As a result, we need a way to convert data from ‘wide’ to ‘long’ and vice-versa.</p>
<p>Next we need a way to squish two data frames together. It is often advantageous to store data that would be be repeated separately in a different table so that a particular piece of information lives in only one location. This makes the data easier to modify, and more likely to maintain consistence. However, this practice requires that, when necessary, we can add information to a table, that might involve a lot of duplicated rows.</p>
<div id="cbind-rbind" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> <code>cbind</code> &amp; <code>rbind</code></h2>
<p>Base R has two functions for squishing two data frames together, but they assume that the data frames are aligned correctly. The <code>c</code> and <code>r</code> parts of <code>cbind</code> and <code>rbind</code> correspond to if we are pushing columns together or rows together.</p>
<div class="sourceCode" id="cb736"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb736-1"><a href="data-reshaping.html#cb736-1" aria-hidden="true"></a><span class="co"># Define a tibble using a row-wise layout.</span></span>
<span id="cb736-2"><a href="data-reshaping.html#cb736-2" aria-hidden="true"></a>df1 &lt;-<span class="st"> </span><span class="kw">tribble</span>(            </span>
<span id="cb736-3"><a href="data-reshaping.html#cb736-3" aria-hidden="true"></a>  <span class="op">~</span>ID,  <span class="op">~</span>First,</span>
<span id="cb736-4"><a href="data-reshaping.html#cb736-4" aria-hidden="true"></a>  <span class="dv">1</span>,   <span class="st">&#39;Alice&#39;</span>,</span>
<span id="cb736-5"><a href="data-reshaping.html#cb736-5" aria-hidden="true"></a>  <span class="dv">2</span>,   <span class="st">&#39;Bob&#39;</span>,</span>
<span id="cb736-6"><a href="data-reshaping.html#cb736-6" aria-hidden="true"></a>  <span class="dv">3</span>,   <span class="st">&#39;Charlie&#39;</span>)</span>
<span id="cb736-7"><a href="data-reshaping.html#cb736-7" aria-hidden="true"></a></span>
<span id="cb736-8"><a href="data-reshaping.html#cb736-8" aria-hidden="true"></a><span class="co"># Define a tibble by columns</span></span>
<span id="cb736-9"><a href="data-reshaping.html#cb736-9" aria-hidden="true"></a>df2 &lt;-<span class="st"> </span><span class="kw">tibble</span>( <span class="dt">Last =</span> <span class="kw">c</span>(<span class="st">&#39;Anderson&#39;</span>, <span class="st">&#39;Barker&#39;</span>, <span class="st">&#39;Cooper&#39;</span>) )</span>
<span id="cb736-10"><a href="data-reshaping.html#cb736-10" aria-hidden="true"></a></span>
<span id="cb736-11"><a href="data-reshaping.html#cb736-11" aria-hidden="true"></a><span class="co"># Squish the two tibbles together by columns - results in a data.frame</span></span>
<span id="cb736-12"><a href="data-reshaping.html#cb736-12" aria-hidden="true"></a>People &lt;-<span class="st"> </span><span class="kw">cbind</span>( df1, df2 )</span>
<span id="cb736-13"><a href="data-reshaping.html#cb736-13" aria-hidden="true"></a>People</span></code></pre></div>
<pre><code>##   ID   First     Last
## 1  1   Alice Anderson
## 2  2     Bob   Barker
## 3  3 Charlie   Cooper</code></pre>
<p>Squishing together by rows is easy as well.</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb738-1"><a href="data-reshaping.html#cb738-1" aria-hidden="true"></a>df3 &lt;-<span class="st"> </span><span class="kw">tibble</span>( <span class="dt">ID=</span><span class="dv">4</span>, <span class="dt">First=</span><span class="st">&#39;Daniel&#39;</span>, <span class="dt">Last=</span><span class="st">&#39;Davidson&#39;</span> )</span>
<span id="cb738-2"><a href="data-reshaping.html#cb738-2" aria-hidden="true"></a></span>
<span id="cb738-3"><a href="data-reshaping.html#cb738-3" aria-hidden="true"></a>People &lt;-<span class="st"> </span><span class="kw">rbind</span>( People, df3 )</span>
<span id="cb738-4"><a href="data-reshaping.html#cb738-4" aria-hidden="true"></a>People</span></code></pre></div>
<pre><code>##   ID   First     Last
## 1  1   Alice Anderson
## 2  2     Bob   Barker
## 3  3 Charlie   Cooper
## 4  4  Daniel Davidson</code></pre>
<p>If both inputs have row or column names, then they don’t need to be appropriate arranged as <code>rbind</code> and <code>cbind</code> can figure out how to order them.</p>
<p>There are equivalent functions in the <code>dplyr</code> package that do the same job, but will work more consistently. For example, if we try to bind a row of data that has more columns, <code>bind_rows()</code> will introduce a column of <code>NA</code> values to the smaller data set. Furthermore, if the column orders are mixed up</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb740-1"><a href="data-reshaping.html#cb740-1" aria-hidden="true"></a>df4 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">First=</span><span class="st">&#39;Elise&#39;</span>, <span class="dt">ID=</span><span class="dv">5</span>, <span class="dt">Last=</span><span class="st">&#39;Erikson&#39;</span>) <span class="co"># Notice changed columns order! </span></span>
<span id="cb740-2"><a href="data-reshaping.html#cb740-2" aria-hidden="true"></a><span class="kw">rbind</span>(People, df4)  <span class="co"># but rbind() can still figure it out!</span></span></code></pre></div>
<pre><code>##   ID   First     Last
## 1  1   Alice Anderson
## 2  2     Bob   Barker
## 3  3 Charlie   Cooper
## 4  4  Daniel Davidson
## 5  5   Elise  Erikson</code></pre>
<div class="sourceCode" id="cb742"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb742-1"><a href="data-reshaping.html#cb742-1" aria-hidden="true"></a>df5 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">First=</span><span class="st">&#39;Frank&#39;</span>, <span class="dt">ID=</span><span class="dv">6</span>, <span class="dt">Last=</span><span class="st">&#39;Fredrick&#39;</span>, <span class="dt">dob=</span>lubridate<span class="op">::</span><span class="kw">ymd</span>(<span class="st">&#39;1980-7-21&#39;</span>))</span>
<span id="cb742-2"><a href="data-reshaping.html#cb742-2" aria-hidden="true"></a><span class="kw">rbind</span>(People, df5)   <span class="co"># throws an error</span></span></code></pre></div>
<pre><code>## Error in rbind(deparse.level, ...): numbers of columns of arguments do not match</code></pre>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb744-1"><a href="data-reshaping.html#cb744-1" aria-hidden="true"></a><span class="kw">bind_rows</span>( People, df4, df5) <span class="co"># Inserts NA values as appropriate.</span></span></code></pre></div>
<pre><code>##   ID   First     Last        dob
## 1  1   Alice Anderson       &lt;NA&gt;
## 2  2     Bob   Barker       &lt;NA&gt;
## 3  3 Charlie   Cooper       &lt;NA&gt;
## 4  4  Daniel Davidson       &lt;NA&gt;
## 5  5   Elise  Erikson       &lt;NA&gt;
## 6  6   Frank Fredrick 1980-07-21</code></pre>
<p>In general, I find that <code>rbind()</code> and <code>bind_rows()</code> work really well and I use them quite often. However, <code>cbind()</code> and <code>bind_cols()</code> are less useful because I have to make sure that either I have rownames set up for each data set, or I have to be very careful with the ordering. Instead, it is safer to write code that relies on <code>joins</code>, which will be discussed later in this chapter.</p>
</div>
<div id="table-pivots" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> Table Pivots</h2>
<p>There is a common issue with obtaining data with many columns that you wish were organized as rows. For example, I might have data in a grade book that has several homework scores and I’d like to produce a nice graph that has assignment number on the x-axis and score on the y-axis. Unfortunately this is incredibly hard to do when the data is arranged in the following way:</p>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="data-reshaping.html#cb746-1" aria-hidden="true"></a>grade.book &lt;-<span class="st"> </span><span class="kw">rbind</span>(</span>
<span id="cb746-2"><a href="data-reshaping.html#cb746-2" aria-hidden="true"></a>  <span class="kw">data.frame</span>(<span class="dt">name=</span><span class="st">&#39;Alison.Anderson&#39;</span>,  <span class="dt">HW.1=</span><span class="dv">8</span>, <span class="dt">HW.2=</span><span class="dv">5</span>, <span class="dt">HW.3=</span><span class="dv">8</span>, <span class="dt">HW.4=</span><span class="dv">4</span>),</span>
<span id="cb746-3"><a href="data-reshaping.html#cb746-3" aria-hidden="true"></a>  <span class="kw">data.frame</span>(<span class="dt">name=</span><span class="st">&#39;Brandon.Babbage&#39;</span>, <span class="dt">HW.1=</span><span class="dv">5</span>, <span class="dt">HW.2=</span><span class="dv">3</span>, <span class="dt">HW.3=</span><span class="dv">6</span>, <span class="dt">HW.4=</span><span class="dv">9</span>),</span>
<span id="cb746-4"><a href="data-reshaping.html#cb746-4" aria-hidden="true"></a>  <span class="kw">data.frame</span>(<span class="dt">name=</span><span class="st">&#39;Charles.Collins&#39;</span>, <span class="dt">HW.1=</span><span class="dv">9</span>, <span class="dt">HW.2=</span><span class="dv">7</span>, <span class="dt">HW.3=</span><span class="dv">9</span>, <span class="dt">HW.4=</span><span class="dv">10</span>))</span>
<span id="cb746-5"><a href="data-reshaping.html#cb746-5" aria-hidden="true"></a>grade.book</span></code></pre></div>
<pre><code>##              name HW.1 HW.2 HW.3 HW.4
## 1 Alison.Anderson    8    5    8    4
## 2 Brandon.Babbage    5    3    6    9
## 3 Charles.Collins    9    7    9   10</code></pre>
<p>What we want to do is turn this data frame from a <em>wide</em> data frame into a <em>long</em> data frame. In MS Excel this is called pivoting. Essentially I’d like to create a data frame with three columns: <code>name</code>, <code>assignment</code>, and <code>score</code>. That is to say that each homework datum really has three pieces of information: who it came from, which homework it was, and what the score was. It doesn’t conceptually matter if I store it as 3 rows of 4 columns or 12 rows so long as there is a way to identify how a student scored on a particular homework. So we want to reshape the HW1 to HW4 columns into two columns (assignment and score).</p>
<p>This package was built by the same people that created dplyr and ggplot2 and there is a nice introduction at: [<a href="http://blog.rstudio.org/2014/07/22/introducing-tidyr/" class="uri">http://blog.rstudio.org/2014/07/22/introducing-tidyr/</a>]</p>
<p>There have been several iterations of functions to convert data from a wide to long and back again. When Hadley first began thinking through these issues in the <code>reshape</code> package, he called these two functions <code>melt</code> and <code>cast</code>. The second iteration in these functions in the <code>tidyr</code> package were called <code>gather</code> and <code>spread</code>. I believe we are finally in the last which are simply named <code>pivot_wider()</code> and <code>pivot_longer()</code>.</p>
<p>There are two main verbs to remember:</p>
<table>
<colgroup>
<col width="15%" />
<col width="84%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>pivot_longer()</code></td>
<td align="left">Gather multiple columns that are related into two columns that contain the original column name and the value. For example for columns <code>HW1</code>, <code>HW2</code>, <code>HW3</code> we would gather them into two columns: <code>Homework</code> and <code>Score</code>. In this case, we refer to <code>Homework</code> as the <em>names</em> column and <code>Score</code> as the <em>values</em> column.</td>
</tr>
<tr class="even">
<td align="center"><code>pivot_wider()</code></td>
<td align="left">This is the opposite function. This takes a <em>names</em> and <em>values</em> pair of columns and forms a new column for each level of the <em>names</em> column(s).</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="data-reshaping.html#cb748-1" aria-hidden="true"></a><span class="co"># first we gather the score columns into columns we&#39;ll name Homework and Score</span></span>
<span id="cb748-2"><a href="data-reshaping.html#cb748-2" aria-hidden="true"></a>tidy.scores &lt;-<span class="st"> </span>grade.book <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb748-3"><a href="data-reshaping.html#cb748-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">pivot_longer</span>( </span>
<span id="cb748-4"><a href="data-reshaping.html#cb748-4" aria-hidden="true"></a>    HW<span class="fl">.1</span><span class="op">:</span>HW<span class="fl">.4</span>,                <span class="co"># which columns to apply this to</span></span>
<span id="cb748-5"><a href="data-reshaping.html#cb748-5" aria-hidden="true"></a>    <span class="dt">names_to  =</span> <span class="st">&#39;Homework&#39;</span>,   <span class="co"># What should I call the column of old column names</span></span>
<span id="cb748-6"><a href="data-reshaping.html#cb748-6" aria-hidden="true"></a>    <span class="dt">values_to =</span> <span class="st">&#39;Score&#39;</span>)      <span class="co"># What should I call the values column</span></span>
<span id="cb748-7"><a href="data-reshaping.html#cb748-7" aria-hidden="true"></a>tidy.scores</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    name            Homework Score
##    &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt;
##  1 Alison.Anderson HW.1         8
##  2 Alison.Anderson HW.2         5
##  3 Alison.Anderson HW.3         8
##  4 Alison.Anderson HW.4         4
##  5 Brandon.Babbage HW.1         5
##  6 Brandon.Babbage HW.2         3
##  7 Brandon.Babbage HW.3         6
##  8 Brandon.Babbage HW.4         9
##  9 Charles.Collins HW.1         9
## 10 Charles.Collins HW.2         7
## 11 Charles.Collins HW.3         9
## 12 Charles.Collins HW.4        10</code></pre>
<p>To spread the <em>names</em> <em>values</em> pairs out into a wide data frame, we use the <code>pivot_wider()</code> command.</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb750-1"><a href="data-reshaping.html#cb750-1" aria-hidden="true"></a><span class="co"># Turn the Homework/Score pair of columns into one column per factor level of Homework</span></span>
<span id="cb750-2"><a href="data-reshaping.html#cb750-2" aria-hidden="true"></a>tidy.scores <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pivot_wider</span>( <span class="dt">names_from=</span>Homework, <span class="dt">values_from=</span>Score )</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   name             HW.1  HW.2  HW.3  HW.4
##   &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Alison.Anderson     8     5     8     4
## 2 Brandon.Babbage     5     3     6     9
## 3 Charles.Collins     9     7     9    10</code></pre>
<p>Often times, the long format of the data is most helpful for graphing or doing data analysis. Because of this, we often refer to this as the <em>tidy</em> form of the data. Hadley has a nice article about messy data vs tidy data and his <a href="https://vita.had.co.nz/papers/tidy-data.pdf">article</a> is well worth your time to read, although <code>dplyr</code> and <code>tidyr</code> have matured since he wrote this article. The main point can be summarized by:</p>
<ol style="list-style-type: decimal">
<li>Each row in the data frame represents a single object.</li>
<li>Each column represents an attribute that can be measured on every object.</li>
<li>Every object type implicitly forms a table.</li>
</ol>
<p>In our grade book example, we could consider each <em>student</em> as on object and store the data with 1 row per student and columns for each attribute (homework score). Alternatively, the long form is a <code>Scores</code> data set stores the data with a single row representing a single score. If I have multiple sections of the course and some homeworks are not assigned to one course but are assigned to another, then the long form <code>Scores</code> would be the appropriate storage.</p>
<p>Most of our graphing and data analysis procedures will expect the data to be in a long format, but for both data input and digital storage compression, we might have data given to us in a wide format.</p>
</div>
<div id="spreading-a-single-column-with-separate" class="section level2" number="13.3">
<h2><span class="header-section-number">13.3</span> Spreading a Single Column with <code>separate</code></h2>
<p>It is common for data columns to contain multiple attributes. For example, a name column might contain both first and last names or a file name might contain multiple bits of information broken up by underscores. In the string manipulation chapter, we saw how to use <code>stringr::str_split()</code> to split strings. Now we’ll apply this using the <code>tidyr::separate()</code> function.</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="data-reshaping.html#cb752-1" aria-hidden="true"></a>grade.book <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(name, <span class="dt">sep=</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>, <span class="kw">c</span>(<span class="st">&#39;F.Name&#39;</span>,<span class="st">&#39;L.Name&#39;</span>), <span class="dt">remove =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>##              name  F.Name   L.Name HW.1 HW.2 HW.3 HW.4
## 1 Alison.Anderson  Alison Anderson    8    5    8    4
## 2 Brandon.Babbage Brandon  Babbage    5    3    6    9
## 3 Charles.Collins Charles  Collins    9    7    9   10</code></pre>
</div>
<div id="storing-data-in-multiple-tables" class="section level2" number="13.4">
<h2><span class="header-section-number">13.4</span> Storing Data in Multiple Tables</h2>
<p>In many data sets it is common to store data across multiple tables, usually with the goal of minimizing memory used as well as providing minimal duplication of information so any change that must be made is only made in a single place. Recall the guiding idea that each <em>type</em> of object stored should result in its own table.</p>
<p>To see the rational why we might do this, consider building a data set of blood donations by a variety of donors across several years. For each blood donation, we will perform some assay and measure certain qualities about the blood and the patients health at the donation. But should we contain the donor’s address, phone number, and email address in the same data table that holds the information about the blood donated.</p>
<p>I would like to include additional information about the donor where that information doesn’t change overtime. For example we might want to have information about the donor’s birthdate, sex, blood type. However, I don’t want that information in <em>every single donation line</em>. Otherwise if I mistype a birthday and have to correct it, I would have to correct it <em>everywhere</em>. For information about the donor, should live in a <code>donors</code> table, while information about a particular donation should live in the <code>donations</code> table.</p>
<p>Furthermore, there are many Jeffs and Dereks in the world and to maintain a unique identifier (without using Social Security numbers) I will just create a <code>Donor_ID</code> code that will uniquely identify a person. Similarly I will create a <code>Blood_ID</code> that will uniquely identify a blood donation.</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="data-reshaping.html#cb754-1" aria-hidden="true"></a>Donors</span></code></pre></div>
<pre><code>## # A tibble: 3 x 7
##   Donor_ID Name   Blood_Type Birthday   Street       City      State
##   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;
## 1 D1       Derek  O+         1976-09-17 7392 Willard Flagstaff AZ   
## 2 D2       Jeff   A-         1974-06-23 873 Vine     Bozeman   MT   
## 3 D3       Aubrey O+         1976-09-17 7392 Willard Flagstaff AZ</code></pre>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb756-1"><a href="data-reshaping.html#cb756-1" aria-hidden="true"></a>Blood_Donations </span></code></pre></div>
<pre><code>## # A tibble: 5 x 6
##   Blood_ID Donor_ID Date       Hemoglobin Systolic Diastolic
##   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 B_1      D1       2017-04-14       17.4      120        79
## 2 B_2      D1       2017-06-20       16.5      121        80
## 3 B_3      D2       2017-08-14       16.9      145       101
## 4 B_4      D1       2017-08-26       17.6      120        79
## 5 B_5      D3       2017-08-26       16.1      137        90</code></pre>
<p>If we have a new donor walk in and give blood, then we’ll have to create a new entry in the <code>donors</code> table as well as a new entry in the <code>donations</code> table. If an experienced donor gives again, we just have to create a new entry in the donations table.</p>
<p>Given this data structure, we can now easily create new donations as well as store donor information. In the event that we need to change something about a donor, there is only <em>one</em> place to make that change.</p>
<p>However, having data spread across multiple tables is challenging because I often want that information squished back together. For example, if during routine testing we discover that a blood sample is HIV positive. Then we <em>need</em> to be able to join the blood donations table to the donors table in some sensible manner.</p>
</div>
<div id="table-joins" class="section level2" number="13.5">
<h2><span class="header-section-number">13.5</span> Table Joins</h2>
<p>There are four different types of joins: outer, left, right, and inner joins. Consider the following example tables. Here we consider that there is some <em>key</em> column that is common to both tables.</p>
<table>
<colgroup>
<col width="39%" />
<col width="60%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Join Type</th>
<th align="left">Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>inner_join(A,B)</code></td>
<td align="left">Include rows if the key value is in <em>both</em> tables.</td>
</tr>
<tr class="even">
<td align="center"><code>left_join(A,B)</code></td>
<td align="left">Include all rows of <code>A</code>, and if the match in <code>B</code> doesn’t exist, just insert a <code>NA</code>.</td>
</tr>
<tr class="odd">
<td align="center"><code>right_join(A,B)</code></td>
<td align="left">Include all rows of <code>B</code>, and if the match in <code>A</code> doesn’t exist, just insert a <code>NA</code>.</td>
</tr>
<tr class="even">
<td align="center"><code>full_join(A,B)</code></td>
<td align="left">Include all rows of <code>A</code> and <code>B</code> and if the necessary match doesn’t exist, insert <code>NA</code> values.</td>
</tr>
</tbody>
</table>
<p>For a practical example</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb758-1"><a href="data-reshaping.html#cb758-1" aria-hidden="true"></a>A &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb758-2"><a href="data-reshaping.html#cb758-2" aria-hidden="true"></a>  <span class="op">~</span>ID, <span class="op">~</span>x,</span>
<span id="cb758-3"><a href="data-reshaping.html#cb758-3" aria-hidden="true"></a>  <span class="st">&#39;a&#39;</span>, <span class="dv">34</span>,    <span class="co"># Notice that A doesn&#39;t have ID = d</span></span>
<span id="cb758-4"><a href="data-reshaping.html#cb758-4" aria-hidden="true"></a>  <span class="st">&#39;b&#39;</span>, <span class="dv">36</span>,</span>
<span id="cb758-5"><a href="data-reshaping.html#cb758-5" aria-hidden="true"></a>  <span class="st">&#39;c&#39;</span>, <span class="dv">38</span>)</span>
<span id="cb758-6"><a href="data-reshaping.html#cb758-6" aria-hidden="true"></a>B &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb758-7"><a href="data-reshaping.html#cb758-7" aria-hidden="true"></a>  <span class="op">~</span>ID, <span class="op">~</span>y,</span>
<span id="cb758-8"><a href="data-reshaping.html#cb758-8" aria-hidden="true"></a>  <span class="st">&#39;b&#39;</span>, <span class="dv">56</span>,   <span class="co"># Notice that B doesn&#39;t have ID = a</span></span>
<span id="cb758-9"><a href="data-reshaping.html#cb758-9" aria-hidden="true"></a>  <span class="st">&#39;c&#39;</span>, <span class="dv">57</span>,</span>
<span id="cb758-10"><a href="data-reshaping.html#cb758-10" aria-hidden="true"></a>  <span class="st">&#39;d&#39;</span>, <span class="dv">59</span>)</span></code></pre></div>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="data-reshaping.html#cb759-1" aria-hidden="true"></a><span class="co"># only include rows with IDs that are in both tables</span></span>
<span id="cb759-2"><a href="data-reshaping.html#cb759-2" aria-hidden="true"></a><span class="kw">inner_join</span>(A,B)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   ID        x     y
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 b        36    56
## 2 c        38    57</code></pre>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="data-reshaping.html#cb761-1" aria-hidden="true"></a><span class="co"># All the rows in table A, insert NA if the B info is missing</span></span>
<span id="cb761-2"><a href="data-reshaping.html#cb761-2" aria-hidden="true"></a><span class="kw">left_join</span>(A,B)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   ID        x     y
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 a        34    NA
## 2 b        36    56
## 3 c        38    57</code></pre>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="data-reshaping.html#cb763-1" aria-hidden="true"></a><span class="co"># All the rows in table B, insert NA if the A info is missing</span></span>
<span id="cb763-2"><a href="data-reshaping.html#cb763-2" aria-hidden="true"></a><span class="kw">right_join</span>(A,B)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   ID        x     y
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 b        36    56
## 2 c        38    57
## 3 d        NA    59</code></pre>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="data-reshaping.html#cb765-1" aria-hidden="true"></a><span class="co"># All the rows possible, insert NA if the matching info is missing</span></span>
<span id="cb765-2"><a href="data-reshaping.html#cb765-2" aria-hidden="true"></a><span class="kw">full_join</span>(A,B)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   ID        x     y
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 a        34    NA
## 2 b        36    56
## 3 c        38    57
## 4 d        NA    59</code></pre>
<p>Consider the case where we have a data frame of observations of fish and a separate data frame that contains information about lake (perhaps surface area, max depth, pH, etc). I want to store them as two separate tables so that when I have to record a lake level observation, I only input it <em>one</em> place. This decreases the chance that I make a copy/paste error.</p>
<p>To illustrate the different types of table joins, we’ll consider two different tables.</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="data-reshaping.html#cb767-1" aria-hidden="true"></a><span class="co"># tibbles are just data.frames that print a bit nicer and don&#39;t automatically</span></span>
<span id="cb767-2"><a href="data-reshaping.html#cb767-2" aria-hidden="true"></a><span class="co"># convert character columns into factors.  They behave a bit more consistently</span></span>
<span id="cb767-3"><a href="data-reshaping.html#cb767-3" aria-hidden="true"></a><span class="co"># in a wide variety of situations compared to data.frames.</span></span>
<span id="cb767-4"><a href="data-reshaping.html#cb767-4" aria-hidden="true"></a>Fish.Data &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb767-5"><a href="data-reshaping.html#cb767-5" aria-hidden="true"></a>  <span class="dt">Lake_ID =</span> <span class="kw">c</span>(<span class="st">&#39;A&#39;</span>,<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;C&#39;</span>), </span>
<span id="cb767-6"><a href="data-reshaping.html#cb767-6" aria-hidden="true"></a>  <span class="dt">Fish.Weight=</span><span class="kw">rnorm</span>(<span class="dv">6</span>, <span class="dt">mean=</span><span class="dv">260</span>, <span class="dt">sd=</span><span class="dv">25</span>) ) <span class="co"># make up some data</span></span>
<span id="cb767-7"><a href="data-reshaping.html#cb767-7" aria-hidden="true"></a>Lake.Data &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb767-8"><a href="data-reshaping.html#cb767-8" aria-hidden="true"></a>  <span class="dt">Lake_ID =</span> <span class="kw">c</span>(    <span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>),   </span>
<span id="cb767-9"><a href="data-reshaping.html#cb767-9" aria-hidden="true"></a>  <span class="dt">Lake_Name =</span> <span class="kw">c</span>(<span class="st">&#39;Lake Elaine&#39;</span>, <span class="st">&#39;Mormon Lake&#39;</span>, <span class="st">&#39;Lake Mary&#39;</span>),   </span>
<span id="cb767-10"><a href="data-reshaping.html#cb767-10" aria-hidden="true"></a>  <span class="dt">pH=</span><span class="kw">c</span>(<span class="fl">6.5</span>, <span class="fl">6.3</span>, <span class="fl">6.1</span>),</span>
<span id="cb767-11"><a href="data-reshaping.html#cb767-11" aria-hidden="true"></a>  <span class="dt">area =</span> <span class="kw">c</span>(<span class="dv">40</span>, <span class="dv">210</span>, <span class="dv">240</span>),</span>
<span id="cb767-12"><a href="data-reshaping.html#cb767-12" aria-hidden="true"></a>  <span class="dt">avg_depth =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">38</span>))</span></code></pre></div>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb768-1"><a href="data-reshaping.html#cb768-1" aria-hidden="true"></a>Fish.Data</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   Lake_ID Fish.Weight
##   &lt;chr&gt;         &lt;dbl&gt;
## 1 A              259.
## 2 A              286.
## 3 B              288.
## 4 B              229.
## 5 C              234.
## 6 C              277.</code></pre>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb770-1"><a href="data-reshaping.html#cb770-1" aria-hidden="true"></a>Lake.Data</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   Lake_ID Lake_Name      pH  area avg_depth
##   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 B       Lake Elaine   6.5    40         8
## 2 C       Mormon Lake   6.3   210        10
## 3 D       Lake Mary     6.1   240        38</code></pre>
<p>Notice that each of these tables has a column labeled <code>Lake_ID</code>. When we join these two tables, the row that describes lake <code>A</code> should be duplicated for each row in the <code>Fish.Data</code> that corresponds with fish caught from lake <code>A</code>.</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb772-1"><a href="data-reshaping.html#cb772-1" aria-hidden="true"></a><span class="kw">full_join</span>(Fish.Data, Lake.Data)</span></code></pre></div>
<pre><code>## Joining, by = &quot;Lake_ID&quot;</code></pre>
<pre><code>## # A tibble: 7 x 6
##   Lake_ID Fish.Weight Lake_Name      pH  area avg_depth
##   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 A              259. &lt;NA&gt;         NA      NA        NA
## 2 A              286. &lt;NA&gt;         NA      NA        NA
## 3 B              288. Lake Elaine   6.5    40         8
## 4 B              229. Lake Elaine   6.5    40         8
## 5 C              234. Mormon Lake   6.3   210        10
## 6 C              277. Mormon Lake   6.3   210        10
## 7 D               NA  Lake Mary     6.1   240        38</code></pre>
<p>Notice that because we didn’t have any fish caught in lake <code>D</code> and we don’t have any Lake information about lake <code>A</code>, when we join these two tables, we end up introducing missing observations into the resulting data frame.</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="data-reshaping.html#cb775-1" aria-hidden="true"></a><span class="kw">left_join</span>(Fish.Data, Lake.Data)</span></code></pre></div>
<pre><code>## Joining, by = &quot;Lake_ID&quot;</code></pre>
<pre><code>## # A tibble: 6 x 6
##   Lake_ID Fish.Weight Lake_Name      pH  area avg_depth
##   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 A              259. &lt;NA&gt;         NA      NA        NA
## 2 A              286. &lt;NA&gt;         NA      NA        NA
## 3 B              288. Lake Elaine   6.5    40         8
## 4 B              229. Lake Elaine   6.5    40         8
## 5 C              234. Mormon Lake   6.3   210        10
## 6 C              277. Mormon Lake   6.3   210        10</code></pre>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="data-reshaping.html#cb778-1" aria-hidden="true"></a><span class="kw">inner_join</span>(Fish.Data, Lake.Data)</span></code></pre></div>
<pre><code>## Joining, by = &quot;Lake_ID&quot;</code></pre>
<pre><code>## # A tibble: 4 x 6
##   Lake_ID Fish.Weight Lake_Name      pH  area avg_depth
##   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 B              288. Lake Elaine   6.5    40         8
## 2 B              229. Lake Elaine   6.5    40         8
## 3 C              234. Mormon Lake   6.3   210        10
## 4 C              277. Mormon Lake   6.3   210        10</code></pre>
<p>The above examples assumed that the column used to join the two tables was named the same in both tables. This is good practice to try to do, but sometimes you have to work with data where that isn’t the case. In that situation you can use the <code>by=c("ColName.A"="ColName.B")</code> syntax where <code>ColName.A</code> represents the name of the column in the first data frame and <code>ColName.B</code> is the equivalent column in the second data frame.</p>
<p>Filtering joins are a useful trick when programming to help discover which rows would be included. In particular, I often want to know which rows would be dropped or don’t have a corresponding match.</p>
<table>
<thead>
<tr class="header">
<th align="center">Join Type</th>
<th align="left">Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>semi_join(A,B)</code></td>
<td align="left">All the rows in <code>A</code> that have a match in <code>B</code>.</td>
</tr>
<tr class="even">
<td align="center"><code>anti_join(A,B)</code></td>
<td align="left">All the rows in <code>A</code> that <strong>dont</strong> have a match in <code>B</code>.</td>
</tr>
</tbody>
</table>
</div>
<div id="row-wise-calculations" class="section level2" number="13.6">
<h2><span class="header-section-number">13.6</span> Row-wise Calculations</h2>
<p>Finally, the combination of <code>pivot_longer</code> and <code>pivot_wider</code> allows me to do some very complex calculations across many columns of a data set. For example, I might gather up a set of columns, calculate some summary statistics, and then join the result back to original data set.</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="data-reshaping.html#cb781-1" aria-hidden="true"></a>grade.book <span class="op">%&gt;%</span></span>
<span id="cb781-2"><a href="data-reshaping.html#cb781-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span></span>
<span id="cb781-3"><a href="data-reshaping.html#cb781-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">pivot_longer</span>(HW<span class="fl">.1</span><span class="op">:</span>HW<span class="fl">.4</span>, <span class="dt">names_to=</span><span class="st">&#39;Homework&#39;</span>, <span class="dt">values_to=</span><span class="st">&#39;Score&#39;</span> ) <span class="op">%&gt;%</span></span>
<span id="cb781-4"><a href="data-reshaping.html#cb781-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>( <span class="dt">HW.avg =</span> <span class="kw">mean</span>(Score) ) <span class="op">%&gt;%</span></span>
<span id="cb781-5"><a href="data-reshaping.html#cb781-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">left_join</span>( grade.book, . )</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## Joining, by = &quot;name&quot;</code></pre>
<pre><code>##              name HW.1 HW.2 HW.3 HW.4 HW.avg
## 1 Alison.Anderson    8    5    8    4   6.25
## 2 Brandon.Babbage    5    3    6    9   5.75
## 3 Charles.Collins    9    7    9   10   8.75</code></pre>
<p>Instead, we’d like to have some mechanism for doing rowwise calculations. This is actually not as easy as you might expect because data frames are stored in memory to make column-wise operations fast.</p>
<div id="using-base-apply-function" class="section level3" number="13.6.1">
<h3><span class="header-section-number">13.6.1</span> Using base <code>apply()</code> function</h3>
<p>One solution is to use the base R function <code>apply()</code>
The <code>apply()</code> function applies a function to each row or column (<code>MARGIN=1</code> or <code>MARGIN=2</code> respectively).</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="data-reshaping.html#cb785-1" aria-hidden="true"></a>A &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">ncol=</span><span class="dv">3</span>)  <span class="co"># Make a matrix of 2 rows, 3 columns</span></span>
<span id="cb785-2"><a href="data-reshaping.html#cb785-2" aria-hidden="true"></a>A</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6</code></pre>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb787-1"><a href="data-reshaping.html#cb787-1" aria-hidden="true"></a><span class="kw">apply</span>(A, <span class="dt">MARGIN =</span> <span class="dv">1</span>, <span class="dt">FUN=</span>sum) <span class="co"># Apply sum() function to rows (MARGIN=1)</span></span></code></pre></div>
<pre><code>## [1]  9 12</code></pre>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="data-reshaping.html#cb789-1" aria-hidden="true"></a><span class="kw">apply</span>(A, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN=</span>sum) <span class="co"># Apply sum() function to columns (MARGIN=1)</span></span></code></pre></div>
<pre><code>## [1]  3  7 11</code></pre>
<p>So to add a row calculation, we just need to put together <code>select</code> and <code>apply</code> statements.</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="data-reshaping.html#cb791-1" aria-hidden="true"></a><span class="co">#     new.col.name             columns              function</span></span>
<span id="cb791-2"><a href="data-reshaping.html#cb791-2" aria-hidden="true"></a>grade.book <span class="op">%&gt;%</span></span>
<span id="cb791-3"><a href="data-reshaping.html#cb791-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(., <span class="dt">HW.avg =</span> <span class="kw">select</span>(., HW<span class="fl">.1</span><span class="op">:</span>HW<span class="fl">.4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">apply</span>(<span class="dv">1</span>, mean)) <span class="op">%&gt;%</span></span>
<span id="cb791-4"><a href="data-reshaping.html#cb791-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">print</span>() <span class="co"># this print is just to show you can keep the pipeline going...</span></span></code></pre></div>
<pre><code>##              name HW.1 HW.2 HW.3 HW.4 HW.avg
## 1 Alison.Anderson    8    5    8    4   6.25
## 2 Brandon.Babbage    5    3    6    9   5.75
## 3 Charles.Collins    9    7    9   10   8.75</code></pre>
<p>But this pipeline inside a mutate command is a little cumbersome. The command <code>dplyr::rowwise()</code> causes subsequent actions to be performed <em>rowwise</em> instead of the default of <em>columnwise</em>. <code>rowwise()</code> is actually a special form of <code>group_by()</code> which creates a unique group for each row. The function <code>dplyr::c_across()</code> allows you to use all the <code>select</code> style tricks for picking columns.</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="data-reshaping.html#cb793-1" aria-hidden="true"></a><span class="co"># grade.book %&gt;%</span></span>
<span id="cb793-2"><a href="data-reshaping.html#cb793-2" aria-hidden="true"></a><span class="co">#   rowwise() %&gt;%</span></span>
<span id="cb793-3"><a href="data-reshaping.html#cb793-3" aria-hidden="true"></a><span class="co">#   mutate( HW.avg = mean( c(HW.1, HW.2, HW.3, HW.4) ) )  # List the columns to average</span></span>
<span id="cb793-4"><a href="data-reshaping.html#cb793-4" aria-hidden="true"></a><span class="co"># </span></span>
<span id="cb793-5"><a href="data-reshaping.html#cb793-5" aria-hidden="true"></a><span class="co"># grade.book %&gt;%</span></span>
<span id="cb793-6"><a href="data-reshaping.html#cb793-6" aria-hidden="true"></a><span class="co">#   rowwise() %&gt;%</span></span>
<span id="cb793-7"><a href="data-reshaping.html#cb793-7" aria-hidden="true"></a><span class="co">#   mutate( HW.avg = mean( c_across(HW.1:HW.4) ) )     # Give a column range to average</span></span>
<span id="cb793-8"><a href="data-reshaping.html#cb793-8" aria-hidden="true"></a></span>
<span id="cb793-9"><a href="data-reshaping.html#cb793-9" aria-hidden="true"></a>grade.book <span class="op">%&gt;%</span></span>
<span id="cb793-10"><a href="data-reshaping.html#cb793-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></span>
<span id="cb793-11"><a href="data-reshaping.html#cb793-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">HW.avg =</span> <span class="kw">mean</span>( <span class="kw">c_across</span>(<span class="kw">starts_with</span>(<span class="st">&#39;HW&#39;</span>))) )  <span class="co"># Average all HW... columns </span></span></code></pre></div>
<pre><code>## # A tibble: 3 x 6
## # Rowwise: 
##   name             HW.1  HW.2  HW.3  HW.4 HW.avg
##   &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 Alison.Anderson     8     5     8     4   6.25
## 2 Brandon.Babbage     5     3     6     9   5.75
## 3 Charles.Collins     9     7     9    10   8.75</code></pre>
<p>Because <code>rowwise()</code> is a special form of grouping, to exit the row-wise calculations, call <code>ungroup()</code>.</p>
<p>Finally, there are some base R functions <code>rowSums()</code> and <code>rowMeans()</code> that calculate sums and means across rows. They are actually quite fast, but don’t allow the user to input an arbitrary function.</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="data-reshaping.html#cb795-1" aria-hidden="true"></a>grade.book <span class="op">%&gt;%</span></span>
<span id="cb795-2"><a href="data-reshaping.html#cb795-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">HW.avg =</span> <span class="kw">rowMeans</span>(<span class="kw">across</span>(<span class="kw">starts_with</span>(<span class="st">&#39;HW&#39;</span>))) )</span></code></pre></div>
<pre><code>##              name HW.1 HW.2 HW.3 HW.4 HW.avg
## 1 Alison.Anderson    8    5    8    4   6.25
## 2 Brandon.Babbage    5    3    6    9   5.75
## 3 Charles.Collins    9    7    9   10   8.75</code></pre>
<p>Somewhat confusingly, in this statement we used <code>across</code> which applies a transformation to multiple columns, while the <code>c_across()</code> is designed to work with the <code>rowwise()</code> command.</p>
<p>I prefer the solution that uses the <code>select(., cols) %&gt;% apply(1, fun)</code> chain inside the <code>mutate</code> command because I don’t have do an additional <code>rowwise()</code> <code>ungroup()</code> command in my pipeline.</p>
</div>
</div>
<div id="Exercises_DataReshaping" class="section level2" number="13.7">
<h2><span class="header-section-number">13.7</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>A common task is to take a set of data that has multiple categorical variables and create a table of the number of cases for each combination. An introductory statistics textbook contains a dataset summarizing student surveys from several sections of an intro class. The two variables of interest for us are <code>Gender</code> and <code>Year</code> which are the students gender and year in college.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Download the dataset and correctly order the <code>Year</code> variable using the following:</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="data-reshaping.html#cb797-1" aria-hidden="true"></a>Survey &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;http://www.lock5stat.com/datasets/StudentSurvey.csv&#39;</span>, <span class="dt">na.strings=</span><span class="kw">c</span>(<span class="st">&#39;&#39;</span>,<span class="st">&#39; &#39;</span>)) </span></code></pre></div></li>
<li><p>Using some combination of <code>dplyr</code> functions, produce a data set with eight rows that contains the number of responses for each gender:year combination. Make sure your table orders the <code>Year</code> variable in the correct order of <code>First Year</code>, <code>Sophmore</code>, <code>Junior</code>, and then <code>Senior</code>. <em>You might want to look at the following functions: <code>dplyr::count</code> and <code>dplyr::drop_na</code>.</em></p></li>
<li><p>Using <code>tidyr</code> commands, produce a table of the number of responses in the following form:</p>
<table>
<thead>
<tr class="header">
<th align="center">Gender</th>
<th align="center">First Year</th>
<th align="center">Sophmore</th>
<th align="center">Junior</th>
<th align="center">Senior</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>Female</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center"><strong>Male</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody>
</table></li>
</ol></li>
<li><p>From the book website, there is a .csv file of the daily maximum temperature in Flagstaff at the Pulliam Airport. The direction link is at: <a href="https://raw.githubusercontent.com/dereksonderegger/444/master/data-raw/FlagMaxTemp.csv">https://raw.githubusercontent.com/dereksonderegger/444/master/data-raw/FlagMaxTemp.csv</a></p>
<ol style="list-style-type: lower-alpha">
<li>Create a line graph that gives the daily maximum temperature for 2005. <em>Make sure the x-axis is a date and covers the whole year.</em></li>
<li>Create a line graph that gives the monthly average maximum temperature for 2013 - 2015. <em>Again the x-axis should be the date and the axis spans 3 years.</em></li>
</ol></li>
<li><p>We often are given data in a table format that is easy for a human to parse, but annoying a program. In the following example we have
<a href="https://github.com/dereksonderegger/444/raw/master/data-raw/US_Gov_Budget_1962_2020.xls">data</a>
of US government expenditures from 1962 to 2015. (I downloaded this data from <a href="https://obamawhitehouse.archives.gov/omb/budget/Historicals" class="uri">https://obamawhitehouse.archives.gov/omb/budget/Historicals</a> (Table 3.2) on Sept 22, 2019.)
Our goal is to end up with a data frame with columns for <code>Function</code>, <code>Subfunction</code>, <code>Year</code>, and <code>Amount</code>. We’ll ignore the “On-budget” and “Off-budget” distinction.</p>
<ol style="list-style-type: lower-alpha">
<li>Download the data file, inspect it, and read in the data using the <code>readxl</code> package.</li>
<li>Rename the <code>Function or subfunction</code> column to <code>Department</code>.</li>
<li>Remove any row with Total, Subtotal, On-budget or Off-budget. Also remove the row at the bottom that defines what NA means.</li>
<li>Create a new column for <code>ID_number</code> and parse the <code>Department</code> column for it.</li>
<li>If all (or just 2015?) the year values are missing, then the <code>Department</code> corresponds to <code>Function</code> name. Otherwise <code>Department</code> corresponds to the <code>Subfunction</code>. Create columns for <code>Function</code> and <code>Subfunction</code>. <em>Hint: Directly copy <code>Department</code> to <code>Subfunction</code>. Then using an <code>if_else()</code> statement to copy either <code>NA</code> or <code>Department</code> to <code>Function</code> depending on if the 2015 column is an <code>NA</code> (use the function <code>is.na()</code>). Once you have <code>Function</code> with either the <code>Function</code> name or an <code>NA</code>, you can use the <code>tidyr::fill</code> command to replace the NA values with whatever is on the row above. Check out the help files to see how to use it.</em></li>
<li>Remove rows that corresponded to the Function name that have no data. <em>Hint, you can just check if the <code>2015</code> column is <code>NA</code>.</em></li>
<li>Reshape the data into four columns for Function, Subfunction, Year, and Amount.</li>
<li>Remove rows that have Amount value of <code>..........</code>.</li>
<li>Make sure that Year and Amount are numeric. <em>Hint: it is OK to get rid of the estimate rows for 2016+</em></li>
<li>Make a line graph that compares spending for National Defense, Health, Medicare, Income Security, and Social Security for each of the years 2001 through 2015. <em>Notice you’ll have to sum up the sub-functions within each function.</em></li>
</ol></li>
<li><p>For this problem we will consider two simple data sets.</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="data-reshaping.html#cb798-1" aria-hidden="true"></a>A &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb798-2"><a href="data-reshaping.html#cb798-2" aria-hidden="true"></a>  <span class="op">~</span>Name, <span class="op">~</span>Car,</span>
<span id="cb798-3"><a href="data-reshaping.html#cb798-3" aria-hidden="true"></a>  <span class="st">&#39;Alice&#39;</span>, <span class="st">&#39;Ford F150&#39;</span>,</span>
<span id="cb798-4"><a href="data-reshaping.html#cb798-4" aria-hidden="true"></a>  <span class="st">&#39;Bob&#39;</span>,   <span class="st">&#39;Tesla Model III&#39;</span>,</span>
<span id="cb798-5"><a href="data-reshaping.html#cb798-5" aria-hidden="true"></a>  <span class="st">&#39;Charlie&#39;</span>, <span class="st">&#39;VW Bug&#39;</span>)</span>
<span id="cb798-6"><a href="data-reshaping.html#cb798-6" aria-hidden="true"></a></span>
<span id="cb798-7"><a href="data-reshaping.html#cb798-7" aria-hidden="true"></a>B &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb798-8"><a href="data-reshaping.html#cb798-8" aria-hidden="true"></a>  <span class="op">~</span>First.Name, <span class="op">~</span>Pet,</span>
<span id="cb798-9"><a href="data-reshaping.html#cb798-9" aria-hidden="true"></a>  <span class="st">&#39;Bob&#39;</span>,  <span class="st">&#39;Cat&#39;</span>,</span>
<span id="cb798-10"><a href="data-reshaping.html#cb798-10" aria-hidden="true"></a>  <span class="st">&#39;Charlie&#39;</span>, <span class="st">&#39;Dog&#39;</span>,</span>
<span id="cb798-11"><a href="data-reshaping.html#cb798-11" aria-hidden="true"></a>  <span class="st">&#39;Alice&#39;</span>, <span class="st">&#39;Rabbit&#39;</span>)</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li>Squish the data frames together to generate a data set with three rows and three columns. Do two ways: first using <code>cbind</code> and then using one of the <code>dplyr</code> <code>join</code> commands.</li>
<li>It turns out that Alice also has a pet guinea pig. Add another row to the <code>B</code> data set. Do this using either the base function <code>rbind</code>, or either of the <code>dplyr</code> functions <code>add_row</code> or <code>bind_rows</code>.</li>
<li>Squish the <code>A</code> and <code>B</code> data sets together to generate a data set with four rows and three columns. Do this two ways: first using <code>cbind</code> and then using one of the <code>dplyr</code> <code>join</code> commands. Which was easier to program? Which is more likely to have an error.</li>
</ol></li>
<li><p>Data table joins are extremely common because effective database design almost always involves having multiple tables for different types of objects. To illustrate both the table joins and the usefulness of multiple tables we will develop a set of data frames that will represent a credit card company’s customer data base. We will have tables for Customers, Retailers, Cards, and Transactions. Below is code that will create and populate these tables.</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="data-reshaping.html#cb799-1" aria-hidden="true"></a>Customers &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb799-2"><a href="data-reshaping.html#cb799-2" aria-hidden="true"></a>  <span class="op">~</span>PersonID, <span class="op">~</span>Name, <span class="op">~</span>Street, <span class="op">~</span>City, <span class="op">~</span>State,</span>
<span id="cb799-3"><a href="data-reshaping.html#cb799-3" aria-hidden="true"></a>  <span class="dv">1</span>, <span class="st">&#39;Derek Sonderegger&#39;</span>,  <span class="st">&#39;231 River Run&#39;</span>, <span class="st">&#39;Flagstaff&#39;</span>, <span class="st">&#39;AZ&#39;</span>,</span>
<span id="cb799-4"><a href="data-reshaping.html#cb799-4" aria-hidden="true"></a>  <span class="dv">2</span>, <span class="st">&#39;Aubrey Sonderegger&#39;</span>, <span class="st">&#39;231 River Run&#39;</span>, <span class="st">&#39;Flagstaff&#39;</span>, <span class="st">&#39;AZ&#39;</span>,</span>
<span id="cb799-5"><a href="data-reshaping.html#cb799-5" aria-hidden="true"></a>  <span class="dv">3</span>, <span class="st">&#39;Robert Buscaglia&#39;</span>, <span class="st">&#39;754 Forest Heights&#39;</span>, <span class="st">&#39;Flagstaff&#39;</span>, <span class="st">&#39;AZ&#39;</span>,</span>
<span id="cb799-6"><a href="data-reshaping.html#cb799-6" aria-hidden="true"></a>  <span class="dv">4</span>, <span class="st">&#39;Roy St Laurent&#39;</span>, <span class="st">&#39;845 Elk View&#39;</span>, <span class="st">&#39;Flagstaff&#39;</span>, <span class="st">&#39;AZ&#39;</span>)</span>
<span id="cb799-7"><a href="data-reshaping.html#cb799-7" aria-hidden="true"></a></span>
<span id="cb799-8"><a href="data-reshaping.html#cb799-8" aria-hidden="true"></a>Retailers &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb799-9"><a href="data-reshaping.html#cb799-9" aria-hidden="true"></a>  <span class="op">~</span>RetailID, <span class="op">~</span>Name, <span class="op">~</span>Street, <span class="op">~</span>City, <span class="op">~</span>State,</span>
<span id="cb799-10"><a href="data-reshaping.html#cb799-10" aria-hidden="true"></a>  <span class="dv">1</span>, <span class="st">&#39;Kickstand Kafe&#39;</span>, <span class="st">&#39;719 N Humphreys St&#39;</span>, <span class="st">&#39;Flagstaff&#39;</span>, <span class="st">&#39;AZ&#39;</span>,</span>
<span id="cb799-11"><a href="data-reshaping.html#cb799-11" aria-hidden="true"></a>  <span class="dv">2</span>, <span class="st">&#39;MartAnnes&#39;</span>, <span class="st">&#39;112 E Route 66&#39;</span>, <span class="st">&#39;Flagstaff&#39;</span>, <span class="st">&#39;AZ&#39;</span>,</span>
<span id="cb799-12"><a href="data-reshaping.html#cb799-12" aria-hidden="true"></a>  <span class="dv">3</span>, <span class="st">&#39;REI&#39;</span>, <span class="st">&#39;323 S Windsor Ln&#39;</span>, <span class="st">&#39;Flagstaff&#39;</span>, <span class="st">&#39;AZ&#39;</span> )</span>
<span id="cb799-13"><a href="data-reshaping.html#cb799-13" aria-hidden="true"></a></span>
<span id="cb799-14"><a href="data-reshaping.html#cb799-14" aria-hidden="true"></a>Cards &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb799-15"><a href="data-reshaping.html#cb799-15" aria-hidden="true"></a>  <span class="op">~</span>CardID, <span class="op">~</span>PersonID, <span class="op">~</span>Issue_DateTime, <span class="op">~</span>Exp_DateTime,</span>
<span id="cb799-16"><a href="data-reshaping.html#cb799-16" aria-hidden="true"></a>  <span class="st">&#39;9876768717278723&#39;</span>,  <span class="dv">1</span>,  <span class="st">&#39;2019-9-20 0:00:00&#39;</span>, <span class="st">&#39;2022-9-20 0:00:00&#39;</span>,</span>
<span id="cb799-17"><a href="data-reshaping.html#cb799-17" aria-hidden="true"></a>  <span class="st">&#39;5628927579821287&#39;</span>,  <span class="dv">2</span>,  <span class="st">&#39;2019-9-20 0:00:00&#39;</span>, <span class="st">&#39;2022-9-20 0:00:00&#39;</span>,</span>
<span id="cb799-18"><a href="data-reshaping.html#cb799-18" aria-hidden="true"></a>  <span class="st">&#39;7295825498122734&#39;</span>,  <span class="dv">3</span>,  <span class="st">&#39;2019-9-28 0:00:00&#39;</span>, <span class="st">&#39;2022-9-28 0:00:00&#39;</span>,</span>
<span id="cb799-19"><a href="data-reshaping.html#cb799-19" aria-hidden="true"></a>  <span class="st">&#39;8723768965231926&#39;</span>,  <span class="dv">4</span>,  <span class="st">&#39;2019-9-30 0:00:00&#39;</span>, <span class="st">&#39;2022-9-30 0:00:00&#39;</span> ) </span>
<span id="cb799-20"><a href="data-reshaping.html#cb799-20" aria-hidden="true"></a></span>
<span id="cb799-21"><a href="data-reshaping.html#cb799-21" aria-hidden="true"></a>Transactions &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb799-22"><a href="data-reshaping.html#cb799-22" aria-hidden="true"></a>  <span class="op">~</span>CardID, <span class="op">~</span>RetailID, <span class="op">~</span>DateTime, <span class="op">~</span>Amount,</span>
<span id="cb799-23"><a href="data-reshaping.html#cb799-23" aria-hidden="true"></a>  <span class="st">&#39;9876768717278723&#39;</span>, <span class="dv">1</span>, <span class="st">&#39;2019-10-1 8:31:23&#39;</span>,    <span class="fl">5.68</span>,</span>
<span id="cb799-24"><a href="data-reshaping.html#cb799-24" aria-hidden="true"></a>  <span class="st">&#39;7295825498122734&#39;</span>, <span class="dv">2</span>, <span class="st">&#39;2019-10-1 12:45:45&#39;</span>,  <span class="fl">25.67</span>,</span>
<span id="cb799-25"><a href="data-reshaping.html#cb799-25" aria-hidden="true"></a>  <span class="st">&#39;9876768717278723&#39;</span>, <span class="dv">1</span>, <span class="st">&#39;2019-10-2 8:26:31&#39;</span>,    <span class="fl">5.68</span>,</span>
<span id="cb799-26"><a href="data-reshaping.html#cb799-26" aria-hidden="true"></a>  <span class="st">&#39;9876768717278723&#39;</span>, <span class="dv">1</span>, <span class="st">&#39;2019-10-2 8:30:09&#39;</span>,    <span class="fl">9.23</span>,</span>
<span id="cb799-27"><a href="data-reshaping.html#cb799-27" aria-hidden="true"></a>  <span class="st">&#39;5628927579821287&#39;</span>, <span class="dv">3</span>, <span class="st">&#39;2019-10-5 18:58:57&#39;</span>,  <span class="fl">68.54</span>,</span>
<span id="cb799-28"><a href="data-reshaping.html#cb799-28" aria-hidden="true"></a>  <span class="st">&#39;7295825498122734&#39;</span>, <span class="dv">2</span>, <span class="st">&#39;2019-10-5 12:39:26&#39;</span>,  <span class="fl">31.84</span>,</span>
<span id="cb799-29"><a href="data-reshaping.html#cb799-29" aria-hidden="true"></a>  <span class="st">&#39;8723768965231926&#39;</span>, <span class="dv">2</span>, <span class="st">&#39;2019-10-10 19:02:20&#39;</span>, <span class="fl">42.83</span>) </span>
<span id="cb799-30"><a href="data-reshaping.html#cb799-30" aria-hidden="true"></a></span>
<span id="cb799-31"><a href="data-reshaping.html#cb799-31" aria-hidden="true"></a>Cards &lt;-<span class="st"> </span>Cards <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb799-32"><a href="data-reshaping.html#cb799-32" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">Issue_DateTime =</span> lubridate<span class="op">::</span><span class="kw">ymd_hms</span>(Issue_DateTime),</span>
<span id="cb799-33"><a href="data-reshaping.html#cb799-33" aria-hidden="true"></a>          <span class="dt">Exp_DateTime   =</span> lubridate<span class="op">::</span><span class="kw">ymd_hms</span>(Exp_DateTime) )</span>
<span id="cb799-34"><a href="data-reshaping.html#cb799-34" aria-hidden="true"></a>Transactions &lt;-<span class="st"> </span>Transactions <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb799-35"><a href="data-reshaping.html#cb799-35" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">DateTime =</span> lubridate<span class="op">::</span><span class="kw">ymd_hms</span>(DateTime))</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li><p>Create a table that gives the credit card statement for Derek. It should give all the transactions, the amounts, and the store name. Write your code as if the only initial information you have is the customer’s name. <em>Hint: Do a bunch of table joins, and then filter for the desired customer name. To be efficient, do the filtering first and then do the table joins.</em></p></li>
<li><p>Aubrey has lost her credit card on Oct 15, 2019. Close her credit card at 4:28:21 PM and issue her a new credit card in the <code>Cards</code> table. <em>Hint: Using the Aubrey’s name, get necessary CardID and PersonID and save those as <code>cardID</code> and <code>personID</code>. Then update the <code>Cards</code> table row that corresponds to the <code>cardID</code> so that the expiration date is set to the time that the card is closed. Then insert a new row with the <code>personID</code> for Aubrey and a new <code>CardID</code> number that you make up.</em></p></li>
<li><p>Aubrey is using her new card at Kickstand Kafe on Oct 16, 2019 at 2:30:21 PM for coffee with a charge of $4.98. Generate a new transaction for this action. <em>Hint: create temporary variables <code>card</code>,<code>retailid</code>,<code>datetime</code>, and <code>amount</code> that contain the information for this transaction and then write your code to use those. This way in the next question you can just use the same code but modify the temporary variables. Alternatively, you could write a function that takes in these four values and manipulates the tables in the GLOBAL environment using the <code>&lt;&lt;-</code> command to assign a result to a variable defined in the global environment. The reason this is OK is that in a real situation, these data would be stored in a database and we would expect the function to update that database.</em></p></li>
<li><p>On Oct 17, 2019, some nefarious person is trying to use her OLD credit card at REI. Make sure your code in part (c) first checks to see if the credit card is active before creating a new transaction. Using the same code, verify that the nefarious transaction at REI is denied. <em>Hint: your check ought to look something like this:</em></p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="data-reshaping.html#cb800-1" aria-hidden="true"></a>card &lt;-<span class="st"> &#39;9876768717278723&#39;</span></span>
<span id="cb800-2"><a href="data-reshaping.html#cb800-2" aria-hidden="true"></a>retailid &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb800-3"><a href="data-reshaping.html#cb800-3" aria-hidden="true"></a>datetime &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">&#39;2019-10-16 14:30:21&#39;</span>)</span>
<span id="cb800-4"><a href="data-reshaping.html#cb800-4" aria-hidden="true"></a>amount &lt;-<span class="st"> </span><span class="fl">4.98</span></span>
<span id="cb800-5"><a href="data-reshaping.html#cb800-5" aria-hidden="true"></a></span>
<span id="cb800-6"><a href="data-reshaping.html#cb800-6" aria-hidden="true"></a><span class="co"># If the card is currently valid, this should return exactly 1 row.</span></span>
<span id="cb800-7"><a href="data-reshaping.html#cb800-7" aria-hidden="true"></a>Valid_Cards &lt;-<span class="st"> </span>Cards <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb800-8"><a href="data-reshaping.html#cb800-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(CardID <span class="op">==</span><span class="st"> </span>card, Issue_DateTime <span class="op">&lt;=</span><span class="st"> </span>datetime, datetime <span class="op">&lt;=</span><span class="st"> </span>Exp_DateTime)</span>
<span id="cb800-9"><a href="data-reshaping.html#cb800-9" aria-hidden="true"></a></span>
<span id="cb800-10"><a href="data-reshaping.html#cb800-10" aria-hidden="true"></a><span class="co"># If the transaction is valid, insert the transaction into the table</span></span>
<span id="cb800-11"><a href="data-reshaping.html#cb800-11" aria-hidden="true"></a><span class="cf">if</span>( <span class="kw">nrow</span>(Valid_Cards) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb800-12"><a href="data-reshaping.html#cb800-12" aria-hidden="true"></a>  <span class="co"># Some code to insert the transaction</span></span>
<span id="cb800-13"><a href="data-reshaping.html#cb800-13" aria-hidden="true"></a>}<span class="cf">else</span>{</span>
<span id="cb800-14"><a href="data-reshaping.html#cb800-14" aria-hidden="true"></a>  <span class="kw">print</span>(<span class="st">&#39;Card Denied&#39;</span>)</span>
<span id="cb800-15"><a href="data-reshaping.html#cb800-15" aria-hidden="true"></a>}</span></code></pre></div></li>
<li><p>Generate a table that gives the credit card statement for Aubrey. It should give all the transactions, amounts, and retailer name for both credit cards she had during this period.</p></li>
</ol></li>
<li><p>The package <code>nycflights13</code> contains information about all the flights that arrived in or left from New York City in 2013. This package contains five data tables, but there are three data tables we will work with. The data table <code>flights</code> gives information about a particular flight, <code>airports</code> gives information about a particular airport, and <code>airlines</code> gives information about each airline. Create a table of all the flights on February 14th by Virgin America that has columns for the carrier, destination, departure time, and flight duration. Join this table with the airports information for the destination. Notice that because the column for the destination airport code doesn’t match up between <code>flights</code> and <code>airports</code>, you’ll have to use the <code>by=c("TableA.Col"="TableB.Col")</code> argument where you insert the correct names for <code>TableA.Col</code> and <code>TableB.Col</code>.</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dates-and-times.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="maps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"],
"google": false,
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dereksonderegger/444/blob/master/27_DataReshaping.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/dereksonderegger/444/raw/master/27_DataReshaping.Rmd",
"text": null
},
"download": [["Introduction_to_DataScience_with_R.pdf", "PDF"]],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
