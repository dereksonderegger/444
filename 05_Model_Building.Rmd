# Statistical Models

```{r, echo=FALSE}
# Unattach any packages that happen to already be loaded. In general this is unecessary
# but is important for the creation of the book to not have package namespaces
# fighting unexpectedly.
pkgs = names(sessionInfo()$otherPkgs)
if( length(pkgs > 0)){
  pkgs = paste('package:', pkgs, sep = "")
  for( i in 1:length(pkgs)){
    detach(pkgs[i], character.only = TRUE, force=TRUE)
  }
}
```
```{r, message=FALSE, warning=FALSE, results='hide'}
library(tidyverse, quietly = TRUE)   # loading ggplot2 and dplyr
```


While R is a full programming language, it was first developed by statisticians for statisticians. There are several functions to do common statistical tests but because those functions were developed early in R's history, there is some inconsistency in how those functions work. There have been some attempts to standardize modeling object interfaces, but there were always be a little weirdness.

## Formula Notation
Most statistical modeling functions rely on a formula based interface. The primary purpose is to provide a consistent way to designate which columns in a data frame are the response variable and which are the explanatory variables.  In particular the notation is

$$\underbrace{y}_{\textrm{LHS response}} \;\;\; 
\underbrace{\sim}_{\textrm{is a function of}} \;\;\; 
\underbrace{x}_{\textrm{RHS explanatory}}$$

Mathematicians often refer to these terms as the *Left Hand Side* (LHS) and *Right Hand Side* (RHS). The LHS is always the response and the RHS contains the explanatory variables.

In R, the LHS is usually just a single variable in the data. However the RHS can contain multiple variables and in complicated relationships.

+-------------------------------+-------------------------------------------------------+
|  **Right Hand Side Terms**    |  Meaning                                              |
+-------------------------------+-------------------------------------------------------+
|   `x1 + x2`                   | Both `x1` and `x2` are additive explanatory variables.|
|                               | In this format, we are adding only the *main effects* |
|                               | of the `x1` and `x2` variables.                       |
+-------------------------------+-------------------------------------------------------+
| ` x1:x2`                      | This is the interaction term between `x1` and `x2`    | 
+-------------------------------+-------------------------------------------------------+
| `x1 * x2`                     | Because whenever we add an interaction term to a      |
|                               | model, we want to also have the main effects. So this |
|                               | is a short cut for adding the main effect of `x1` and |
|                               | `x2` and also the interaction term `x1:x2`.           |
+-------------------------------+-------------------------------------------------------+
| `(x1 + x2 + x3)^2`            | This is the main effects of `x1`, `x2`, and `x3` and  |
|                               | also all of the second order interactions.            |
+-------------------------------+-------------------------------------------------------+
| `poly(x, degree=2)`           | This fits the degree 2 polynomial. When fit like this,|
|                               | R produces an orthogonal basis for the polynomial,    |
|                               | which is more computationally stable, but won't be    |
|                               | appropiate for interpreting the polynomial            |
|                               | coefficients.                                         |
+------------------------+--------------------------------------------------------------+
| `poly(x, degree=2, raw=TRUE)` | This fits the degree 2 polynomial using               |
|                               | $\beta_0 + \beta_1 x + \beta_2 x^2$ and the polynomial|   
|                               | polynomial coefficients are suitable for              |  
|                               | interpretation.                                       |
+-------------------------------+-------------------------------------------------------+
| `I( x^2 )`                    |  *Ignore* the usual rules for interpreting formulas   |
|                               | and do the mathematical calculation. This is not      |
|                               | necessary for things like `sqrt(x)` or `log(x)` but   |
|                               | required if there is a conflict between mathematics   |
|                               | and the formula interpretation.                       |
+-------------------------------+-------------------------------------------------------+

## Basic Models
The most common statistical models are generally referred to as *linear models* and the R function for creating a linear model is `lm()`. This section will introduce how to fit the model to data in a data frame as well as how to fit very specific t-test models.

###  t-tests
In R, the historical function to fit both paired and unpaired t-tests is the function `t.test()`. 
###  lm objects
  
## Accessor function using traditional functions
## Accessing model results using `broom`